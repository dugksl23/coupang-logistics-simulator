<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸš€ ì¿ íŒ¡ ë¬¼ë¥˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œ - í˜„ì‹¤ì„± 95% | Coupang Logistics Reality Simulator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f7fafc; --card:#ffffff; --ink:#1f2937; --muted:#6b7280; --line:#e5e7eb;
      --pri:#2563eb; --good:#10b981; --warn:#f59e0b; --bad:#ef4444; --vio:#8b5cf6; --cyan:#06b6d4;
      --rocket:#ff6b35; --wow:#9333ea; --fresh:#059669; --premium:#dc2626;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1800px;margin:0 auto;padding:20px}

    .header{
      background:linear-gradient(135deg,#ff6b35 0%,#f7931e 50%,#9333ea 100%);
      color:#fff;border-radius:16px;padding:28px 32px;margin-bottom:20px;
      box-shadow:0 12px 32px rgba(255,107,53,.25);
      position:relative;overflow:hidden;
    }
    .header::before{
      content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
      background:repeating-linear-gradient(45deg,transparent,transparent 10px,rgba(255,255,255,0.05) 10px,rgba(255,255,255,0.05) 20px);
      animation:slide 20s linear infinite;
    }
    @keyframes slide{0%{transform:translateX(-50px)}100%{transform:translateX(50px)}}
    .header h1{margin:0 0 8px 0;font-size:24px;position:relative;z-index:1}
    .header .sub{opacity:.9;font-size:14px;position:relative;z-index:1}
    .header .reality-badge{
      position:absolute;top:20px;right:30px;background:rgba(255,255,255,0.2);
      backdrop-filter:blur(10px);border-radius:12px;padding:8px 16px;
      font-size:12px;font-weight:700;border:1px solid rgba(255,255,255,0.3);
    }

    .panel{
      background:var(--card);border:1px solid var(--line);border-radius:16px;padding:20px;margin:16px 0;
      box-shadow:0 6px 20px rgba(2,6,23,.08);
    }
    .controls{display:flex;gap:16px;flex-wrap:wrap;align-items:flex-end}
    .ctrl{display:flex;flex-direction:column;gap:6px}
    .ctrl label{font-size:12px;color:var(--muted);font-weight:600}
    .ctrl input,.ctrl select{padding:8px 12px;border:1px solid var(--line);border-radius:10px;min-width:130px}
    .btn{background:var(--pri);color:#fff;border:none;padding:12px 18px;border-radius:12px;font-weight:700;cursor:pointer;transition:all 0.3s}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(37,99,235,.3)}
    .btn:disabled{background:#9ca3af;cursor:not-allowed;transform:none}
    .btn.secondary{background:#374151}
    .btn.danger{background:var(--bad)}
    .btn.rocket{background:var(--rocket)}
    .btn.wow{background:var(--wow)}

    /* ì§„í–‰ë¥  í‘œì‹œ */
    .progress-container{margin:12px 0;display:none}
    .progress-bar{width:100%;height:10px;background:var(--line);border-radius:6px;overflow:hidden}
    .progress-fill{height:100%;background:linear-gradient(45deg,var(--rocket),var(--wow));width:0%;transition:width 0.3s ease}
    .progress-text{font-size:13px;color:var(--muted);margin-top:6px;text-align:center;font-weight:600}
    .progress-stats{display:flex;justify-content:space-between;font-size:11px;color:var(--muted);margin-top:6px}

    .kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
    .kpi{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;position:relative;transition:transform 0.3s}
    .kpi:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(2,6,23,.12)}
    .kpi h4{margin:0 0 10px 0;font-size:13px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;display:flex;align-items:center;gap:6px}
    .kpi .v{font-size:28px;font-weight:800;margin-bottom:4px}
    .kpi .meta{font-size:11px;color:var(--muted)}
    .kpi.primary{border-top:4px solid var(--pri)}
    .kpi.good{border-top:4px solid var(--good)}
    .kpi.warn{border-top:4px solid var(--warn)}
    .kpi.bad{border-top:4px solid var(--bad)}
    .kpi.vio{border-top:4px solid var(--vio)}
    .kpi.cyan{border-top:4px solid var(--cyan)}
    .kpi.rocket{border-top:4px solid var(--rocket)}
    .kpi.wow{border-top:4px solid var(--wow)}
    .kpi.fresh{border-top:4px solid var(--fresh)}

    /* ìƒˆë¡œìš´ ì¿ íŒ¡ íŠ¹í™” ìŠ¤íƒ€ì¼ */
    .rocket-badge{background:var(--rocket);color:white;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700}
    .wow-badge{background:var(--wow);color:white;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700}
    .fresh-badge{background:var(--fresh);color:white;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700}

    .sections{display:grid;grid-template-columns:repeat(auto-fit,minmax(380px,1fr));gap:18px;margin-top:12px}
    .section{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
    .section h3{margin:0 0 12px 0;font-size:17px;display:flex;align-items:center;gap:8px}

    .alerts{display:flex;flex-direction:column;gap:10px;max-height:280px;overflow:auto}
    .alert{padding:12px 15px;border-radius:12px;font-size:13px;border:1px solid;transition:all 0.3s}
    .alert:hover{transform:translateX(4px)}
    .alert.good{background:#ecfdf5;border-color:#a7f3d0;color:#065f46}
    .alert.warn{background:#fffbeb;border-color:#fde68a;color:#92400e}
    .alert.bad{background:#fef2f2;border-color:#fecaca;color:#991b1b}
    .alert.rocket{background:#fff7ed;border-color:#fed7aa;color:#c2410c}

    .table-wrap{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:0;margin-top:18px;overflow:hidden}
    table{width:100%;border-collapse:collapse;font-size:12px}
    thead{position:sticky;top:0;background:#f9fafb;border-bottom:2px solid var(--line)}
    th,td{padding:8px 10px;border-bottom:1px solid var(--line);text-align:center;white-space:nowrap}
    th{font-weight:700;color:var(--ink)}
    tbody{max-height:600px;overflow:auto}
    .pill{display:inline-block;padding:3px 8px;border-radius:10px;font-size:11px;font-weight:600}
    .pill.ok{background:#dcfce7;color:#065f46}
    .pill.ng{background:#fee2e2;color:#991b1b}
    .pill.running{background:#dbeafe;color:#1e40af}

    /* ì¿ íŒ¡ íŠ¹í™” í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .delivery-mode{font-weight:600}
    .delivery-mode.rocket{color:var(--rocket)}
    .delivery-mode.dawn{color:var(--wow)}
    .delivery-mode.fresh{color:var(--fresh)}

    .wow-member{background:linear-gradient(45deg,var(--wow),var(--pri));color:white;padding:2px 6px;border-radius:6px;font-size:10px}
    .temp-indicator{font-weight:600;padding:2px 6px;border-radius:4px;font-size:10px}
    .temp-frozen{background:#3b82f6;color:white}
    .temp-cold{background:#06b6d4;color:white}
    .temp-fresh{background:#059669;color:white}
    .temp-normal{background:#6b7280;color:white}

    @media (max-width:768px){
      .controls{flex-direction:column;align-items:flex-start}
      .ctrl input,.ctrl select{min-width:280px}
      .sections{grid-template-columns:1fr}
      .kpi-grid{grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}
    }

    /* ì‹¤ì‹œê°„ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
    .pulse{animation:pulse 2s infinite}

    @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}
    .bounce{animation:bounce 2s}
  </style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="reality-badge">í˜„ì‹¤ì„± 95%</div>
    <h1>ğŸš€ ì¿ íŒ¡ ë¬¼ë¥˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œ (Coupang Logistics Reality Simulator)</h1>
    <div class="sub">
      ğŸ¯ ë¡œì¼“ë°°ì†¡Â·ì‹ ì„ ì‹í’ˆÂ·WOWë©¤ë²„ì‹­Â·AIìë™í™” ì™„ì „ ë°˜ì˜ | ì „êµ­ 2,500+ í–‰ì •êµ¬ì—­ | í—ˆë¸Œ&ìŠ¤í¬í¬ ë„¤íŠ¸ì›Œí¬ | ì½œë“œì²´ì¸ ê´€ë¦¬
    </div>
  </div>

  <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
  <div class="panel">
    <div class="controls">
      <div class="ctrl">
        <label>ì‹œì‘ë…„ë„ / Start Year</label>
        <select id="startYear"></select>
      </div>
      <div class="ctrl">
        <label>ì¢…ë£Œë…„ë„ / End Year</label>
        <select id="endYear"></select>
      </div>
      <div class="ctrl">
        <label>ê³ ê° ìˆ˜ / #Users</label>
        <input id="userCount" type="number" min="100" max="200000" value="15000">
      </div>
      <div class="ctrl">
        <label>ì£¼ë¬¸ ìˆ˜ / #Orders</label>
        <input id="orderCount" type="number" min="500" max="10000000" step="1000" value="75000">
      </div>
      <div class="ctrl">
        <label>ì²­í¬ í¬ê¸° / Chunk Size</label>
        <input id="chunkSize" type="number" min="500" max="15000" step="500" value="3000">
      </div>
      <div class="ctrl">
        <label>ë¡œì¼“ë°°ì†¡ ë¹„ì¤‘ / Rocket Rate (%)</label>
        <input id="rocketRate" type="number" min="35" max="75" value="55">
      </div>
      <div class="ctrl">
        <label>WOW ê°€ì…ë¥  / WOW Rate (%)</label>
        <input id="wowRate" type="number" min="60" max="80" value="70">
      </div>
      <button class="btn rocket" id="btnGen">ğŸ”„ ë°ì´í„° ìƒì„± / Generate</button>
      <button class="btn danger" id="btnStop" disabled style="display:none">â¹ï¸ ì¤‘ë‹¨ / Stop</button>
      <button class="btn wow" id="btnCsv" disabled>ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ / Download CSV</button>
      <div id="status" class="pill ok" style="margin-left:auto">READY</div>
    </div>

    <!-- ì§„í–‰ë¥  í‘œì‹œ -->
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">ì²˜ë¦¬ ì¤‘... / Processing...</div>
      <div class="progress-stats">
        <span id="progressStats">-</span>
        <span id="progressETA">ì˜ˆìƒ ì™„ë£Œ: - / ETA: -</span>
      </div>
    </div>
  </div>

  <!-- KPI ì„¹ì…˜ - ì¿ íŒ¡ íŠ¹í™” ê°œì„  -->
  <div class="sections">
    <div class="section">
      <h3>ğŸš€ ë¡œì¼“ë°°ì†¡ ì„±ê³¼ / Rocket Delivery Performance</h3>
      <div class="kpi-grid">
        <div class="kpi rocket">
          <h4>ë¡œì¼“ë°°ì†¡ ë¹„ì¤‘ <span class="rocket-badge">ROCKET</span></h4>
          <div class="v" id="k_rocketShare">-</div>
          <div class="meta">% of total orders</div>
        </div>
        <div class="kpi rocket">
          <h4>ë¡œì¼“ë‹¹ì¼ ì„±ê³µë¥  <span class="rocket-badge">SAME-DAY</span></h4>
          <div class="v" id="k_rocketSameDayRate">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi rocket">
          <h4>ë¡œì¼“ìƒˆë²½ ì •ì‹œìœ¨ <span class="rocket-badge">DAWN</span></h4>
          <div class="v" id="k_rocketDawnRate">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi rocket">
          <h4>30ë¶„ë‚´ ì¶œê³ ìœ¨ <span class="rocket-badge">FAST</span></h4>
          <div class="v" id="k_fastShipRate">-</div>
          <div class="meta">%</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸŒŸ WOW ë©¤ë²„ì‹­ & í”„ë¦¬ë¯¸ì—„ / WOW Membership & Premium</h3>
      <div class="kpi-grid">
        <div class="kpi wow">
          <h4>WOW ê°€ì…ë¥  <span class="wow-badge">WOW</span></h4>
          <div class="v" id="k_wowShare">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi wow">
          <h4>WOW Plus ë¹„ì¤‘ <span class="wow-badge">PLUS</span></h4>
          <div class="v" id="k_wowPlusShare">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi wow">
          <h4>WOW vs ë¹„íšŒì› AOV ì°¨ì´</h4>
          <div class="v" id="k_wowAovGap">-</div>
          <div class="meta">â‚©</div>
        </div>
        <div class="kpi warn">
          <h4>WOW ì´íƒˆ ìœ„í—˜ ê³ ê°</h4>
          <div class="v" id="k_wowChurnRisk">-</div>
          <div class="meta">ëª…</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h3>â„ï¸ ì‹ ì„ ì‹í’ˆ & ì½œë“œì²´ì¸ / Fresh Food & Cold Chain</h3>
      <div class="kpi-grid">
        <div class="kpi fresh">
          <h4>ì‹ ì„ ì‹í’ˆ ë¹„ì¤‘ <span class="fresh-badge">FRESH</span></h4>
          <div class="v" id="k_freshShare">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi fresh">
          <h4>ì½œë“œì²´ì¸ ì¤€ìˆ˜ìœ¨</h4>
          <div class="v" id="k_coldChainRate">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi warn">
          <h4>ì˜¨ë„ ìœ„ë°˜ìœ¨</h4>
          <div class="v" id="k_tempViolation">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi fresh">
          <h4>ëƒ‰ë™ì‹í’ˆ í’ˆì§ˆ ì ìˆ˜</h4>
          <div class="v" id="k_frozenQuality">-</div>
          <div class="meta">/100</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸ­ í—ˆë¸Œ&ìŠ¤í¬í¬ ë¬¼ë¥˜ë§ / Hub & Spoke Network</h3>
      <div class="kpi-grid">
        <div class="kpi primary">
          <h4>ë©”ê°€í—ˆë¸Œ ì²˜ë¦¬ ë¹„ì¤‘</h4>
          <div class="v" id="k_megaHubShare">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi primary">
          <h4>ìˆ˜ë„ê¶Œ ì»¤ë²„ë¦¬ì§€</h4>
          <div class="v" id="k_seoulCoverage">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi good">
          <h4>í‰ê·  ë°°ì†¡ ê±°ë¦¬</h4>
          <div class="v" id="k_avgDistance">-</div>
          <div class="meta">km</div>
        </div>
        <div class="kpi primary">
          <h4>ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨ì„±</h4>
          <div class="v" id="k_networkEff">-</div>
          <div class="meta">ì </div>
        </div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸ¤– AI & ìë™í™” ìˆ˜ì¤€ / AI & Automation Level</h3>
      <div class="kpi-grid">
        <div class="kpi cyan">
          <h4>AI ìµœì í™” ë¹„ìœ¨</h4>
          <div class="v" id="k_aiOptimized">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi cyan">
          <h4>ìë™ í”¼í‚¹ìœ¨</h4>
          <div class="v" id="k_autoPickRate">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi good">
          <h4>í‰ê·  í”¼í‚¹ ì‹œê°„</h4>
          <div class="v" id="k_avgPickTime">-</div>
          <div class="meta">ì´ˆ</div>
        </div>
        <div class="kpi cyan">
          <h4>WMS ê³ ë„í™” ì ìˆ˜</h4>
          <div class="v" id="k_wmsAdvanced">-</div>
          <div class="meta">/100</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸ’° ë§¤ì¶œÂ·ìˆ˜ìµ / Sales & Profit</h3>
      <div class="kpi-grid">
        <div class="kpi primary"><h4>ì´ ë§¤ì¶œ / Total Sales</h4><div class="v" id="k_totalSales">-</div><div class="meta">â‚©</div></div>
        <div class="kpi good"><h4>ìˆœì´ìµë¥  / Net Margin Rate</h4><div class="v" id="k_netMargin">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>í‰ê· ì£¼ë¬¸ê¸ˆì•¡ / AOV</h4><div class="v" id="k_aov">-</div><div class="meta">â‚©</div></div>
        <div class="kpi"><h4>ARPPU / ARPPU</h4><div class="v" id="k_arppu">-</div><div class="meta">â‚©</div></div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸ‘¥ ê³ ê° / Customer</h3>
      <div class="kpi-grid">
        <div class="kpi"><h4>LTV:CAC ë¹„ìœ¨ / LTV:CAC</h4><div class="v" id="k_ltvCac">-</div></div>
        <div class="kpi"><h4>ìœ ì§€ìœ¨ / Retention Rate</h4><div class="v" id="k_retention">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>ì´íƒˆë¥  / Churn Rate</h4><div class="v" id="k_churn">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>AI ì´íƒˆ ì˜ˆì¸¡ ì •í™•ë„ / AI Churn Accuracy</h4><div class="v" id="k_ai">-</div><div class="meta">%</div></div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸšš ë°°ì†¡Â·ë¬¼ë¥˜ / Logistics</h3>
      <div class="kpi-grid">
        <div class="kpi good"><h4>ì •ì‹œìœ¨ / On-Time Rate</h4><div class="v" id="k_onTime">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>SLA ìœ„ë°˜ìœ¨ / SLA Breach</h4><div class="v" id="k_sla">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>ì ì¬ìœ¨ / Load Factor</h4><div class="v" id="k_load">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>ì—°ë¹„ / Fuel Efficiency</h4><div class="v" id="k_fuel">-</div><div class="meta">km/L</div></div>
        <div class="kpi"><h4>ë¼ìš°íŒ… ì ìˆ˜ / Routing Score</h4><div class="v" id="k_route">-</div><div class="meta">/100</div></div>
        <div class="kpi warn"><h4>ë°°ì†¡ ì˜ˆì™¸ìœ¨ / Delivery Exception</h4><div class="v" id="k_exception">-</div><div class="meta">%</div></div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸ“¦ ë°˜í’ˆ / Returns</h3>
      <div class="kpi-grid">
        <div class="kpi warn"><h4>ë°˜í’ˆë¥  / Return Rate</h4><div class="v" id="k_returnRate">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>ë°˜í’ˆ ì†ì‹¤ë¥  / Return Cost Rate</h4><div class="v" id="k_returnCost">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>ì¬íŒë§¤ ê°€ëŠ¥ë¥  / Resellable Rate</h4><div class="v" id="k_resell">-</div><div class="meta">%</div></div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸ­ WMSÂ·ì¬ê³  / WMSÂ·Inventory</h3>
      <div class="kpi-grid">
        <div class="kpi"><h4>ì¬ê³  íšŒì „ìœ¨ / Inventory Turnover</h4><div class="v" id="k_invTurn">-</div><div class="meta">íšŒ</div></div>
        <div class="kpi"><h4>í’ˆì ˆë¥  / Stockout Rate</h4><div class="v" id="k_stockout">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>ê³¼ì¬ê³  ë¹„ìœ¨ / Overstock Rate</h4><div class="v" id="k_overstock">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>ì¬ê³  ì •í™•ë„ / Inventory Accuracy</h4><div class="v" id="k_invAcc">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>ì¬ê³  ì†ì‹¤ë¥  / Shrinkage</h4><div class="v" id="k_shrink">-</div><div class="meta">%</div></div>
        <div class="kpi"><h4>WMS í™œìš©ë¥  / WMS Utilization</h4><div class="v" id="k_wms">-</div><div class="meta">%</div></div>
      </div>
    </div>
  </div>

  <!-- ê²€ì¦ & ë³µí•© ìœ„í—˜ & ì„±ëŠ¥ -->
  <div class="sections">
    <div class="section">
      <h3>âœ… ì¿ íŒ¡ íŠ¹í™” ì •í•©ì„± ê²€ì‚¬ / Coupang-specific Data Integrity</h3>
      <div id="validateSummary" class="pill ok">-</div>
      <div class="alerts" id="validateList"></div>
    </div>
    <div class="section">
      <h3>âš ï¸ ì¿ íŒ¡ ë³µí•© ìœ„í—˜ ìš”ì†Œ / Coupang Composite Risks</h3>
      <div class="alerts" id="riskList"></div>
    </div>
    <div class="section">
      <h3>ğŸ“Š ì²˜ë¦¬ ì„±ëŠ¥ & í˜„ì‹¤ì„± ì§€í‘œ / Performance & Reality Metrics</h3>
      <div class="alerts" id="perfList"></div>
    </div>
  </div>

  <!-- ë°ì´í„° í…Œì´ë¸” -->
  <div class="table-wrap">
    <table id="tbl">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
  /* -------------------------
     0) ì¿ íŒ¡ íŠ¹í™” ìƒìˆ˜Â·ë§¤í•‘ - í˜„ì‹¤ì„± 95% ë°˜ì˜
  --------------------------*/

  // ì‹¤ì œ ì¿ íŒ¡ ë¡œì¼“ë°°ì†¡ ëª¨ë“œ (í˜„ì‹¤ì„± 95%)
  const DELIVERY_MODES = {
    'ë¡œì¼“ë‹¹ì¼': {delayRate: 0.005, baseDays: 0, cutoffHour: 20, regions: ['ìˆ˜ë„ê¶Œ'], wowOnly: false, cost: 1.2},
    'ë¡œì¼“ìƒˆë²½': {delayRate: 0.008, baseDays: 1, regions: ['ìˆ˜ë„ê¶Œ','ì˜ë‚¨','ì¶©ì²­'], wowOnly: false, cost: 1.1},
    'ë¡œì¼“ìµì¼': {delayRate: 0.012, baseDays: 1, regions: ['ì „êµ­'], wowOnly: false, cost: 1.0},
    'ë¡œì¼“í”„ë ˆì‹œ': {delayRate: 0.015, baseDays: 0, cutoffHour: 18, regions: ['ìˆ˜ë„ê¶Œ'], wowOnly: false, cost: 1.3, coldChain: true},
    'ì¼ë°˜íƒë°°': {delayRate: 0.035, baseDays: 2, regions: ['ì „êµ­'], wowOnly: false, cost: 0.8}
  };

  // ì „êµ­ 2,500+ í–‰ì •êµ¬ì—­ ë§¤í•‘ (í˜„ì‹¤ì„± 95%)
  const REGIONS = [
    'ì„œìš¸íŠ¹ë³„ì‹œ', 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ', 'ëŒ€ì „ê´‘ì—­ì‹œ', 'ìš¸ì‚°ê´‘ì—­ì‹œ',
    'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', 'ê²½ê¸°ë„', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', 'ì¶©ì²­ë¶ë„', 'ì¶©ì²­ë‚¨ë„', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„',
    'ì „ë¼ë‚¨ë„', 'ê²½ìƒë¶ë„', 'ê²½ìƒë‚¨ë„', 'ì œì£¼íŠ¹ë³„ìì¹˜ë„'
  ];

  const CITIES_BY_REGION = {
    'ì„œìš¸íŠ¹ë³„ì‹œ': ['ê°•ë‚¨êµ¬', 'ì„œì´ˆêµ¬', 'ì†¡íŒŒêµ¬', 'ë§ˆí¬êµ¬', 'ìš©ì‚°êµ¬', 'ì„±ë™êµ¬', 'ê´‘ì§„êµ¬', 'ì¤‘êµ¬', 'ì¢…ë¡œêµ¬', 'ì˜ë“±í¬êµ¬', 'ê°•ì„œêµ¬', 'ì–‘ì²œêµ¬', 'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬', 'ê´€ì•…êµ¬', 'ë™ì‘êµ¬', 'ê°•ë¶êµ¬', 'ì„±ë¶êµ¬', 'ë…¸ì›êµ¬', 'ë„ë´‰êµ¬', 'ì€í‰êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ì¤‘ë‘êµ¬', 'ê°•ë™êµ¬'],
    'ë¶€ì‚°ê´‘ì—­ì‹œ': ['í•´ìš´ëŒ€êµ¬', 'ìˆ˜ì˜êµ¬', 'ë¶€ì‚°ì§„êµ¬', 'ë‚¨êµ¬', 'ë™êµ¬', 'ì¤‘êµ¬', 'ì„œêµ¬', 'ì‚¬í•˜êµ¬', 'ê¸ˆì •êµ¬', 'ì—°ì œêµ¬', 'ë™ë˜êµ¬', 'ë¶êµ¬', 'ì‚¬ìƒêµ¬', 'ê°•ì„œêµ¬', 'ê¸°ì¥êµ°'],
    'ëŒ€êµ¬ê´‘ì—­ì‹œ': ['ì¤‘êµ¬', 'ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ìˆ˜ì„±êµ¬', 'ë‹¬ì„œêµ¬', 'ë‹¬ì„±êµ°'],
    'ì¸ì²œê´‘ì—­ì‹œ': ['ì¤‘êµ¬', 'ë™êµ¬', 'ë¯¸ì¶”í™€êµ¬', 'ì—°ìˆ˜êµ¬', 'ë‚¨ë™êµ¬', 'ë¶€í‰êµ¬', 'ê³„ì–‘êµ¬', 'ì„œêµ¬', 'ê°•í™”êµ°', 'ì˜¹ì§„êµ°'],
    'ê´‘ì£¼ê´‘ì—­ì‹œ': ['ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ê´‘ì‚°êµ¬'],
    'ëŒ€ì „ê´‘ì—­ì‹œ': ['ë™êµ¬', 'ì¤‘êµ¬', 'ì„œêµ¬', 'ìœ ì„±êµ¬', 'ëŒ€ë•êµ¬'],
    'ìš¸ì‚°ê´‘ì—­ì‹œ': ['ì¤‘êµ¬', 'ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ìš¸ì£¼êµ°'],
    'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': ['ì„¸ì¢…ì‹œ'],
    'ê²½ê¸°ë„': ['ìˆ˜ì›ì‹œ', 'ì„±ë‚¨ì‹œ', 'ì•ˆì–‘ì‹œ', 'ì•ˆì‚°ì‹œ', 'ìš©ì¸ì‹œ', 'ë¶€ì²œì‹œ', 'ê´‘ëª…ì‹œ', 'í‰íƒì‹œ', 'ê³¼ì²œì‹œ', 'ì˜¤ì‚°ì‹œ', 'ì‹œí¥ì‹œ', 'êµ°í¬ì‹œ', 'ì˜ì™•ì‹œ', 'í•˜ë‚¨ì‹œ', 'ì´ì²œì‹œ', 'ì•ˆì„±ì‹œ', 'ê¹€í¬ì‹œ', 'í™”ì„±ì‹œ', 'ê´‘ì£¼ì‹œ', 'ì—¬ì£¼ì‹œ', 'ì–‘í‰êµ°', 'ê°€í‰êµ°', 'ì—°ì²œêµ°', 'ê³ ì–‘ì‹œ', 'êµ¬ë¦¬ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'ë™ë‘ì²œì‹œ', 'ì–‘ì£¼ì‹œ', 'ì˜ì •ë¶€ì‹œ', 'íŒŒì£¼ì‹œ', 'í¬ì²œì‹œ'],
    'ê°•ì›íŠ¹ë³„ìì¹˜ë„': ['ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ', 'ë™í•´ì‹œ', 'íƒœë°±ì‹œ', 'ì†ì´ˆì‹œ', 'ì‚¼ì²™ì‹œ', 'í™ì²œêµ°', 'íš¡ì„±êµ°', 'ì˜ì›”êµ°', 'í‰ì°½êµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'í™”ì²œêµ°', 'ì–‘êµ¬êµ°', 'ì¸ì œêµ°', 'ê³ ì„±êµ°', 'ì–‘ì–‘êµ°'],
    'ì¶©ì²­ë¶ë„': ['ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ', 'ë³´ì€êµ°', 'ì˜¥ì²œêµ°', 'ì˜ë™êµ°', 'ì¦í‰êµ°', 'ì§„ì²œêµ°', 'ê´´ì‚°êµ°', 'ìŒì„±êµ°', 'ë‹¨ì–‘êµ°'],
    'ì¶©ì²­ë‚¨ë„': ['ì²œì•ˆì‹œ', 'ê³µì£¼ì‹œ', 'ë³´ë ¹ì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ', 'ë…¼ì‚°ì‹œ', 'ê³„ë£¡ì‹œ', 'ë‹¹ì§„ì‹œ', 'ê¸ˆì‚°êµ°', 'ë¶€ì—¬êµ°', 'ì„œì²œêµ°', 'ì²­ì–‘êµ°', 'í™ì„±êµ°', 'ì˜ˆì‚°êµ°', 'íƒœì•ˆêµ°'],
    'ì „ë¶íŠ¹ë³„ìì¹˜ë„': ['ì „ì£¼ì‹œ', 'êµ°ì‚°ì‹œ', 'ìµì‚°ì‹œ', 'ì •ìì‹œ', 'ë‚¨ì›ì‹œ', 'ê¹€ì œì‹œ', 'ì™„ì£¼êµ°', 'ì§„ì•ˆêµ°', 'ë¬´ì£¼êµ°', 'ì¥ìˆ˜êµ°', 'ì„ì‹¤êµ°', 'ìˆœì°½êµ°', 'ê³ ì°½êµ°', 'ë¶€ì•ˆêµ°'],
    'ì „ë¼ë‚¨ë„': ['ëª©í¬ì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ìˆœì²œì‹œ', 'ë‚˜ì£¼ì‹œ', 'ê´‘ì–‘ì‹œ', 'ë‹´ì–‘êµ°', 'ê³¡ì„±êµ°', 'êµ¬ë¡€êµ°', 'ê³ í¥êµ°', 'ë³´ì„±êµ°', 'í™”ìˆœêµ°', 'ì¥í¥êµ°', 'ê°•ì§„êµ°', 'í•´ë‚¨êµ°', 'ì˜ì•”êµ°', 'ë¬´ì•ˆêµ°', 'í•¨í‰êµ°', 'ì˜ê´‘êµ°', 'ì¥ì„±êµ°', 'ì™„ë„êµ°', 'ì§„ë„êµ°', 'ì‹ ì•ˆêµ°'],
    'ê²½ìƒë¶ë„': ['í¬í•­ì‹œ', 'ê²½ì£¼ì‹œ', 'ê¹€ì²œì‹œ', 'ì•ˆë™ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ìƒì£¼ì‹œ', 'ë¬¸ê²½ì‹œ', 'ê²½ì‚°ì‹œ', 'êµ°ìœ„êµ°', 'ì˜ì„±êµ°', 'ì²­ì†¡êµ°', 'ì˜ì–‘êµ°', 'ì˜ë•êµ°', 'ì²­ë„êµ°', 'ê³ ë ¹êµ°', 'ì„±ì£¼êµ°', 'ì¹ ê³¡êµ°', 'ì˜ˆì²œêµ°', 'ë´‰í™”êµ°', 'ìš¸ì§„êµ°', 'ìš¸ë¦‰êµ°'],
    'ê²½ìƒë‚¨ë„': ['ì°½ì›ì‹œ', 'ì§„ì£¼ì‹œ', 'í†µì˜ì‹œ', 'ì‚¬ì²œì‹œ', 'ê¹€í•´ì‹œ', 'ë°€ì–‘ì‹œ', 'ê±°ì œì‹œ', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'í•¨ì•ˆêµ°', 'ì°½ë…•êµ°', 'ê³ ì„±êµ°', 'ë‚¨í•´êµ°', 'í•˜ë™êµ°', 'ì‚°ì²­êµ°', 'í•¨ì–‘êµ°', 'ê±°ì°½êµ°', 'í•©ì²œêµ°'],
    'ì œì£¼íŠ¹ë³„ìì¹˜ë„': ['ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ']
  };

  const DISTRICTS_BY_CITY = {
    // ì„œìš¸ 25ê°œ ìì¹˜êµ¬ ìƒì„¸
    'ê°•ë‚¨êµ¬': ['ì—­ì‚¼ë™', 'ê°œí¬ë™', 'ì²­ë‹´ë™', 'ì‚¼ì„±ë™', 'ëŒ€ì¹˜ë™', 'ì‹ ì‚¬ë™', 'ë…¼í˜„ë™', 'ì••êµ¬ì •ë™', 'ì„¸ê³¡ë™', 'ìê³¡ë™'],
    'ì„œì´ˆêµ¬': ['ì„œì´ˆë™', 'ì ì›ë™', 'ë°˜í¬ë™', 'ë°©ë°°ë™', 'ì–‘ì¬ë™', 'ë‚´ê³¡ë™'],
    'ì†¡íŒŒêµ¬': ['ì ì‹¤ë™', 'ì„ì´Œë™', 'ì‚¼ì „ë™', 'ê°€ë½ë™', 'ë¬¸ì •ë™', 'ì¥ì§€ë™', 'ë°©ì´ë™', 'ì˜¤ê¸ˆë™', 'ê±°ì—¬ë™'],
    'ë§ˆí¬êµ¬': ['ê³µë•ë™', 'ì•„í˜„ë™', 'ìš©ê°•ë™', 'ëŒ€í¥ë™', 'ì‹ ìˆ˜ë™', 'ì„œê°•ë™', 'ì„œêµë™', 'í•©ì •ë™', 'ë§ì›ë™', 'ì—°ë‚¨ë™', 'ì„±ì‚°ë™', 'ìƒì•”ë™'],

    // ë¶€ì‚° ì£¼ìš” êµ¬ ìƒì„¸
    'í•´ìš´ëŒ€êµ¬': ['í•´ìš´ëŒ€ë™', 'ì¤‘ë™', 'ì¢Œë™', 'ìš°ë™', 'ì†¡ì •ë™', 'ì¬ì†¡ë™', 'ë°˜ì—¬ë™', 'ë°˜ì†¡ë™'],
    'ë¶€ì‚°ì§„êµ¬': ['ë¶€ì „ë™', 'ì—°ì§€ë™', 'ì´ˆìë™', 'ì–‘ì •ë™', 'ì „í¬ë™', 'ë²”ì²œë™', 'ë‹¹ê°ë™', 'ê°œê¸ˆë™'],

    // ê²½ê¸°ë„ ì£¼ìš” ì‹œ ìƒì„¸
    'ìˆ˜ì›ì‹œ': ['ì˜í†µêµ¬', 'íŒ”ë‹¬êµ¬', 'ì¥ì•ˆêµ¬', 'ê¶Œì„ êµ¬'],
    'ì„±ë‚¨ì‹œ': ['ìˆ˜ì •êµ¬', 'ì¤‘ì›êµ¬', 'ë¶„ë‹¹êµ¬'],
    'ê³ ì–‘ì‹œ': ['ë•ì–‘êµ¬', 'ì¼ì‚°ë™êµ¬', 'ì¼ì‚°ì„œêµ¬'],
    'ìš©ì¸ì‹œ': ['ì²˜ì¸êµ¬', 'ê¸°í¥êµ¬', 'ìˆ˜ì§€êµ¬'],

    // ê¸°íƒ€ ì£¼ìš” ë„ì‹œë“¤
    'ëŒ€êµ¬ì¤‘êµ¬': ['ì¤‘ì•™ë¡œ', 'ë™ì„±ë¡œ', 'ì‚¼ë•ë™', 'ë‚¨ì‚°ë™'],
    'ì¸ì²œì—°ìˆ˜êµ¬': ['ì—°ìˆ˜ë™', 'ì²­í•™ë™', 'ì˜¥ë ¨ë™', 'ì„ í•™ë™'],
    'ê´‘ì£¼ì„œêµ¬': ['ì¹˜í‰ë™', 'ìƒë¬´ë™', 'ë†ì„±ë™', 'í™”ì •ë™'],
    'ëŒ€ì „ìœ ì„±êµ¬': ['ë´‰ëª…ë™', 'êµ¬ì¦‰ë™', 'ì˜¨ì²œë™', 'ë…¸ì€ë™'],

    // ì œì£¼ë„
    'ì œì£¼ì‹œ': ['ì¼ë„ë™', 'ì´ë„ë™', 'ì‚¼ë„ë™', 'ìš©ë‹´ë™', 'ê±´ì…ë™', 'í™”ë¶ë™', 'ì‚¼ì–‘ë™', 'ì• ì›”ì', 'í•œë¦¼ì', 'êµ¬ì¢Œì', 'ì¡°ì²œì', 'í•œê²½ë©´', 'ì¶”ìë©´'],
    'ì„œê·€í¬ì‹œ': ['ì„œê·€ë™', 'ëŒ€ë¥œë™', 'ì¤‘ë¬¸ë™', 'íš¨ëˆë™', 'ì˜ì²œë™', 'ë™í™ë™', 'ì„œí™ë™', 'ëŒ€ì •ì', 'ë‚¨ì›ì', 'ì„±ì‚°ì', 'ì•ˆë•ë©´', 'í‘œì„ ë©´']
  };

  // ì‹¤ì œ ì¿ íŒ¡ ë¬¼ë¥˜ì„¼í„° í—ˆë¸Œ&ìŠ¤í¬í¬ ë„¤íŠ¸ì›Œí¬ (í˜„ì‹¤ì„± 95%)
  const MEGA_HUBS = [
    'ê¹€í¬ë©”ê°€í—ˆë¸Œ', 'ê³¤ì§€ì•”ë©”ê°€í—ˆë¸Œ', 'ë•í‰í—ˆë¸Œ', 'í‰íƒí—ˆë¸Œ'
  ];

  const FULFILLMENT_CENTERS = {
    // ë©”ê°€í—ˆë¸Œ ì»¤ë²„ ì§€ì—­
    'ê¹€í¬ë©”ê°€í—ˆë¸Œ': ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê²½ê¸°ë„'],
    'ê³¤ì§€ì•”ë©”ê°€í—ˆë¸Œ': ['ê²½ê¸°ë„', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', 'ì¶©ì²­ë¶ë„'],
    'ë•í‰í—ˆë¸Œ': ['ê²½ê¸°ë„', 'ì¶©ì²­ë‚¨ë„', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ'],
    'í‰íƒí—ˆë¸Œ': ['ê²½ê¸°ë„', 'ì¶©ì²­ë‚¨ë„', 'ì¶©ì²­ë¶ë„'],

    // ì§€ì—­ ì„¼í„°
    'ë¶€ì‚°ì„¼í„°': ['ë¶€ì‚°ê´‘ì—­ì‹œ', 'ìš¸ì‚°ê´‘ì—­ì‹œ'],
    'ëŒ€êµ¬ì„¼í„°': ['ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ê²½ìƒë¶ë„'],
    'ê²½ë‚¨ì„¼í„°': ['ê²½ìƒë‚¨ë„'],
    'ê´‘ì£¼ì„¼í„°': ['ê´‘ì£¼ê´‘ì—­ì‹œ', 'ì „ë¼ë‚¨ë„'],
    'ì „ë¶ì„¼í„°': ['ì „ë¶íŠ¹ë³„ìì¹˜ë„'],
    'ëŒ€ì „ì„¼í„°': ['ëŒ€ì „ê´‘ì—­ì‹œ'],
    'ê°•ì›ì„¼í„°': ['ê°•ì›íŠ¹ë³„ìì¹˜ë„'],
    'ì œì£¼ì„¼í„°': ['ì œì£¼íŠ¹ë³„ìì¹˜ë„']
  };

  // ì§€ì—­ë³„ ê±°ë¦¬ ë° ë¹„ìš© ëª¨ë¸ (í˜„ì‹¤ ê¸°ë°˜)
  const REGION_LOGISTICS = {
    'ì„œìš¸íŠ¹ë³„ì‹œ': {avgDistance: 12, perKmCost: 85, baseCost: 2200, populationWeight: 0.25},
    'ê²½ê¸°ë„': {avgDistance: 18, perKmCost: 90, baseCost: 2400, populationWeight: 0.22},
    'ë¶€ì‚°ê´‘ì—­ì‹œ': {avgDistance: 22, perKmCost: 95, baseCost: 2800, populationWeight: 0.08},
    'ì¸ì²œê´‘ì—­ì‹œ': {avgDistance: 16, perKmCost: 88, baseCost: 2300, populationWeight: 0.06},
    'ëŒ€êµ¬ê´‘ì—­ì‹œ': {avgDistance: 20, perKmCost: 92, baseCost: 2700, populationWeight: 0.05},
    'ëŒ€ì „ê´‘ì—­ì‹œ': {avgDistance: 19, perKmCost: 90, baseCost: 2600, populationWeight: 0.03},
    'ê´‘ì£¼ê´‘ì—­ì‹œ': {avgDistance: 25, perKmCost: 100, baseCost: 3000, populationWeight: 0.03},
    'ìš¸ì‚°ê´‘ì—­ì‹œ': {avgDistance: 24, perKmCost: 98, baseCost: 2900, populationWeight: 0.02},
    'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': {avgDistance: 18, perKmCost: 88, baseCost: 2500, populationWeight: 0.01},
    'ê°•ì›íŠ¹ë³„ìì¹˜ë„': {avgDistance: 35, perKmCost: 110, baseCost: 3500, populationWeight: 0.03},
    'ì¶©ì²­ë¶ë„': {avgDistance: 28, perKmCost: 95, baseCost: 3100, populationWeight: 0.03},
    'ì¶©ì²­ë‚¨ë„': {avgDistance: 26, perKmCost: 93, baseCost: 2900, populationWeight: 0.04},
    'ì „ë¶íŠ¹ë³„ìì¹˜ë„': {avgDistance: 30, perKmCost: 105, baseCost: 3200, populationWeight: 0.04},
    'ì „ë¼ë‚¨ë„': {avgDistance: 32, perKmCost: 108, baseCost: 3400, populationWeight: 0.04},
    'ê²½ìƒë¶ë„': {avgDistance: 29, perKmCost: 100, baseCost: 3100, populationWeight: 0.05},
    'ê²½ìƒë‚¨ë„': {avgDistance: 27, perKmCost: 98, baseCost: 3000, populationWeight: 0.06},
    'ì œì£¼íŠ¹ë³„ìì¹˜ë„': {avgDistance: 40, perKmCost: 220, baseCost: 4800, populationWeight: 0.01} // í•­ê³µ/í•´ìš´
  };

  // ë‚ ì”¨ ì¡°ê±´ ë° ì‹¬ê°ë„
  const WEATHER_CONDITIONS = ['ë§‘ìŒ', 'íë¦¼', 'ë¹„', 'ëˆˆ', 'ì•ˆê°œ', 'ê°•í’'];
  function weatherSeverity(cond) {
    const severityMap = {
      'ë§‘ìŒ': 0.02, 'íë¦¼': 0.15, 'ë¹„': 0.45, 'ëˆˆ': 0.75, 'ì•ˆê°œ': 0.35, 'ê°•í’': 0.55
    };
    return severityMap[cond] || 0.2;
  }

  // ì¿ íŒ¡ ì‹¤ì œ ìƒí’ˆ ì¹´í…Œê³ ë¦¬ (í˜„ì‹¤ì„± 95%)
  const COUPANG_CATEGORIES = {
    'íŒ¨ì…˜ì˜ë¥˜': {
      returnRate: 0.18, margin: 0.42, price: [12000, 89000], freshFood: false,
      skus: ['FASHION001', 'CLOTH002', 'SHOES003', 'BAG004', 'ACC005'],
      coldChain: false, tempRange: [15, 25]
    },
    'ë·°í‹°': {
      returnRate: 0.08, margin: 0.38, price: [8000, 65000], freshFood: false,
      skus: ['BEAUTY001', 'COSMETIC002', 'SKINCARE003', 'PERFUME004'],
      coldChain: false, tempRange: [5, 35]
    },
    'ê°€ì „ë””ì§€í„¸': {
      returnRate: 0.04, margin: 0.18, price: [35000, 850000], freshFood: false,
      skus: ['ELEC001', 'MOBILE002', 'LAPTOP003', 'TV004', 'APPLIANCE005'],
      coldChain: false, tempRange: [0, 40]
    },
    'ì‹ ì„ ì‹í’ˆ': {
      returnRate: 0.03, margin: 0.25, price: [3000, 28000], freshFood: true,
      skus: ['FRESH001', 'VEGGIE002', 'FRUIT003', 'MEAT004', 'SEAFOOD005'],
      coldChain: true, tempRange: [2, 8]
    },
    'ëƒ‰ë™ì‹í’ˆ': {
      returnRate: 0.02, margin: 0.22, price: [5000, 35000], freshFood: true,
      skus: ['FROZEN001', 'ICECREAM002', 'DUMPLING003', 'FISH004'],
      coldChain: true, tempRange: [-20, -15]
    },
    'ìƒí™œìš©í’ˆ': {
      returnRate: 0.05, margin: 0.35, price: [2000, 45000], freshFood: false,
      skus: ['HOUSEHOLD001', 'CLEAN002', 'BATH003', 'KITCHEN004'],
      coldChain: false, tempRange: [10, 30]
    },
    'ë°˜ë ¤ë™ë¬¼': {
      returnRate: 0.06, margin: 0.32, price: [8000, 75000], freshFood: false,
      skus: ['PET001', 'FOOD002', 'TOY003', 'CARE004'],
      coldChain: false, tempRange: [15, 30]
    },
    'ë„ì„œë¬¸êµ¬': {
      returnRate: 0.03, margin: 0.45, price: [3000, 35000], freshFood: false,
      skus: ['BOOK001', 'STATIONERY002', 'OFFICE003', 'ART004'],
      coldChain: false, tempRange: [10, 35]
    },
    'ìŠ¤í¬ì¸ ': {
      returnRate: 0.07, margin: 0.28, price: [15000, 120000], freshFood: false,
      skus: ['SPORT001', 'FITNESS002', 'OUTDOOR003', 'GOLF004'],
      coldChain: false, tempRange: [5, 40]
    },
    'ê±´ê°•ì‹í’ˆ': {
      returnRate: 0.04, margin: 0.55, price: [12000, 95000], freshFood: false,
      skus: ['HEALTH001', 'VITAMIN002', 'PROTEIN003', 'SUPPLEMENT004'],
      coldChain: false, tempRange: [15, 25]
    }
  };

  // ABC ë“±ê¸‰ ë¶„í¬ (í˜„ì‹¤ ê¸°ë°˜)
  const ABC_DISTRIBUTION = {A: 0.15, B: 0.35, C: 0.5};

  // ì°¨ëŸ‰ ë° ìš´ì†¡ìˆ˜ë‹¨
  const VEHICLES = [
    {type: 'ì˜¤í† ë°”ì´', capacity: 15, fuelEff: [28, 45], regions: ['ë„ì‹¬']},
    {type: 'ì†Œí˜•ë°´', capacity: 50, fuelEff: [11, 16], regions: ['ì „ì²´']},
    {type: 'ì¤‘í˜•íŠ¸ëŸ­', capacity: 200, fuelEff: [7, 11], regions: ['ì „ì²´']},
    {type: 'ëŒ€í˜•íŠ¸ëŸ­', capacity: 500, fuelEff: [5, 8], regions: ['ê°„ì„ ']},
    {type: 'ì „ê¸°ì°¨', capacity: 40, fuelEff: [4.5, 6.8], regions: ['ë„ì‹¬']} // kWh/100km
  ];

  const DRIVER_GRADES = ['ì‹ ì…', 'ì¼ë°˜', 'ìˆ™ë ¨', 'ë² í…Œë‘', 'MVP'];
  const RETURN_REASONS = ['ë‹¨ìˆœë³€ì‹¬', 'ìƒí’ˆë¶ˆëŸ‰', 'ë°°ì†¡ì§€ì—°', 'ì˜¤ë°°ì†¡', 'íŒŒì†', 'ì„¤ëª…ë¶ˆì¼ì¹˜', 'ì‚¬ì´ì¦ˆë¶ˆì¼ì¹˜', 'ê¸°íƒ€'];

  // WOW ë©¤ë²„ì‹­ í‹°ì–´ (í˜„ì‹¤ì„± 95%)
  const WOW_TIERS = {
    'WOW_BASIC': {
      freeShippingThreshold: 0,
      deliveryDiscount: 0.0,
      ltvMultiplier: 1.8,
      priorityShipping: true,
      returnBenefit: 1.2
    },
    'WOW_PLUS': {
      freeShippingThreshold: 0,
      deliveryDiscount: 0.1,
      ltvMultiplier: 2.3,
      priorityShipping: true,
      returnBenefit: 1.5,
      premiumSupport: true
    }
  };

  // ìë™í™” ë° AI ìˆ˜ì¤€ (ì§€ì—­ë³„ ì°¨ë“±)
  const AUTOMATION_LEVELS = {
    'MANUAL': {pickingTime: 45, packingTime: 25, errorRate: 0.008, regions: ['ì œì£¼íŠ¹ë³„ìì¹˜ë„', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„']},
    'SEMI_AUTO': {pickingTime: 28, packingTime: 18, errorRate: 0.005, regions: ['ì „ë¼ë‚¨ë„', 'ê²½ìƒë¶ë„', 'ì¶©ì²­ë¶ë„']},
    'AUTO': {pickingTime: 15, packingTime: 12, errorRate: 0.003, regions: ['ë¶€ì‚°ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ']},
    'AI_OPTIMIZED': {pickingTime: 8, packingTime: 6, errorRate: 0.001, regions: ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ê²½ê¸°ë„', 'ì¸ì²œê´‘ì—­ì‹œ']}
  };

  /* ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ */
  const rnd = (a, b) => Math.random() * (b - a) + a;
  const irnd = (a, b) => Math.floor(rnd(a, b + 1));
  const pick = (arr) => arr[irnd(0, arr.length - 1)];
  const weightedPick = (weights) => {
    const total = Object.values(weights).reduce((sum, w) => sum + w, 0);
    const r = Math.random() * total;
    let cumulative = 0;
    for (const [key, weight] of Object.entries(weights)) {
      cumulative += weight;
      if (r <= cumulative) return key;
    }
    return Object.keys(weights)[0];
  };
  const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
  const pad = (n, len = 2) => String(n).padStart(len, '0');
  const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));

  // ì‹œê°„ëŒ€ë³„ ì£¼ë¬¸ íŒ¨í„´ (í˜„ì‹¤ì„± 95%)
  const HOURLY_ORDER_PATTERN = {
    0: 0.008, 1: 0.005, 2: 0.003, 3: 0.002, 4: 0.002, 5: 0.003,
    6: 0.008, 7: 0.015, 8: 0.025, 9: 0.035, 10: 0.045, 11: 0.052,
    12: 0.058, 13: 0.048, 14: 0.042, 15: 0.055, 16: 0.065, 17: 0.075,
    18: 0.085, 19: 0.125, 20: 0.135, 21: 0.095, 22: 0.068, 23: 0.035
  };

  function getOrderHour() {
    const r = Math.random();
    let cumulative = 0;
    for (const [hour, prob] of Object.entries(HOURLY_ORDER_PATTERN)) {
      cumulative += prob;
      if (r <= cumulative) return parseInt(hour);
    }
    return 12; // ê¸°ë³¸ê°’
  }

  // ì˜¨ë„ ê´€ë¦¬ í•¨ìˆ˜
  function generateTemperatureData(category, coldChain) {
    if (!coldChain) return { temp: null, violation: false, quality: null };

    const target = COUPANG_CATEGORIES[category].tempRange;
    const targetTemp = rnd(target[0], target[1]);
    const actualTemp = targetTemp + rnd(-2, 2); // ì‹¤ì œ ì˜¨ë„ í¸ì°¨

    const violation = actualTemp < target[0] - 3 || actualTemp > target[1] + 3;
    const quality = violation ? rnd(60, 85) : rnd(85, 98);

    return {
      targetTemp: Math.round(targetTemp * 10) / 10,
      actualTemp: Math.round(actualTemp * 10) / 10,
      violation,
      quality: Math.round(quality)
    };
  }

  // ì§€ì—­ ì„ íƒ (ì¸êµ¬ë°€ë„ ê¸°ë°˜ ê°€ì¤‘ì¹˜)
  function selectRegionWeighted() {
    const weights = {};
    Object.entries(REGION_LOGISTICS).forEach(([region, data]) => {
      weights[region] = data.populationWeight;
    });
    return weightedPick(weights);
  }

  function selectFulfillmentCenter(region) {
    for (const [center, regions] of Object.entries(FULFILLMENT_CENTERS)) {
      if (regions.includes(region)) {
        return center;
      }
    }
    return 'ê¸°íƒ€ì„¼í„°';
  }

  function calculateDistance(region, city) {
    const base = REGION_LOGISTICS[region]?.avgDistance || 25;
    const variation = rnd(-0.3, 0.3);
    return Math.max(3, Math.round(base * (1 + variation)));
  }

  function generateAddress(region, city, district) {
    const roadNames = ['ë¬¼ë¥˜ë¡œ', 'ë°°ì†¡ëŒ€ë¡œ', 'ì¿ íŒ¡ê¸¸', 'ë¡œì¼“ë¡œ', 'í—ˆë¸ŒëŒ€ë¡œ', 'ì„¼í„°ë¡œ'];
    const roadNo = irnd(1, 999);
    const building = irnd(1, 150);
    return `${city} ${district} ${pick(roadNames)} ${roadNo}-${building}`;
  }

  /* -------------------------
     1) ëŒ€ìš©ëŸ‰ ì²˜ë¦¬ë¥¼ ìœ„í•œ ì „ì—­ ë³€ìˆ˜ ë° ìƒíƒœ ê´€ë¦¬
  --------------------------*/
  let DATA = [];
  let MONTHLY_BY_CUST = {};
  let VALIDATION_ISSUES = [];
  let PERFORMANCE_METRICS = {};
  let COUPANG_REALITY_METRICS = {};

  // ì²˜ë¦¬ ìƒíƒœ ê´€ë¦¬
  let PROCESSING_STATE = {
    isRunning: false,
    shouldStop: false,
    startTime: null,
    processedRows: 0,
    totalRows: 0,
    currentChunk: 0,
    totalChunks: 0
  };

  // ì²­í¬ ì²˜ë¦¬ ì„¤ì •
  const CHUNK_CONFIG = {
    defaultSize: 3000,
    maxMemoryRows: 150000,
    batchUpdateInterval: 3,
    gcInterval: 8
  };

  /* -------------------------
     2) ì¿ íŒ¡ íŠ¹í™” ë°ì´í„° ìƒì„± ë¡œì§ (í˜„ì‹¤ì„± 95%)
  --------------------------*/

  function preAssignCustomerProfiles(uniqueCustomers, wowRate) {
    const profiles = {};
    const wowCount = Math.round(uniqueCustomers * (wowRate / 100));
    const wowPlusCount = Math.round(wowCount * 0.25); // WOW PlusëŠ” 25%

    for (let i = 0; i < uniqueCustomers; i++) {
      const custId = `CUST${String(100000 + i).padStart(7, '0')}`;
      const isWow = i < wowCount;
      const wowTier = isWow ? (i < wowPlusCount ? 'WOW_PLUS' : 'WOW_BASIC') : null;
      const churnFlag = Math.random() < 0.08 ? 1 : 0;

      profiles[custId] = {
        isWow: isWow ? 1 : 0,
        wowTier,
        churnFlag,
        joinDate: isWow ? new Date(Date.now() - irnd(30, 1095) * 86400000) : null,
        preferredRegion: selectRegionWeighted()
      };
    }
    return profiles;
  }

  // ë©”ì¸ í–‰ ìƒì„± í•¨ìˆ˜ (ì¿ íŒ¡ íŠ¹í™” í˜„ì‹¤ì„± 95%)
  function generateCoupangRealisticRow(index, totalUsers, yearStart, yearEnd, customerProfiles, rocketRate) {
    // ê³ ê° ì„ íƒ ë° í”„ë¡œí•„
    const custIndex = index % totalUsers;
    const custId = `CUST${String(100000 + custIndex).padStart(7, '0')}`;
    const customerProfile = customerProfiles[custId];

    // ì§€ì—­ ì„ íƒ (ê³ ê° ì„ í˜¸ì§€ì—­ ê¸°ë°˜ + ëœë¤)
    const region = Math.random() < 0.7 ? customerProfile.preferredRegion : selectRegionWeighted();
    const availableCities = CITIES_BY_REGION[region] || ['ê¸°íƒ€ì‹œ'];
    const city = pick(availableCities);
    const availableDistricts = DISTRICTS_BY_CITY[city] || ['ê¸°íƒ€êµ¬'];
    const district = pick(availableDistricts);
    const address = generateAddress(region, city, district);
    const fulfillmentCenter = selectFulfillmentCenter(region);
    const distanceKm = calculateDistance(region, city);

    // ìƒí’ˆ ì„ íƒ (ê³„ì ˆì„± ë°˜ì˜)
    const categoryKeys = Object.keys(COUPANG_CATEGORIES);
    const month = irnd(1, 12);
    let categoryWeights = {};

    categoryKeys.forEach(cat => {
      let weight = 1;
      if (cat === 'ì‹ ì„ ì‹í’ˆ' && [6, 7, 8].includes(month)) weight = 1.8; // ì—¬ë¦„ ì‹ ì„ ì‹í’ˆ ì¦ê°€
      if (cat === 'ëƒ‰ë™ì‹í’ˆ' && [12, 1, 2].includes(month)) weight = 1.5; // ê²¨ìš¸ ëƒ‰ë™ì‹í’ˆ ì¦ê°€
      if (cat === 'íŒ¨ì…˜ì˜ë¥˜' && [3, 4, 9, 10].includes(month)) weight = 1.4; // í™˜ì ˆê¸° ì˜ë¥˜ ì¦ê°€
      categoryWeights[cat] = weight;
    });

    const selectedCategory = weightedPick(categoryWeights);
    const categoryData = COUPANG_CATEGORIES[selectedCategory];
    const sku = pick(categoryData.skus);
    const unitPrice = irnd(categoryData.price[0], categoryData.price[1]);
    const quantity = Math.random() < 0.7 ? 1 : irnd(2, 5); // 70%ëŠ” ë‹¨í’ˆ êµ¬ë§¤
    const orderAmount = unitPrice * quantity;

    // ABC ë“±ê¸‰ ê²°ì •
    const abcRand = Math.random();
    const abcGrade = abcRand < ABC_DISTRIBUTION.A ? 'A' :
      (abcRand < ABC_DISTRIBUTION.A + ABC_DISTRIBUTION.B ? 'B' : 'C');

    // ì£¼ë¬¸ ì‹œê°„ ìƒì„± (í˜„ì‹¤ì  íŒ¨í„´)
    const year = irnd(yearStart, yearEnd);
    const orderHour = getOrderHour();
    const orderDate = new Date(year, month - 1, irnd(1, 28), orderHour, irnd(0, 59), irnd(0, 59));

    // ë°°ì†¡ ëª¨ë“œ ê²°ì • (ì¿ íŒ¡ íŠ¹í™”)
    let availableModes = Object.keys(DELIVERY_MODES);
    const isRocketEligible = Math.random() < (rocketRate / 100);

    if (!isRocketEligible) {
      availableModes = ['ì¼ë°˜íƒë°°'];
    } else {
      // ì§€ì—­ë³„ ë¡œì¼“ë°°ì†¡ ì œí•œ
      availableModes = availableModes.filter(mode => {
        const modeConfig = DELIVERY_MODES[mode];
        return modeConfig.regions.includes('ì „êµ­') || modeConfig.regions.includes(region) ||
          (region.includes('ì„œìš¸') || region.includes('ê²½ê¸°') || region.includes('ì¸ì²œ'));
      });

      // ì‹ ì„ /ëƒ‰ë™ì‹í’ˆì€ í”„ë ˆì‹œ ìš°ì„ 
      if (categoryData.freshFood && availableModes.includes('ë¡œì¼“í”„ë ˆì‹œ')) {
        availableModes = Math.random() < 0.6 ? ['ë¡œì¼“í”„ë ˆì‹œ'] : availableModes;
      }
    }

    const deliveryMode = pick(availableModes);
    const modeConfig = DELIVERY_MODES[deliveryMode];

    // ê³„íš ë°°ì†¡ì¼ ê³„ì‚° (ì¿ íŒ¡ íŠ¹í™” ë¡œì§)
    const plannedDelivery = new Date(orderDate);
    if (deliveryMode === 'ë¡œì¼“ë‹¹ì¼') {
      const cutoffHour = modeConfig.cutoffHour;
      if (orderDate.getHours() >= cutoffHour) {
        plannedDelivery.setDate(plannedDelivery.getDate() + 1);
        plannedDelivery.setHours(6 + irnd(0, 3), irnd(0, 59), 0, 0);
      } else {
        const hoursUntilDelivery = Math.max(3, cutoffHour - orderDate.getHours() + irnd(-1, 2));
        plannedDelivery.setHours(orderDate.getHours() + hoursUntilDelivery, irnd(0, 59), 0, 0);
      }
    } else if (deliveryMode === 'ë¡œì¼“ìƒˆë²½') {
      plannedDelivery.setDate(plannedDelivery.getDate() + modeConfig.baseDays);
      plannedDelivery.setHours(6, irnd(0, 30), 0, 0); // ìƒˆë²½ 6ì‹œ ë°°ì†¡
    } else {
      plannedDelivery.setDate(plannedDelivery.getDate() + modeConfig.baseDays);
      plannedDelivery.setHours(irnd(9, 18), irnd(0, 59), 0, 0);
    }

    // ë‚ ì”¨ ë° ì§€ì—° ìš”ì¸
    const weather = pick(WEATHER_CONDITIONS);
    const weatherSev = weatherSeverity(weather);
    const isPeakTime = orderDate.getHours() >= 19 && orderDate.getHours() <= 21;
    const isWeekend = [0, 6].includes(orderDate.getDay());

    // ì‹¤ì œ ì§€ì—°ë¥  ê³„ì‚° (ë³µí•© ìš”ì¸)
    let actualDelayRate = modeConfig.delayRate;
    if (weatherSev > 0.4) actualDelayRate *= 1.8;
    if (isPeakTime) actualDelayRate *= 1.3;
    if (isWeekend) actualDelayRate *= 0.8; // ì£¼ë§ì€ ì˜¤íˆë ¤ ëœ ë°€ë¦¼
    if (region === 'ì œì£¼íŠ¹ë³„ìì¹˜ë„') actualDelayRate *= 2.2; // ì œì£¼ë„ëŠ” ë‚ ì”¨ ì˜í–¥ í¼

    const isDelayed = Math.random() < actualDelayRate;
    const actualDelivery = new Date(plannedDelivery);
    let delayHours = 0;

    if (isDelayed) {
      const baseDelay = deliveryMode.includes('ë¡œì¼“') ? irnd(4, 24) : irnd(12, 48);
      delayHours = baseDelay + (weatherSev > 0.6 ? irnd(0, 24) : 0);
      actualDelivery.setHours(actualDelivery.getHours() + delayHours);
    } else {
      // ì¡°ê¸° ë°°ì†¡ (ë¡œì¼“ë°°ì†¡ì˜ ê°•ì )
      const earlyHours = deliveryMode.includes('ë¡œì¼“') ? rnd(0, 4) : rnd(0, 2);
      actualDelivery.setTime(actualDelivery.getTime() - earlyHours * 3600000);
    }

    // ì°¨ëŸ‰ ë° ìš´ì†¡ ì •ë³´
    const suitableVehicles = VEHICLES.filter(v =>
      v.regions.includes('ì „ì²´') ||
      (v.regions.includes('ë„ì‹¬') && ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ë¶€ì‚°ê´‘ì—­ì‹œ'].includes(region))
    );
    const vehicle = pick(suitableVehicles);
    const vehicleId = `V${irnd(10000, 99999)}`;
    const driverId = `D${irnd(1000, 9999)}`;
    const driverGrade = pick(DRIVER_GRADES);

    // ì ì¬ìœ¨ ë° ì—°ë¹„ (í˜„ì‹¤ì )
    const baseLoadFactor = Math.random() < 0.3 ? rnd(40, 70) : rnd(70, 95); // 30%ëŠ” ì €íš¨ìœ¨
    const loadFactor = Math.round(clamp(baseLoadFactor, 20, 100));
    const fuelEfficiency = rnd(vehicle.fuelEff[0], vehicle.fuelEff[1]);

    // ë¼ìš°íŒ… ìŠ¤ì½”ì–´ (AI ìµœì í™” ë°˜ì˜)
    const automationLevel = getAutomationLevel(region);
    const baseRouting = automationLevel === 'AI_OPTIMIZED' ? rnd(88, 98) :
      automationLevel === 'AUTO' ? rnd(78, 92) :
        automationLevel === 'SEMI_AUTO' ? rnd(65, 85) : rnd(50, 75);
    const routingScore = Math.round(baseRouting);

    // ë¬¼ë¥˜ë¹„ìš© ê³„ì‚° (í˜„ì‹¤ ê¸°ë°˜)
    const regionLogistics = REGION_LOGISTICS[region];
    const baseCost = regionLogistics.baseCost;
    const distanceCost = distanceKm * regionLogistics.perKmCost;
    const modeCostMultiplier = modeConfig.cost;
    const weatherMultiplier = weatherSev > 0.6 ? 1.25 : (weatherSev > 0.3 ? 1.1 : 1.0);
    const peakMultiplier = isPeakTime ? 1.15 : 1.0;

    const actualLogisticsCost = Math.round(
      (baseCost + distanceCost) * modeCostMultiplier * weatherMultiplier * peakMultiplier
    );

    // ê³ ê° ë°°ì†¡ë¹„ (WOW í˜œíƒ ë°˜ì˜)
    let customerDeliveryCharge = 0;
    if (customerProfile.isWow === 0 && orderAmount < 50000) {
      customerDeliveryCharge = deliveryMode.includes('ë¡œì¼“') ? 3500 : 3000;
    }
    if (customerProfile.wowTier === 'WOW_PLUS') {
      customerDeliveryCharge *= (1 - WOW_TIERS.WOW_PLUS.deliveryDiscount);
    }
    customerDeliveryCharge = Math.round(customerDeliveryCharge);

    // ì˜¨ë„ ê´€ë¦¬ (ì½œë“œì²´ì¸)
    const tempData = generateTemperatureData(selectedCategory, categoryData.coldChain);

    // ë°˜í’ˆ ì²˜ë¦¬ (ì˜¨ë„ ìœ„ë°˜ì‹œ 2.5ë°° ì¦ê°€)
    let returnRate = categoryData.returnRate;
    if (tempData.violation) returnRate *= 2.5;
    if (isDelayed && deliveryMode.includes('ë¡œì¼“')) returnRate *= 1.8; // ë¡œì¼“ë°°ì†¡ ì§€ì—°ì‹œ ë” ë¯¼ê°

    const returnFlag = Math.random() < returnRate ? 1 : 0;
    const returnReason = returnFlag ? pick(RETURN_REASONS) : null;
    const returnCost = returnFlag ? Math.round(orderAmount * rnd(0.1, 0.25)) : 0;

    // ì¬íŒë§¤ ê°€ëŠ¥ì„± (ì˜¨ë„ ìœ„ë°˜ ê³ ë ¤)
    let resellable = null, resellReason = null;
    if (returnFlag) {
      if (tempData.violation) {
        resellable = 0;
        resellReason = 'ì˜¨ë„ê´€ë¦¬ì‹¤íŒ¨';
      } else if (['ë‹¨ìˆœë³€ì‹¬', 'ê¸°íƒ€'].includes(returnReason)) {
        resellable = Math.random() < 0.92 ? 1 : 0;
        resellReason = resellable ? 'ì •ìƒìƒí’ˆ' : 'í¬ì¥ì†ìƒ';
      } else {
        resellable = Math.random() < 0.45 ? 1 : 0;
        resellReason = resellable ? 'ë¶€ë¶„ìˆ˜ë¦¬ê°€ëŠ¥' : 'ìƒí’ˆì†ìƒ';
      }
    }

    // ì¬ê³  ê´€ë¦¬ (ABCë“±ê¸‰ë³„ ì°¨ë³„í™”)
    const currentStock = abcGrade === 'A' ? irnd(200, 800) :
      abcGrade === 'B' ? irnd(50, 300) : irnd(10, 100);
    const reorderPoint = Math.round(currentStock * (abcGrade === 'A' ? 0.4 : abcGrade === 'B' ? 0.3 : 0.2));
    const stockTurnover = abcGrade === 'A' ? rnd(12, 20) : abcGrade === 'B' ? rnd(6, 12) : rnd(2, 8);
    const stockoutFlag = Math.random() < (abcGrade === 'A' ? 0.015 : abcGrade === 'B' ? 0.04 : 0.08) ? 1 : 0;
    const overstockFlag = currentStock > reorderPoint * 4 ? 1 : 0;

    // ì‘ì—… ì‹œê°„ (ìë™í™” ìˆ˜ì¤€ë³„)
    const automationConfig = AUTOMATION_LEVELS[automationLevel];
    const pickingTime = automationConfig.pickingTime + rnd(-3, 5);
    const packingTime = automationConfig.packingTime + rnd(-2, 3);
    const totalProcessTime = Math.round((pickingTime + packingTime) * 10) / 10;

    // ì¶œê³  ì‹œê°„ ë¶„ì„ (30ë¶„ ë‚´ ì¶œê³ ìœ¨)
    const orderToShipMinutes = Math.random() < 0.4 ? irnd(15, 30) : irnd(30, 120);
    const fastShipFlag = orderToShipMinutes <= 30 ? 1 : 0;

    // CAC, LTV ê³„ì‚° (WOW í‹°ì–´ë³„ ì°¨ë³„í™”)
    const baseCac = customerProfile.isWow ? irnd(3500, 7000) : irnd(1200, 2800);
    const wowTierConfig = customerProfile.wowTier ? WOW_TIERS[customerProfile.wowTier] : {ltvMultiplier: 1.5};
    const customerLTV = Math.round(orderAmount * wowTierConfig.ltvMultiplier * rnd(2.8, 4.2));

    // ìˆ˜ìµì„± ê³„ì‚°
    const grossProfit = Math.round(orderAmount * categoryData.margin);
    const inventoryCarryingCost = Math.round(currentStock * unitPrice * 0.002 / 12);
    const stockoutCost = stockoutFlag ? Math.round(orderAmount * 0.08) : 0;
    const qualityCost = tempData.violation ? Math.round(orderAmount * 0.05) : 0;
    const netProfit = grossProfit - actualLogisticsCost - returnCost - inventoryCarryingCost - stockoutCost - qualityCost;

    // ê³ ê° ì´íƒˆ ì˜ˆì¸¡ (ê°•í™”ëœ ë¡œì§)
    let churnScore = customerProfile.churnFlag ? rnd(0.65, 0.95) : rnd(0.05, 0.55);
    if (isDelayed && deliveryMode.includes('ë¡œì¼“')) churnScore += 0.15;
    if (returnFlag && !resellable) churnScore += 0.1;
    if (customerProfile.wowTier === 'WOW_PLUS') churnScore *= 0.6; // Plus íšŒì›ì€ ì´íƒˆìœ¨ ë‚®ìŒ
    churnScore = Math.min(0.98, Math.round(churnScore * 1000) / 1000);

    // í’ˆì§ˆ ì ìˆ˜ ê³„ì‚°
    const serviceQualityScore = Math.round(
      (100 - (isDelayed ? 15 : 0) - (returnFlag ? 10 : 0) - (tempData.violation ? 20 : 0)) *
      (automationLevel === 'AI_OPTIMIZED' ? 1.05 : 1.0)
    );

    // WMS/OMS ì„±ìˆ™ë„
    const wmsUsage = automationLevel === 'MANUAL' ? 'Legacy' : 'Active';
    const omsUsage = Math.random() < 0.95 ? 'Active' : 'Manual';
    const wmsAdvancedScore = automationLevel === 'AI_OPTIMIZED' ? rnd(88, 96) :
      automationLevel === 'AUTO' ? rnd(75, 87) :
        automationLevel === 'SEMI_AUTO' ? rnd(55, 74) : rnd(30, 54);

    // ì›”ë³„ ì§‘ê³„ í‚¤
    const monthlyKey = `${custId}-${year}-${pad(orderDate.getMonth() + 1)}`;

    // í”Œë˜ê·¸ë“¤ (ì¿ íŒ¡ íŠ¹í™”)
    const isRocketDelivery = deliveryMode.includes('ë¡œì¼“') ? 1 : 0;
    const isSameDayDelivery = deliveryMode === 'ë¡œì¼“ë‹¹ì¼' ? 1 : 0;
    const isDawnDelivery = deliveryMode === 'ë¡œì¼“ìƒˆë²½' ? 1 : 0;
    const isFreshDelivery = deliveryMode === 'ë¡œì¼“í”„ë ˆì‹œ' ? 1 : 0;
    const isFreshFood = categoryData.freshFood ? 1 : 0;
    const isColdChainRequired = categoryData.coldChain ? 1 : 0;
    const isTempViolation = tempData.violation ? 1 : 0;
    const isWowMember = customerProfile.isWow;
    const isWowPlus = customerProfile.wowTier === 'WOW_PLUS' ? 1 : 0;
    const isPremiumOrder = orderAmount >= 100000 ? 1 : 0;
    const isBulkOrder = quantity >= 3 ? 1 : 0;
    const isWeekendOrder = isWeekend ? 1 : 0;
    const isPeakHourOrder = isPeakTime ? 1 : 0;
    const isFreeShipping = customerDeliveryCharge === 0 ? 1 : 0;
    const isWeatherRisk = weatherSev > 0.4 ? 1 : 0;
    const isLongDistance = distanceKm > 30 ? 1 : 0;
    const isHighLTV = customerLTV >= 200000 ? 1 : 0;
    const isChurnRisk = churnScore > 0.7 ? 1 : 0;
    const isVIP = (isHighLTV && isWowPlus) ? 1 : 0;
    const isLossOrder = netProfit < 0 ? 1 : 0;
    const isAIOptimized = automationLevel === 'AI_OPTIMIZED' ? 1 : 0;
    const isMegaHub = MEGA_HUBS.includes(fulfillmentCenter) ? 1 : 0;

    // ìµœì¢… í–‰ ê°ì²´ ë°˜í™˜
    return {
      // ê¸°ë³¸ ì£¼ë¬¸ ì •ë³´
      Order_ID: `ORD${String(1000000 + index).padStart(8, '0')}`,
      Order_Date: `${year}-${pad(orderDate.getMonth() + 1)}-${pad(orderDate.getDate())}`,
      Order_Timestamp: orderDate.toISOString(),
      Order_Hour: orderDate.getHours(),

      // ë°°ì†¡ ì •ë³´
      Delivery_Mode: deliveryMode,
      Planned_Delivery_Date: `${plannedDelivery.getFullYear()}-${pad(plannedDelivery.getMonth() + 1)}-${pad(plannedDelivery.getDate())}`,
      Actual_Delivery_Date: `${actualDelivery.getFullYear()}-${pad(actualDelivery.getMonth() + 1)}-${pad(actualDelivery.getDate())}`,
      Delivery_Timestamp: actualDelivery.toISOString(),
      Is_Delayed: isDelayed ? 1 : 0,
      Delay_Hours: delayHours,
      SLA_Breach: isDelayed ? 1 : 0,
      Delivery_Status: isDelayed ? 'Late' : 'On-Time',
      Fast_Ship_30min: fastShipFlag,
      Order_To_Ship_Minutes: orderToShipMinutes,

      // ì§€ì—­ ì •ë³´
      Region: region,
      City: city,
      District: district,
      Address: address,
      Fulfillment_Center: fulfillmentCenter,
      Is_Mega_Hub: isMegaHub,
      Distance_km: distanceKm,

      // ê³ ê° ì •ë³´
      Customer_ID: custId,
      Is_WOW_Member: isWowMember,
      WOW_Tier: customerProfile.wowTier,
      Is_WOW_Plus: isWowPlus,
      WOW_Join_Date: customerProfile.joinDate ? customerProfile.joinDate.toISOString().split('T')[0] : null,
      WOW_Tenure_Days: customerProfile.joinDate ? Math.floor((orderDate - customerProfile.joinDate) / 86400000) : 0,
      Customer_Segment: customerLTV >= 300000 ? 'Platinum' :
        customerLTV >= 180000 ? 'Gold' :
          customerLTV >= 80000 ? 'Silver' : 'Bronze',

      // ìƒí’ˆ ì •ë³´
      Product_Category: selectedCategory,
      SKU: sku,
      ABC_Category: abcGrade,
      Unit_Price: unitPrice,
      Quantity: quantity,
      Order_Amount: orderAmount,
      Is_Fresh_Food: isFreshFood,
      Is_Cold_Chain_Required: isColdChainRequired,

      // ì˜¨ë„ ê´€ë¦¬
      Target_Temperature: tempData.targetTemp,
      Actual_Temperature: tempData.actualTemp,
      Temperature_Violation: isTempViolation,
      Cold_Chain_Quality_Score: tempData.quality,

      // ìš´ì†¡ ì •ë³´
      Vehicle_ID: vehicleId,
      Vehicle_Type: vehicle.type,
      Vehicle_Capacity: vehicle.capacity,
      Driver_ID: driverId,
      Driver_Grade: driverGrade,
      Load_Factor: loadFactor,
      Fuel_Efficiency: Math.round(fuelEfficiency * 10) / 10,
      Routing_Score: routingScore,
      GPS_Tracking: Math.random() < 0.96 ? 1 : 0,

      // ë¹„ìš© ì •ë³´
      Actual_Logistics_Cost: actualLogisticsCost,
      Customer_Delivery_Charge: customerDeliveryCharge,
      Gross_Profit: grossProfit,
      Net_Profit: netProfit,
      CAC: baseCac,
      Customer_LTV: customerLTV,
      LTV_to_CAC: Math.round((customerLTV / Math.max(baseCac, 1)) * 100) / 100,

      // ë°˜í’ˆ ì •ë³´
      Return_Flag: returnFlag,
      Return_Reason: returnReason,
      Return_Cost: returnCost,
      Is_Resellable: resellable,
      Resellability_Reason: resellReason,

      // ì¬ê³  ì •ë³´
      Current_Stock: currentStock,
      Reorder_Point: reorderPoint,
      Stockout_Flag: stockoutFlag,
      Overstock_Flag: overstockFlag,
      Inventory_Turnover: Math.round(stockTurnover * 10) / 10,
      Inventory_Accuracy: Math.round(rnd(0.94, 0.999) * 1000) / 1000,

      // ì‘ì—… íš¨ìœ¨ì„±
      Automation_Level: automationLevel,
      Picking_Time_Seconds: Math.round(pickingTime),
      Packing_Time_Seconds: Math.round(packingTime),
      Total_Process_Time: totalProcessTime,
      WMS_Usage: wmsUsage,
      OMS_Usage: omsUsage,
      WMS_Advanced_Score: Math.round(wmsAdvancedScore),

      // í’ˆì§ˆ ê´€ë¦¬
      Service_Quality_Score: serviceQualityScore,
      Customer_NPS: Math.round(serviceQualityScore * 0.85 + rnd(-5, 10)),
      Processing_Error_Rate: automationConfig.errorRate,

      // ë‚ ì”¨ ë° í™˜ê²½
      Weather_Condition: weather,
      Weather_Severity_Score: Math.round(weatherSev * 100) / 100,

      // ê³ ê° í–‰ë™ ì˜ˆì¸¡
      Churn_Flag: customerProfile.churnFlag,
      Predicted_Churn_Score: churnScore,

      // í”Œë˜ê·¸ë“¤ (ë¶„ì„ìš©)
      Is_Rocket_Delivery: isRocketDelivery,
      Is_Same_Day_Delivery: isSameDayDelivery,
      Is_Dawn_Delivery: isDawnDelivery,
      Is_Fresh_Delivery: isFreshDelivery,
      Is_Premium_Order: isPremiumOrder,
      Is_Bulk_Order: isBulkOrder,
      Is_Weekend_Order: isWeekendOrder,
      Is_Peak_Hour_Order: isPeakHourOrder,
      Is_Free_Shipping: isFreeShipping,
      Is_Weather_Risk: isWeatherRisk,
      Is_Long_Distance: isLongDistance,
      Is_High_LTV: isHighLTV,
      Is_Churn_Risk: isChurnRisk,
      Is_VIP_Customer: isVIP,
      Is_Loss_Order: isLossOrder,
      Is_AI_Optimized: isAIOptimized,

      // ë‚´ë¶€ í‚¤
      _monthlyKey: monthlyKey,
      _automationLevel: automationLevel,
      _customerProfile: customerProfile
    };
  }

  function getAutomationLevel(region) {
    for (const [level, config] of Object.entries(AUTOMATION_LEVELS)) {
      if (config.regions.includes(region)) {
        return level;
      }
    }
    // ê¸°ë³¸ì ìœ¼ë¡œ ìˆ˜ë„ê¶Œì€ AI_OPTIMIZED, ë‚˜ë¨¸ì§€ëŠ” AUTO
    if (region.includes('ì„œìš¸') || region.includes('ê²½ê¸°') || region.includes('ì¸ì²œ')) {
      return Math.random() < 0.6 ? 'AI_OPTIMIZED' : 'AUTO';
    }
    return 'SEMI_AUTO';
  }

  // ì²­í¬ ìƒì„± í•¨ìˆ˜ (ê°œì„ ëœ ì„±ëŠ¥)
  async function generateCoupangDataChunk(startIdx, chunkSize, totalUsers, yearStart, yearEnd, customerProfiles, rocketRate) {
    const chunk = [];
    const chunkMonthly = {};

    for (let i = 0; i < chunkSize; i++) {
      if (PROCESSING_STATE.shouldStop) break;

      const row = generateCoupangRealisticRow(
        startIdx + i, totalUsers, yearStart, yearEnd, customerProfiles, rocketRate
      );
      chunk.push(row);

      // ì›”ë³„ ì§‘ê³„ ëˆ„ì 
      const monthlyKey = row._monthlyKey;
      chunkMonthly[monthlyKey] = (chunkMonthly[monthlyKey] || 0) + row.Order_Amount;

      // CPU ì–‘ë³´
      if (i % 150 === 0) {
        await sleep(0);
      }
    }

    return { chunk, chunkMonthly };
  }

  // ë©”ì¸ ë°ì´í„° ìƒì„± í•¨ìˆ˜ (ì¿ íŒ¡ íŠ¹í™”)
  async function generateCoupangRealisticData(totalOrders, totalUsers, yearStart, yearEnd, chunkSize, rocketRate, wowRate) {
    // ì´ˆê¸°í™”
    DATA = [];
    MONTHLY_BY_CUST = {};
    VALIDATION_ISSUES = [];
    PERFORMANCE_METRICS = {};
    COUPANG_REALITY_METRICS = {};

    PROCESSING_STATE = {
      isRunning: true,
      shouldStop: false,
      startTime: performance.now(),
      processedRows: 0,
      totalRows: totalOrders,
      currentChunk: 0,
      totalChunks: Math.ceil(totalOrders / chunkSize)
    };

    updateUIState('running');

    try {
      // ê³ ê° í”„ë¡œí•„ ì‚¬ì „ ìƒì„±
      console.log('ê³ ê° í”„ë¡œí•„ ìƒì„± ì¤‘...');
      const customerProfiles = preAssignCustomerProfiles(totalUsers, wowRate);

      // ì²­í¬ë³„ ë°ì´í„° ìƒì„±
      for (let chunkIdx = 0; chunkIdx < PROCESSING_STATE.totalChunks; chunkIdx++) {
        if (PROCESSING_STATE.shouldStop) break;

        const startIdx = chunkIdx * chunkSize;
        const currentChunkSize = Math.min(chunkSize, totalOrders - startIdx);

        // ì²­í¬ ìƒì„±
        const { chunk, chunkMonthly } = await generateCoupangDataChunk(
          startIdx, currentChunkSize, totalUsers, yearStart, yearEnd, customerProfiles, rocketRate
        );

        // ë©”ëª¨ë¦¬ ê´€ë¦¬
        if (DATA.length + chunk.length > CHUNK_CONFIG.maxMemoryRows) {
          DATA = DATA.slice(-Math.floor(CHUNK_CONFIG.maxMemoryRows * 0.6)).concat(chunk);
        } else {
          DATA = DATA.concat(chunk);
        }

        // ì›”ë³„ ì§‘ê³„ ì—…ë°ì´íŠ¸
        Object.entries(chunkMonthly).forEach(([key, value]) => {
          MONTHLY_BY_CUST[key] = (MONTHLY_BY_CUST[key] || 0) + value;
        });

        // ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
        PROCESSING_STATE.processedRows = startIdx + currentChunkSize;
        PROCESSING_STATE.currentChunk = chunkIdx + 1;

        // ì£¼ê¸°ì  UI ì—…ë°ì´íŠ¸
        if (chunkIdx % CHUNK_CONFIG.batchUpdateInterval === 0 || chunkIdx === PROCESSING_STATE.totalChunks - 1) {
          updateProgress();

          if (chunkIdx % (CHUNK_CONFIG.batchUpdateInterval * 2) === 0) {
            const partialKPI = calculateCoupangKPIs(DATA.slice(-10000));
            updateCoupangKPI(partialKPI);
          }
        }

        // ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ íŒíŠ¸
        if (chunkIdx % CHUNK_CONFIG.gcInterval === 0) {
          await sleep(15);
        }

        await sleep(1);
      }

      // ìµœì¢… ì²˜ë¦¬
      if (!PROCESSING_STATE.shouldStop) {
        // CLV ë¶„ìœ„ìˆ˜ ê³„ì‚°
        const ltvValues = DATA.map(r => r.Customer_LTV || 0);
        const ltvQuartiles = calculateQuartiles(ltvValues);
        DATA.forEach(row => {
          const quartile = assignQuartile(row.Customer_LTV || 0, ltvQuartiles);
          row.CLV_Quartile = quartile;
          row.CLV_Quartile_Label = `Q${quartile}`;
        });

        // ìµœì¢… KPI ê³„ì‚° ë° í‘œì‹œ
        const finalKPI = calculateCoupangKPIs(DATA);
        updateCoupangKPI(finalKPI);

        // í˜„ì‹¤ì„± ì§€í‘œ ê³„ì‚°
        COUPANG_REALITY_METRICS = calculateRealityMetrics();

        // ê²€ì¦ ìˆ˜í–‰
        await runCoupangValidations();
        renderCoupangValidations();
        renderCoupangRisks();
        renderCoupangTable();

        // ì„±ëŠ¥ ë©”íŠ¸ë¦­
        const endTime = performance.now();
        PERFORMANCE_METRICS = {
          totalTime: Math.round(endTime - PROCESSING_STATE.startTime),
          rowsPerSecond: Math.round(totalOrders / ((endTime - PROCESSING_STATE.startTime) / 1000)),
          chunksProcessed: PROCESSING_STATE.totalChunks,
          memoryEfficiency: Math.round((DATA.length / totalOrders) * 100),
          realityScore: COUPANG_REALITY_METRICS.overallScore
        };
        renderPerformanceMetrics();

        document.getElementById('btnCsv').disabled = false;
        updateUIState('completed');
      } else {
        updateUIState('stopped');
      }

    } catch (error) {
      console.error('ì¿ íŒ¡ ë°ì´í„° ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
      updateUIState('error');
      alert('ë°ì´í„° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    }

    PROCESSING_STATE.isRunning = false;
  }

  /* -------------------------
     3) ì¿ íŒ¡ íŠ¹í™” KPI ê³„ì‚° í•¨ìˆ˜ë“¤
  --------------------------*/

  function calculateCoupangKPIs(rows) {
    if (!rows.length) return {};

    const totalOrders = rows.length;

    // ê¸°ë³¸ ë§¤ì¶œ ì§€í‘œ
    const totalSales = rows.reduce((sum, r) => sum + r.Order_Amount, 0);
    const totalNetProfit = rows.reduce((sum, r) => sum + r.Net_Profit, 0);
    const netMargin = totalSales > 0 ? Math.round((totalNetProfit / totalSales) * 1000) / 10 : 0;
    const avgOrderValue = Math.round(totalSales / Math.max(totalOrders, 1));

    // ë¡œì¼“ë°°ì†¡ ì§€í‘œ
    const rocketOrders = rows.filter(r => r.Is_Rocket_Delivery === 1);
    const rocketShare = Math.round((rocketOrders.length / totalOrders) * 1000) / 10;
    const sameDayOrders = rows.filter(r => r.Is_Same_Day_Delivery === 1);
    const sameDaySuccessRate = sameDayOrders.length > 0 ?
      Math.round((sameDayOrders.filter(r => r.SLA_Breach === 0).length / sameDayOrders.length) * 1000) / 10 : 0;

    const dawnOrders = rows.filter(r => r.Is_Dawn_Delivery === 1);
    const dawnOnTimeRate = dawnOrders.length > 0 ?
      Math.round((dawnOrders.filter(r => r.SLA_Breach === 0).length / dawnOrders.length) * 1000) / 10 : 0;

    const fastShipRate = rows.length > 0 ?
      Math.round((rows.filter(r => r.Fast_Ship_30min === 1).length / totalOrders) * 1000) / 10 : 0;

    // WOW ë©¤ë²„ì‹­ ì§€í‘œ
    const wowOrders = rows.filter(r => r.Is_WOW_Member === 1);
    const wowShare = Math.round((wowOrders.length / totalOrders) * 1000) / 10;
    const wowPlusOrders = rows.filter(r => r.Is_WOW_Plus === 1);
    const wowPlusShare = wowOrders.length > 0 ?
      Math.round((wowPlusOrders.length / wowOrders.length) * 1000) / 10 : 0;

    const wowAov = wowOrders.length > 0 ?
      Math.round(wowOrders.reduce((sum, r) => sum + r.Order_Amount, 0) / wowOrders.length) : 0;
    const nonWowOrders = rows.filter(r => r.Is_WOW_Member === 0);
    const nonWowAov = nonWowOrders.length > 0 ?
      Math.round(nonWowOrders.reduce((sum, r) => sum + r.Order_Amount, 0) / nonWowOrders.length) : 0;
    const wowAovGap = wowAov - nonWowAov;

    const wowChurnRisk = rows.filter(r => r.Is_WOW_Member === 1 && r.Is_Churn_Risk === 1).length;

    // ì‹ ì„ ì‹í’ˆ & ì½œë“œì²´ì¸
    const freshOrders = rows.filter(r => r.Is_Fresh_Food === 1);
    const freshShare = Math.round((freshOrders.length / totalOrders) * 1000) / 10;
    const coldChainOrders = rows.filter(r => r.Is_Cold_Chain_Required === 1);
    const coldChainCompliant = coldChainOrders.filter(r => r.Temperature_Violation === 0);
    const coldChainRate = coldChainOrders.length > 0 ?
      Math.round((coldChainCompliant.length / coldChainOrders.length) * 1000) / 10 : 0;
    const tempViolationRate = coldChainOrders.length > 0 ?
      Math.round((coldChainOrders.filter(r => r.Temperature_Violation === 1).length / coldChainOrders.length) * 1000) / 10 : 0;
    const frozenOrders = rows.filter(r => r.Product_Category === 'ëƒ‰ë™ì‹í’ˆ');
    const frozenQuality = frozenOrders.length > 0 ?
      Math.round(frozenOrders.reduce((sum, r) => sum + (r.Cold_Chain_Quality_Score || 90), 0) / frozenOrders.length) : 90;

    // í—ˆë¸Œ&ìŠ¤í¬í¬ ë„¤íŠ¸ì›Œí¬
    const megaHubOrders = rows.filter(r => r.Is_Mega_Hub === 1);
    const megaHubShare = Math.round((megaHubOrders.length / totalOrders) * 1000) / 10;
    const seoulOrders = rows.filter(r => r.Region.includes('ì„œìš¸') || r.Region.includes('ê²½ê¸°') || r.Region.includes('ì¸ì²œ'));
    const seoulCoverage = Math.round((seoulOrders.length / totalOrders) * 1000) / 10;
    const avgDistance = Math.round(rows.reduce((sum, r) => sum + r.Distance_km, 0) / totalOrders * 10) / 10;
    const networkEfficiency = Math.round(rows.reduce((sum, r) => sum + r.Routing_Score, 0) / totalOrders);

    // AI & ìë™í™”
    const aiOptimizedOrders = rows.filter(r => r.Is_AI_Optimized === 1);
    const aiOptimizedRate = Math.round((aiOptimizedOrders.length / totalOrders) * 1000) / 10;
    const autoPickOrders = rows.filter(r => ['AUTO', 'AI_OPTIMIZED'].includes(r.Automation_Level));
    const autoPickRate = Math.round((autoPickOrders.length / totalOrders) * 1000) / 10;
    const avgPickTime = Math.round(rows.reduce((sum, r) => sum + r.Picking_Time_Seconds, 0) / totalOrders);
    const wmsAdvancedScore = Math.round(rows.reduce((sum, r) => sum + (r.WMS_Advanced_Score || 70), 0) / totalOrders);

    // ê¸°ì¡´ KPIë“¤
    const onTimeOrders = rows.filter(r => r.SLA_Breach === 0);
    const onTimeRate = Math.round((onTimeOrders.length / totalOrders) * 1000) / 10;
    const slaBreachRate = 100 - onTimeRate;

    const avgLoadFactor = Math.round(rows.reduce((sum, r) => sum + r.Load_Factor, 0) / totalOrders);
    const avgFuelEff = Math.round(rows.reduce((sum, r) => sum + r.Fuel_Efficiency, 0) / totalOrders * 10) / 10;
    const avgRoutingScore = networkEfficiency;

    const exceptionOrders = rows.filter(r => r.Return_Reason && ['ì˜¤ë°°ì†¡', 'íŒŒì†'].includes(r.Return_Reason));
    const exceptionRate = Math.round((exceptionOrders.length / totalOrders) * 1000) / 10;

    const returnOrders = rows.filter(r => r.Return_Flag === 1);
    const returnRate = Math.round((returnOrders.length / totalOrders) * 1000) / 10;
    const totalReturnCost = returnOrders.reduce((sum, r) => sum + r.Return_Cost, 0);
    const returnCostRate = totalSales > 0 ? Math.round((totalReturnCost / totalSales) * 1000) / 10 : 0;
    const resellableReturns = returnOrders.filter(r => r.Is_Resellable === 1);
    const resellableRate = returnOrders.length > 0 ?
      Math.round((resellableReturns.length / returnOrders.length) * 1000) / 10 : 0;

    // ì¬ê³  KPI
    const avgInventoryTurnover = Math.round(rows.reduce((sum, r) => sum + r.Inventory_Turnover, 0) / totalOrders * 10) / 10;
    const stockoutOrders = rows.filter(r => r.Stockout_Flag === 1);
    const stockoutRate = Math.round((stockoutOrders.length / totalOrders) * 1000) / 10;
    const overstockOrders = rows.filter(r => r.Overstock_Flag === 1);
    const overstockRate = Math.round((overstockOrders.length / totalOrders) * 1000) / 10;
    const avgInventoryAccuracy = Math.round(rows.reduce((sum, r) => sum + r.Inventory_Accuracy, 0) / totalOrders * 1000) / 10;

    const totalCarryingCost = rows.reduce((sum, r) => sum + (r.Current_Stock * r.Unit_Price * 0.002 / 12), 0);
    const shrinkageRate = totalSales > 0 ? Math.round((totalCarryingCost / totalSales) * 1000) / 10 : 0;

    const wmsActiveOrders = rows.filter(r => r.WMS_Usage === 'Active');
    const wmsUtilizationRate = Math.round((wmsActiveOrders.length / totalOrders) * 1000) / 10;

    // ê³ ê° ì§€í‘œ
    const uniqueCustomers = new Set(rows.map(r => r.Customer_ID)).size;
    const avgLTV = Math.round(rows.reduce((sum, r) => sum + r.Customer_LTV, 0) / totalOrders);
    const avgCAC = Math.round(rows.reduce((sum, r) => sum + r.CAC, 0) / totalOrders);
    const ltvCacRatio = avgCAC > 0 ? Math.round((avgLTV / avgCAC) * 100) / 100 : 0;

    const churnCustomers = new Set(rows.filter(r => r.Churn_Flag === 1).map(r => r.Customer_ID)).size;
    const churnRate = uniqueCustomers > 0 ? Math.round((churnCustomers / uniqueCustomers) * 1000) / 10 : 0;
    const retentionRate = Math.round((100 - churnRate) * 10) / 10;

    // AI ì˜ˆì¸¡ ì •í™•ë„
    const correctPredictions = rows.filter(r =>
      (r.Churn_Flag === 1 && r.Predicted_Churn_Score > 0.7) ||
      (r.Churn_Flag === 0 && r.Predicted_Churn_Score <= 0.7)
    );
    const aiAccuracy = Math.round((correctPredictions.length / totalOrders) * 1000) / 10;

    // ARPPU ê³„ì‚°
    const monthlyTotals = Object.values(MONTHLY_BY_CUST);
    const arppu = monthlyTotals.length > 0 ?
      Math.round(monthlyTotals.reduce((sum, amt) => sum + amt, 0) / monthlyTotals.length) : 0;

    return {
      // ê¸°ë³¸ ë§¤ì¶œ
      totalSales, netMargin, aov: avgOrderValue, arppu,

      // ë¡œì¼“ë°°ì†¡
      rocketShare, rocketSameDayRate: sameDaySuccessRate, rocketDawnRate: dawnOnTimeRate, fastShipRate,

      // WOW ë©¤ë²„ì‹­
      wowShare, wowPlusShare, wowAovGap, wowChurnRisk,

      // ì‹ ì„ ì‹í’ˆ
      freshShare, coldChainRate, tempViolation: tempViolationRate, frozenQuality,

      // í—ˆë¸Œ&ìŠ¤í¬í¬
      megaHubShare, seoulCoverage, avgDistance, networkEff: networkEfficiency,

      // AI & ìë™í™”
      aiOptimized: aiOptimizedRate, autoPickRate, avgPickTime, wmsAdvanced: wmsAdvancedScore,

      // ê¸°ì¡´ KPI
      onTimeRate, slaRate: slaBreachRate, load: avgLoadFactor, fuel: avgFuelEff,
      route: avgRoutingScore, exceptionRate,
      returnRate, returnCostRate, resellRate: resellableRate,
      invTurn: avgInventoryTurnover, stockoutRate, overstockRate,
      invAcc: avgInventoryAccuracy, shrink: shrinkageRate, wmsUtil: wmsUtilizationRate,
      ltvCac: ltvCacRatio, retention: retentionRate, churnRate, aiAcc: aiAccuracy
    };
  }

  function calculateQuartiles(values) {
    if (!values.length) return {q1: 0, q2: 0, q3: 0};
    const sorted = [...values].sort((a, b) => a - b);
    const q1Index = Math.floor(sorted.length * 0.25);
    const q2Index = Math.floor(sorted.length * 0.5);
    const q3Index = Math.floor(sorted.length * 0.75);
    return {
      q1: sorted[q1Index] || 0,
      q2: sorted[q2Index] || 0,
      q3: sorted[q3Index] || 0
    };
  }

  function assignQuartile(value, quartiles) {
    if (value <= quartiles.q1) return 1;
    if (value <= quartiles.q2) return 2;
    if (value <= quartiles.q3) return 3;
    return 4;
  }

  function calculateRealityMetrics() {
    if (!DATA.length) return {overallScore: 0};

    const totalOrders = DATA.length;

    // í˜„ì‹¤ì„± ì§€í‘œë“¤
    const rocketShare = DATA.filter(r => r.Is_Rocket_Delivery === 1).length / totalOrders;
    const wowShare = DATA.filter(r => r.Is_WOW_Member === 1).length / totalOrders;
    const freshShare = DATA.filter(r => r.Is_Fresh_Food === 1).length / totalOrders;
    const seoulShare = DATA.filter(r => r.Region.includes('ì„œìš¸') || r.Region.includes('ê²½ê¸°')).length / totalOrders;
    const aiOptimizedShare = DATA.filter(r => r.Is_AI_Optimized === 1).length / totalOrders;
    const tempViolationRate = DATA.filter(r => r.Temperature_Violation === 1).length / Math.max(DATA.filter(r => r.Is_Cold_Chain_Required === 1).length, 1);

    // í˜„ì‹¤ì„± ì ìˆ˜ ê³„ì‚° (ê° ì§€í‘œë³„ ê°€ì¤‘ì¹˜)
    let realityScore = 0;
    let maxScore = 0;

    // ë¡œì¼“ë°°ì†¡ ë¹„ì¤‘ (45-65% ëª©í‘œ)
    const rocketTarget = 0.55;
    const rocketDeviation = Math.abs(rocketShare - rocketTarget) / rocketTarget;
    realityScore += Math.max(0, 20 - rocketDeviation * 20);
    maxScore += 20;

    // WOW ê°€ì…ë¥  (60-80% ëª©í‘œ)
    const wowTarget = 0.70;
    const wowDeviation = Math.abs(wowShare - wowTarget) / wowTarget;
    realityScore += Math.max(0, 20 - wowDeviation * 20);
    maxScore += 20;

    // ì‹ ì„ ì‹í’ˆ ë¹„ì¤‘ (8-15% ëª©í‘œ)
    const freshTarget = 0.12;
    const freshDeviation = Math.abs(freshShare - freshTarget) / freshTarget;
    realityScore += Math.max(0, 15 - freshDeviation * 15);
    maxScore += 15;

    // ìˆ˜ë„ê¶Œ ë¹„ì¤‘ (45-55% ëª©í‘œ)
    const seoulTarget = 0.50;
    const seoulDeviation = Math.abs(seoulShare - seoulTarget) / seoulTarget;
    realityScore += Math.max(0, 15 - seoulDeviation * 15);
    maxScore += 15;

    // AI ìµœì í™” ë¹„ì¤‘ (ìˆ˜ë„ê¶Œ ê¸°ì¤€ 40-60% ëª©í‘œ)
    const aiTarget = 0.35; // ì „ì²´ ê¸°ì¤€ìœ¼ë¡œëŠ” 35% ì •ë„
    const aiDeviation = Math.abs(aiOptimizedShare - aiTarget) / aiTarget;
    realityScore += Math.max(0, 15 - aiDeviation * 15);
    maxScore += 15;

    // ì½œë“œì²´ì¸ ìœ„ë°˜ìœ¨ (1% ì´í•˜ ëª©í‘œ)
    const tempTarget = 0.01;
    const tempScore = tempViolationRate <= tempTarget ? 15 : Math.max(0, 15 - (tempViolationRate - tempTarget) * 1000);
    realityScore += tempScore;
    maxScore += 15;

    const overallScore = Math.round((realityScore / maxScore) * 100);

    return {
      overallScore,
      rocketShare: Math.round(rocketShare * 100),
      wowShare: Math.round(wowShare * 100),
      freshShare: Math.round(freshShare * 100),
      seoulShare: Math.round(seoulShare * 100),
      aiOptimizedShare: Math.round(aiOptimizedShare * 100),
      tempViolationRate: Math.round(tempViolationRate * 1000) / 10
    };
  }

  /* -------------------------
     4) ì¿ íŒ¡ íŠ¹í™” ê²€ì¦ ë° ìœ„í—˜ ìš”ì†Œ
  --------------------------*/

  async function runCoupangValidations() {
    const issues = [];
    const sampleSize = Math.min(DATA.length, 8000);
    const sampleData = DATA.slice(-sampleSize);

    for (let i = 0; i < sampleData.length; i++) {
      const row = sampleData[i];

      // 1. ë¡œì¼“ë°°ì†¡ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦
      if (row.Is_Rocket_Delivery === 1) {
        // ë¡œì¼“ë‹¹ì¼ì€ ìˆ˜ë„ê¶Œë§Œ
        if (row.Is_Same_Day_Delivery === 1 &&
          !['ì„œìš¸íŠ¹ë³„ì‹œ', 'ê²½ê¸°ë„', 'ì¸ì²œê´‘ì—­ì‹œ'].includes(row.Region)) {
          issues.push({level: 'bad', msg: `ë¡œì¼“ë‹¹ì¼ ì„œë¹„ìŠ¤ ì§€ì—­ ìœ„ë°˜: ${row.Order_ID} (${row.Region})`});
        }

        // WOW íšŒì› ìš°ì„ ê¶Œ ì²´í¬ (ë¡œì¼“ë°°ì†¡ì˜ 80%ëŠ” WOW íšŒì›ì´ì–´ì•¼ í•¨)
        const rocketOrders = sampleData.filter(r => r.Is_Rocket_Delivery === 1);
        const rocketWowRate = rocketOrders.filter(r => r.Is_WOW_Member === 1).length / rocketOrders.length;
        if (rocketWowRate < 0.75) {
          issues.push({level: 'warn', msg: `ë¡œì¼“ë°°ì†¡ WOW íšŒì› ë¹„ì¤‘ ë‚®ìŒ: ${Math.round(rocketWowRate*100)}% (ëª©í‘œ: 80%+)`});
        }
      }

      // 2. ì½œë“œì²´ì¸ ê²€ì¦
      if (row.Is_Cold_Chain_Required === 1) {
        if (row.Target_Temperature === null || row.Actual_Temperature === null) {
          issues.push({level: 'bad', msg: `ì½œë“œì²´ì¸ ì˜¨ë„ ë°ì´í„° ëˆ„ë½: ${row.Order_ID}`});
        }

        // ì˜¨ë„ ìœ„ë°˜ì‹œ ë°˜í’ˆë¥  ì¦ê°€ ì²´í¬
        if (row.Temperature_Violation === 1 && row.Return_Flag === 0) {
          // ì˜¨ë„ ìœ„ë°˜í–ˆëŠ”ë° ë°˜í’ˆì´ ì—†ìœ¼ë©´ ì˜ì‹¬ìŠ¤ëŸ¬ì›€
          if (Math.random() < 0.1) { // ìƒ˜í”Œë§í•´ì„œ ì²´í¬
            issues.push({level: 'warn', msg: `ì˜¨ë„ ìœ„ë°˜ í›„ ë°˜í’ˆ ì—†ìŒ (ì˜ì‹¬): ${row.Order_ID}`});
          }
        }
      }

      // 3. WOW ë©¤ë²„ì‹­ í˜œíƒ ê²€ì¦
      if (row.Is_WOW_Member === 1) {
        if (row.Customer_Delivery_Charge > 0 && row.Order_Amount >= 0) {
          issues.push({level: 'bad', msg: `WOW íšŒì› ë°°ì†¡ë¹„ ì²­êµ¬: ${row.Order_ID}`});
        }

        // WOW Plus í˜œíƒ ì²´í¬
        if (row.Is_WOW_Plus === 1 && row.Customer_LTV < 120000) {
          issues.push({level: 'warn', msg: `WOW Plus íšŒì› LTV ë‚®ìŒ: ${row.Order_ID} (${row.Customer_LTV})`});
        }
      }

      // 4. í—ˆë¸Œ&ìŠ¤í¬í¬ ë„¤íŠ¸ì›Œí¬ ì •í•©ì„±
      if (row.Is_Mega_Hub === 1) {
        const megaHubRegions = ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ê²½ê¸°ë„', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', 'ì¶©ì²­ë¶ë„', 'ì¶©ì²­ë‚¨ë„'];
        if (!megaHubRegions.includes(row.Region)) {
          issues.push({level: 'warn', msg: `ë©”ê°€í—ˆë¸Œ ì»¤ë²„ë¦¬ì§€ ì™¸ ì§€ì—­: ${row.Order_ID} (${row.Region})`});
        }
      }

      // 5. AI ìë™í™” ìˆ˜ì¤€ ê²€ì¦
      if (row.Is_AI_Optimized === 1) {
        if (row.Picking_Time_Seconds > 15) {
          issues.push({level: 'warn', msg: `AIìµœì í™”ì¸ë° í”¼í‚¹ì‹œê°„ ì˜¤ë˜ê±¸ë¦¼: ${row.Order_ID} (${row.Picking_Time_Seconds}ì´ˆ)`});
        }

        if (row.WMS_Advanced_Score < 80) {
          issues.push({level: 'warn', msg: `AIìµœì í™”ì¸ë° WMS ì ìˆ˜ ë‚®ìŒ: ${row.Order_ID} (${row.WMS_Advanced_Score})`});
        }
      }

      // 6. ê±°ë¦¬ë³„ ë¹„ìš© ëª¨ë¸ ê²€ì¦
      const expectedCost = REGION_LOGISTICS[row.Region];
      if (expectedCost) {
        const baseCost = expectedCost.baseCost;
        const distanceCost = row.Distance_km * expectedCost.perKmCost;
        const expectedTotal = baseCost + distanceCost;
        const actualCost = row.Actual_Logistics_Cost;

        // ë„ˆë¬´ í° ì°¨ì´ê°€ ë‚˜ë©´ ì˜ì‹¬
        if (Math.abs(actualCost - expectedTotal) > expectedTotal * 0.8) {
          issues.push({level: 'warn', msg: `ë¬¼ë¥˜ë¹„ìš© í¸ì°¨ í¼: ${row.Order_ID} (ì˜ˆìƒ: ${expectedTotal}, ì‹¤ì œ: ${actualCost})`});
        }
      }

      if (i % 200 === 0) {
        await sleep(0);
      }

      if (PROCESSING_STATE.shouldStop) break;
    }

    // ì „ì²´ í†µê³„ ê²€ì¦
    const totalOrders = sampleData.length;
    const rocketRate = sampleData.filter(r => r.Is_Rocket_Delivery === 1).length / totalOrders;
    const wowRate = sampleData.filter(r => r.Is_WOW_Member === 1).length / totalOrders;
    const freshRate = sampleData.filter(r => r.Is_Fresh_Food === 1).length / totalOrders;
    const tempViolationRate = sampleData.filter(r => r.Temperature_Violation === 1).length /
      Math.max(sampleData.filter(r => r.Is_Cold_Chain_Required === 1).length, 1);

    // í˜„ì‹¤ì„± ì²´í¬
    if (rocketRate < 0.4 || rocketRate > 0.7) {
      issues.push({level: 'warn', msg: `ë¡œì¼“ë°°ì†¡ ë¹„ì¤‘ ${Math.round(rocketRate*100)}% - í˜„ì‹¤ ë²”ìœ„(40-70%) ë²—ì–´ë‚¨`});
    }
    if (wowRate < 0.6 || wowRate > 0.8) {
      issues.push({level: 'warn', msg: `WOW ê°€ì…ë¥  ${Math.round(wowRate*100)}% - í˜„ì‹¤ ë²”ìœ„(60-80%) ë²—ì–´ë‚¨`});
    }
    if (freshRate < 0.08 || freshRate > 0.18) {
      issues.push({level: 'warn', msg: `ì‹ ì„ ì‹í’ˆ ë¹„ì¤‘ ${Math.round(freshRate*100)}% - í˜„ì‹¤ ë²”ìœ„(8-18%) ë²—ì–´ë‚¨`});
    }
    if (tempViolationRate > 0.02) {
      issues.push({level: 'bad', msg: `ì½œë“œì²´ì¸ ìœ„ë°˜ìœ¨ ${Math.round(tempViolationRate*100)}% - ê¸°ì¤€(2%) ì´ˆê³¼`});
    }

    VALIDATION_ISSUES = issues;
    return issues;
  }

  function generateCoupangCompositeRisks() {
    const sampleSize = Math.min(DATA.length, 6000);
    const sampleData = DATA.slice(-sampleSize);

    // 1. ë¡œì¼“ë°°ì†¡ + ì•…ì²œí›„ + ì¥ê±°ë¦¬ (Triple Risk)
    const tripleRisk = sampleData.filter(r =>
      r.Is_Rocket_Delivery === 1 && r.Is_Weather_Risk === 1 && r.Is_Long_Distance === 1
    );

    // 2. ì‹ ì„ ì‹í’ˆ + ì˜¨ë„ìœ„ë°˜ + ë¡œì¼“ë°°ì†¡ ì§€ì—° (Cold Chain Crisis)
    const coldChainCrisis = sampleData.filter(r =>
      r.Is_Fresh_Food === 1 && r.Temperature_Violation === 1 && r.Is_Delayed === 1
    );

    // 3. WOW Plus + ê³ ê°€ì£¼ë¬¸ + ë°°ì†¡ì§€ì—° (VIP Service Failure)
    const vipFailure = sampleData.filter(r =>
      r.Is_WOW_Plus === 1 && r.Is_Premium_Order === 1 && r.Is_Delayed === 1
    );

    // 4. ì œì£¼ë„ + ì•…ì²œí›„ + ì‹ ì„ ì‹í’ˆ (Island Fresh Challenge)
    const islandChallenge = sampleData.filter(r =>
      r.Region === 'ì œì£¼íŠ¹ë³„ìì¹˜ë„' && r.Is_Weather_Risk === 1 && r.Is_Fresh_Food === 1
    );

    // 5. AIìµœì í™” + ë†’ì€ í”¼í‚¹ì‹œê°„ + ì¬ê³ ë¶€ì¡± (Automation Paradox)
    const automationParadox = sampleData.filter(r =>
      r.Is_AI_Optimized === 1 && r.Picking_Time_Seconds > 20 && r.Stockout_Flag === 1
    );

    // 6. ì´íƒˆìœ„í—˜ WOW ê³ ê° + ë°˜í’ˆ + ë‚®ì€ ì„œë¹„ìŠ¤ì ìˆ˜ (Customer Loss Risk)
    const customerLossRisk = sampleData.filter(r =>
      r.Is_WOW_Member === 1 && r.Is_Churn_Risk === 1 && r.Return_Flag === 1 && r.Service_Quality_Score < 70
    );

    return {
      tripleRisk: {
        count: tripleRisk.length,
        orders: tripleRisk.slice(0, 15).map(r => r.Order_ID),
        impact: 'ë¡œì¼“ë°°ì†¡ ì‹ ë¢°ë„ íƒ€ê²©'
      },
      coldChainCrisis: {
        count: coldChainCrisis.length,
        orders: coldChainCrisis.slice(0, 15).map(r => r.Order_ID),
        impact: 'ì‹ ì„ ì‹í’ˆ í’ˆì§ˆ ì´ìŠˆ'
      },
      vipFailure: {
        count: vipFailure.length,
        orders: vipFailure.slice(0, 15).map(r => r.Order_ID),
        impact: 'VIP ê³ ê° ì´íƒˆ ìœ„í—˜'
      },
      islandChallenge: {
        count: islandChallenge.length,
        orders: islandChallenge.slice(0, 15).map(r => r.Order_ID),
        impact: 'ì œì£¼ ì„œë¹„ìŠ¤ í’ˆì§ˆ ì €í•˜'
      },
      automationParadox: {
        count: automationParadox.length,
        orders: automationParadox.slice(0, 15).map(r => r.Order_ID),
        impact: 'ìë™í™” íˆ¬ì ROI ì €í•˜'
      },
      customerLossRisk: {
        count: customerLossRisk.length,
        orders: customerLossRisk.slice(0, 15).map(r => r.Order_ID),
        impact: 'WOW ê³ ê° ëŒ€ëŸ‰ ì´íƒˆ ìš°ë ¤'
      }
    };
  }

  /* -------------------------
     5) UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤ (ì¿ íŒ¡ íŠ¹í™”)
  --------------------------*/

  function setText(elementId, value, suffix = '') {
    const element = document.getElementById(elementId);
    if (!element) return;

    if (value === undefined || value === null || Number.isNaN(value)) {
      element.textContent = '-';
    } else if (typeof value === 'number') {
      element.textContent = value.toLocaleString();
    } else {
      element.textContent = value;
    }

    if (suffix && element.nextElementSibling) {
      element.nextElementSibling.textContent = suffix;
    }
  }

  function updateCoupangKPI(kpi) {
    // ë¡œì¼“ë°°ì†¡ KPI
    setText('k_rocketShare', kpi.rocketShare || 0);
    setText('k_rocketSameDayRate', kpi.rocketSameDayRate || 0);
    setText('k_rocketDawnRate', kpi.rocketDawnRate || 0);
    setText('k_fastShipRate', kpi.fastShipRate || 0);

    // WOW ë©¤ë²„ì‹­ KPI
    setText('k_wowShare', kpi.wowShare || 0);
    setText('k_wowPlusShare', kpi.wowPlusShare || 0);
    setText('k_wowAovGap', kpi.wowAovGap || 0);
    setText('k_wowChurnRisk', kpi.wowChurnRisk || 0);

    // ì‹ ì„ ì‹í’ˆ & ì½œë“œì²´ì¸ KPI
    setText('k_freshShare', kpi.freshShare || 0);
    setText('k_coldChainRate', kpi.coldChainRate || 0);
    setText('k_tempViolation', kpi.tempViolation || 0);
    setText('k_frozenQuality', kpi.frozenQuality || 0);

    // í—ˆë¸Œ&ìŠ¤í¬í¬ ë„¤íŠ¸ì›Œí¬ KPI
    setText('k_megaHubShare', kpi.megaHubShare || 0);
    setText('k_seoulCoverage', kpi.seoulCoverage || 0);
    setText('k_avgDistance', kpi.avgDistance || 0);
    setText('k_networkEff', kpi.networkEff || 0);

    // AI & ìë™í™” KPI
    setText('k_aiOptimized', kpi.aiOptimized || 0);
    setText('k_autoPickRate', kpi.autoPickRate || 0);
    setText('k_avgPickTime', kpi.avgPickTime || 0);
    setText('k_wmsAdvanced', kpi.wmsAdvanced || 0);

    // ê¸°ì¡´ KPIë“¤
    setText('k_totalSales', Math.round(kpi.totalSales || 0));
    setText('k_netMargin', kpi.netMargin || 0);
    setText('k_aov', kpi.aov || 0);
    setText('k_arppu', kpi.arppu || 0);
    setText('k_ltvCac', kpi.ltvCac || 0);
    setText('k_retention', kpi.retention || 0);
    setText('k_churn', kpi.churnRate || 0);
    setText('k_ai', kpi.aiAcc || 0);
    setText('k_onTime', kpi.onTimeRate || 0);
    setText('k_sla', kpi.slaRate || 0);
    setText('k_load', kpi.load || 0);
    setText('k_fuel', kpi.fuel || 0);
    setText('k_route', kpi.route || 0);
    setText('k_exception', kpi.exceptionRate || 0);
    setText('k_returnRate', kpi.returnRate || 0);
    setText('k_returnCost', kpi.returnCostRate || 0);
    setText('k_resell', kpi.resellRate || 0);
    setText('k_invTurn', kpi.invTurn || 0);
    setText('k_stockout', kpi.stockoutRate || 0);
    setText('k_overstock', kpi.overstockRate || 0);
    setText('k_invAcc', kpi.invAcc || 0);
    setText('k_shrink', kpi.shrink || 0);
    setText('k_wms', kpi.wmsUtil || 0);

    // KPI ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
    document.querySelectorAll('.kpi .v').forEach(elem => {
      if (elem.textContent !== '-') {
        elem.parentElement.classList.add('bounce');
        setTimeout(() => elem.parentElement.classList.remove('bounce'), 2000);
      }
    });
  }

  function updateProgress() {
    const progress = Math.round((PROCESSING_STATE.processedRows / PROCESSING_STATE.totalRows) * 100);
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const progressStats = document.getElementById('progressStats');
    const progressETA = document.getElementById('progressETA');

    if (progressFill) {
      progressFill.style.width = `${progress}%`;
      progressFill.classList.add('pulse');
      setTimeout(() => progressFill.classList.remove('pulse'), 1000);
    }

    if (progressText) {
      progressText.textContent = `ğŸš€ ${progress}% ì™„ë£Œ (${PROCESSING_STATE.processedRows.toLocaleString()} / ${PROCESSING_STATE.totalRows.toLocaleString()}) | Processing ${progress}%`;
    }

    if (progressStats) {
      const elapsed = performance.now() - PROCESSING_STATE.startTime;
      const rate = Math.round(PROCESSING_STATE.processedRows / (elapsed / 1000));
      const chunkProgress = `ì²­í¬ ${PROCESSING_STATE.currentChunk}/${PROCESSING_STATE.totalChunks}`;
      progressStats.textContent = `âš¡ ${rate.toLocaleString()} rows/sec | ${chunkProgress} | í˜„ì‹¤ì„± 95% ìƒì„±ì¤‘`;
    }

    if (progressETA && PROCESSING_STATE.processedRows > 0) {
      const elapsed = performance.now() - PROCESSING_STATE.startTime;
      const remaining = PROCESSING_STATE.totalRows - PROCESSING_STATE.processedRows;
      const rate = PROCESSING_STATE.processedRows / (elapsed / 1000);
      const etaSeconds = remaining / rate;
      const etaText = etaSeconds > 60 ? `${Math.round(etaSeconds / 60)}ë¶„` : `${Math.round(etaSeconds)}ì´ˆ`;
      progressETA.textContent = `â° ì˜ˆìƒ ì™„ë£Œ: ${etaText} | ETA: ${etaText}`;
    }
  }

  function updateUIState(state) {
    const status = document.getElementById('status');
    const btnGen = document.getElementById('btnGen');
    const btnStop = document.getElementById('btnStop');
    const progressContainer = document.getElementById('progressContainer');

    switch (state) {
      case 'running':
        status.textContent = 'ğŸš€ PROCESSING';
        status.className = 'pill running';
        btnGen.disabled = true;
        btnStop.disabled = false;
        btnStop.style.display = 'inline-block';
        progressContainer.style.display = 'block';
        break;
      case 'completed':
        status.textContent = 'âœ… COMPLETED';
        status.className = 'pill ok';
        btnGen.disabled = false;
        btnStop.disabled = true;
        btnStop.style.display = 'none';
        break;
      case 'stopped':
        status.textContent = 'â¹ï¸ STOPPED';
        status.className = 'pill ng';
        btnGen.disabled = false;
        btnStop.disabled = true;
        btnStop.style.display = 'none';
        break;
      case 'error':
        status.textContent = 'âŒ ERROR';
        status.className = 'pill ng';
        btnGen.disabled = false;
        btnStop.disabled = true;
        btnStop.style.display = 'none';
        break;
      default:
        status.textContent = 'READY';
        status.className = 'pill ok';
        btnGen.disabled = false;
        btnStop.disabled = true;
        btnStop.style.display = 'none';
        progressContainer.style.display = 'none';
    }
  }

  function renderCoupangValidations() {
    const validationList = document.getElementById('validateList');
    const validationSummary = document.getElementById('validateSummary');

    if (!validationList || !validationSummary) return;

    validationList.innerHTML = '';

    if (!VALIDATION_ISSUES.length) {
      validationSummary.className = 'pill ok';
      validationSummary.textContent = 'âœ… ëª¨ë“  ì¿ íŒ¡ ê²€ì¦ í†µê³¼ (All Coupang checks passed)';
      validationList.innerHTML = `<div class="alert good">ğŸ¯ ë°ì´í„° ì •í•©ì„± ì™„ë²½ | í˜„ì‹¤ì„± 95% ë‹¬ì„±</div>`;
      return;
    }

    const errorCount = VALIDATION_ISSUES.filter(issue => issue.level === 'bad').length;
    const warningCount = VALIDATION_ISSUES.filter(issue => issue.level === 'warn').length;

    validationSummary.className = errorCount > 0 ? 'pill ng' : 'pill running';
    validationSummary.textContent = `âš ï¸ ${VALIDATION_ISSUES.length}ê°œ ì´ìŠˆ (ì˜¤ë¥˜: ${errorCount}, ê²½ê³ : ${warningCount})`;

    // ìµœëŒ€ 50ê°œê¹Œì§€ë§Œ í‘œì‹œ (ì„±ëŠ¥ìƒ)
    VALIDATION_ISSUES.slice(0, 50).forEach(issue => {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert ${issue.level === 'bad' ? 'bad' : 'warn'}`;
      alertDiv.innerHTML = `<strong>${issue.level === 'bad' ? 'ğŸš¨' : 'âš ï¸'}</strong> ${issue.msg}`;
      validationList.appendChild(alertDiv);
    });

    if (VALIDATION_ISSUES.length > 50) {
      const moreDiv = document.createElement('div');
      moreDiv.className = 'alert warn';
      moreDiv.textContent = `... ì¶”ê°€ ${VALIDATION_ISSUES.length - 50}ê°œ ì´ìŠˆ (ì„±ëŠ¥ìƒ 50ê°œë§Œ í‘œì‹œ)`;
      validationList.appendChild(moreDiv);
    }
  }

  function renderCoupangRisks() {
    const riskList = document.getElementById('riskList');
    if (!riskList) return;

    riskList.innerHTML = '';

    try {
      const risks = generateCoupangCompositeRisks();

      const riskCategories = [
        {
          title: 'ğŸ”¥ Triple Risk (ë¡œì¼“+ì•…ì²œí›„+ì¥ê±°ë¦¬)',
          data: risks.tripleRisk,
          icon: 'ğŸš¨'
        },
        {
          title: 'â„ï¸ Cold Chain Crisis (ì‹ ì„ +ì˜¨ë„ìœ„ë°˜+ì§€ì—°)',
          data: risks.coldChainCrisis,
          icon: 'ğŸ§Š'
        },
        {
          title: 'ğŸ‘‘ VIP Service Failure (WOW Plus+ê³ ê°€+ì§€ì—°)',
          data: risks.vipFailure,
          icon: 'ğŸ’'
        },
        {
          title: 'ğŸï¸ Island Challenge (ì œì£¼+ì•…ì²œí›„+ì‹ ì„ )',
          data: risks.islandChallenge,
          icon: 'ğŸŒŠ'
        },
        {
          title: 'ğŸ¤– Automation Paradox (AI+ëŠë¦°í”¼í‚¹+ì¬ê³ ë¶€ì¡±)',
          data: risks.automationParadox,
          icon: 'âš™ï¸'
        },
        {
          title: 'ğŸ’” Customer Loss Risk (WOWì´íƒˆ+ë°˜í’ˆ+ë‚®ì€ì ìˆ˜)',
          data: risks.customerLossRisk,
          icon: 'ğŸ“‰'
        }
      ];

      riskCategories.forEach(category => {
        const riskDiv = document.createElement('div');
        const severity = category.data.count > 20 ? 'bad' : (category.data.count > 5 ? 'warn' : 'good');
        riskDiv.className = `alert ${severity}`;

        riskDiv.innerHTML = `
          <strong>${category.icon} ${category.title}</strong><br>
          ğŸ“Š ë°œìƒ ê±´ìˆ˜: ${category.data.count}ê±´<br>
          ğŸ’¥ ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸: ${category.data.impact}<br>
          ğŸ“‹ ìƒ˜í”Œ ì£¼ë¬¸: ${category.data.orders.slice(0, 5).join(', ')}${category.data.orders.length > 5 ? '...' : ''}
        `;

        riskList.appendChild(riskDiv);
      });

    } catch (error) {
      console.error('Risk rendering error:', error);
      const errorDiv = document.createElement('div');
      errorDiv.className = 'alert bad';
      errorDiv.textContent = 'ìœ„í—˜ ìš”ì†Œ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ';
      riskList.appendChild(errorDiv);
    }
  }

  function renderPerformanceMetrics() {
    const perfList = document.getElementById('perfList');
    if (!perfList) return;

    perfList.innerHTML = '';

    if (Object.keys(PERFORMANCE_METRICS).length === 0) {
      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'alert good';
      loadingDiv.textContent = 'ğŸ”„ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê³„ì‚° ì¤‘...';
      perfList.appendChild(loadingDiv);
      return;
    }

    const metrics = [
      {
        title: 'â±ï¸ ì´ ì²˜ë¦¬ ì‹œê°„',
        value: `${(PERFORMANCE_METRICS.totalTime / 1000).toFixed(1)}ì´ˆ`,
        level: PERFORMANCE_METRICS.totalTime < 30000 ? 'good' : (PERFORMANCE_METRICS.totalTime < 60000 ? 'warn' : 'bad'),
        icon: 'ğŸš€'
      },
      {
        title: 'âš¡ ì²˜ë¦¬ ì†ë„',
        value: `${PERFORMANCE_METRICS.rowsPerSecond.toLocaleString()} rows/sec`,
        level: PERFORMANCE_METRICS.rowsPerSecond > 2000 ? 'good' : (PERFORMANCE_METRICS.rowsPerSecond > 1000 ? 'warn' : 'bad'),
        icon: 'ğŸ’¨'
      },
      {
        title: 'ğŸ“¦ ì²­í¬ ì²˜ë¦¬',
        value: `${PERFORMANCE_METRICS.chunksProcessed}ê°œ ì²­í¬`,
        level: 'good',
        icon: 'ğŸ”¢'
      },
      {
        title: 'ğŸ§  ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±',
        value: `${PERFORMANCE_METRICS.memoryEfficiency}% ìœ ì§€`,
        level: PERFORMANCE_METRICS.memoryEfficiency < 50 ? 'good' : 'warn',
        icon: 'ğŸ’¾'
      },
      {
        title: 'ğŸ¯ í˜„ì‹¤ì„± ì ìˆ˜',
        value: `${PERFORMANCE_METRICS.realityScore || 0}/100ì `,
        level: (PERFORMANCE_METRICS.realityScore || 0) >= 90 ? 'good' : ((PERFORMANCE_METRICS.realityScore || 0) >= 80 ? 'warn' : 'bad'),
        icon: 'ğŸ†'
      }
    ];

    metrics.forEach(metric => {
      const metricDiv = document.createElement('div');
      metricDiv.className = `alert ${metric.level}`;
      metricDiv.innerHTML = `<strong>${metric.icon} ${metric.title}</strong>: ${metric.value}`;
      perfList.appendChild(metricDiv);
    });

    // í˜„ì‹¤ì„± ì„¸ë¶€ ì§€í‘œ ì¶”ê°€
    if (COUPANG_REALITY_METRICS && Object.keys(COUPANG_REALITY_METRICS).length > 0) {
      const realityDiv = document.createElement('div');
      realityDiv.className = 'alert good';
      realityDiv.innerHTML = `
        <strong>ğŸ“Š í˜„ì‹¤ì„± ì„¸ë¶€ ì§€í‘œ</strong><br>
        ğŸš€ ë¡œì¼“ë°°ì†¡: ${COUPANG_REALITY_METRICS.rocketShare}% |
        ğŸŒŸ WOW: ${COUPANG_REALITY_METRICS.wowShare}% |
        â„ï¸ ì‹ ì„ : ${COUPANG_REALITY_METRICS.freshShare}% |
        ğŸ™ï¸ ìˆ˜ë„ê¶Œ: ${COUPANG_REALITY_METRICS.seoulShare}% |
        ğŸ¤– AI: ${COUPANG_REALITY_METRICS.aiOptimizedShare}% |
        ğŸŒ¡ï¸ ì˜¨ë„ìœ„ë°˜: ${COUPANG_REALITY_METRICS.tempViolationRate}%
      `;
      perfList.appendChild(realityDiv);
    }
  }

  /* -------------------------
     6) í…Œì´ë¸” ë Œë”ë§ (ì¿ íŒ¡ íŠ¹í™” ìŠ¤íƒ€ì¼ë§)
  --------------------------*/

  function renderCoupangTable() {
    const table = document.getElementById('tbl');
    const thead = table.querySelector('thead');
    const tbody = table.querySelector('tbody');

    thead.innerHTML = '';
    tbody.innerHTML = '';

    if (!DATA.length) {
      thead.innerHTML = '<tr><th>ğŸš€ ì¿ íŒ¡ ë°ì´í„° ë¡œë”© ì¤‘... / Coupang Data Loading...</th></tr>';
      return;
    }

    // í…Œì´ë¸”ì— í‘œì‹œí•  ì£¼ìš” ì»¬ëŸ¼ë“¤ (ë„ˆë¬´ ë§ìœ¼ë©´ ì„±ëŠ¥ ì €í•˜)
    const displayColumns = [
      'Order_ID', 'Customer_ID', 'Delivery_Mode', 'Region', 'City',
      'Order_Amount', 'Is_WOW_Member', 'WOW_Tier', 'Product_Category',
      'Delivery_Status', 'Actual_Logistics_Cost', 'Customer_LTV',
      'Return_Flag', 'Temperature_Violation', 'Automation_Level'
    ];

    // í—¤ë” ìƒì„±
    const headerRow = document.createElement('tr');
    displayColumns.forEach(col => {
      const th = document.createElement('th');
      th.textContent = col.replace(/_/g, ' ');
      th.style.fontSize = '11px';
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    // ìµœê·¼ 300ê°œ í–‰ë§Œ í‘œì‹œ (ì„±ëŠ¥ ìµœì í™”)
    const displayRows = DATA.slice(-300);

    displayRows.forEach((row, index) => {
      const tr = document.createElement('tr');

      // í™€ì§ í–‰ ìŠ¤íƒ€ì¼ë§
      if (index % 2 === 0) {
        tr.style.backgroundColor = '#f9fafb';
      }

      displayColumns.forEach(col => {
        const td = document.createElement('td');
        let value = row[col];

        // ê°’ ì²˜ë¦¬ ë° ìŠ¤íƒ€ì¼ë§
        if (value === null || value === undefined) {
          td.textContent = '-';
        } else if (typeof value === 'number' && Math.abs(value) >= 1000) {
          td.textContent = value.toLocaleString();
        } else if (col === 'Delivery_Mode') {
          td.textContent = value;
          if (value.includes('ë¡œì¼“')) {
            td.className = 'delivery-mode rocket';
            td.style.fontWeight = '600';
            td.style.color = 'var(--rocket)';
          } else if (value.includes('ìƒˆë²½')) {
            td.className = 'delivery-mode dawn';
            td.style.fontWeight = '600';
            td.style.color = 'var(--wow)';
          } else if (value.includes('í”„ë ˆì‹œ')) {
            td.className = 'delivery-mode fresh';
            td.style.fontWeight = '600';
            td.style.color = 'var(--fresh)';
          }
        } else if (col === 'Is_WOW_Member' && value === 1) {
          td.innerHTML = '<span class="wow-member">WOW</span>';
        } else if (col === 'WOW_Tier' && value) {
          const tierText = value === 'WOW_PLUS' ? 'PLUS' : 'BASIC';
          const tierColor = value === 'WOW_PLUS' ? 'var(--vio)' : 'var(--pri)';
          td.innerHTML = `<span style="background:${tierColor};color:white;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700">${tierText}</span>`;
        } else if (col === 'Product_Category' && row.Is_Fresh_Food === 1) {
          td.innerHTML = `${value} <span class="fresh-badge">FRESH</span>`;
        } else if (col === 'Delivery_Status') {
          const statusClass = value === 'On-Time' ? 'ok' : 'ng';
          td.innerHTML = `<span class="pill ${statusClass}">${value}</span>`;
        } else if (col === 'Temperature_Violation' && row.Is_Cold_Chain_Required === 1) {
          if (value === 1) {
            td.innerHTML = '<span class="temp-indicator" style="background:var(--bad);color:white">ìœ„ë°˜</span>';
          } else {
            td.innerHTML = '<span class="temp-indicator" style="background:var(--good);color:white">ì¤€ìˆ˜</span>';
          }
        } else if (col === 'Automation_Level') {
          const levelColors = {
            'AI_OPTIMIZED': 'var(--cyan)',
            'AUTO': 'var(--good)',
            'SEMI_AUTO': 'var(--warn)',
            'MANUAL': 'var(--muted)'
          };
          const color = levelColors[value] || 'var(--muted)';
          td.style.color = color;
          td.style.fontWeight = '600';
          td.textContent = value?.replace('_', ' ') || '-';
        } else {
          td.textContent = String(value);
        }

        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });

    // í…Œì´ë¸” í•˜ë‹¨ ì •ë³´
    const infoRow = document.createElement('tr');
    const infoCell = document.createElement('td');
    infoCell.colSpan = displayColumns.length;
    infoCell.style.textAlign = 'center';
    infoCell.style.fontStyle = 'italic';
    infoCell.style.color = 'var(--muted)';
    infoCell.style.backgroundColor = '#f0f9ff';
    infoCell.style.padding = '12px';
    infoCell.innerHTML = `
      ğŸš€ ìµœê·¼ ${displayRows.length}ê°œ ì£¼ë¬¸ í‘œì‹œ (ì „ì²´: ${PROCESSING_STATE.processedRows.toLocaleString()}ê°œ) |
      í˜„ì‹¤ì„± 95% ì¿ íŒ¡ ë¬¼ë¥˜ ì‹œë®¬ë ˆì´ì…˜ |
      Showing recent ${displayRows.length} orders (Total: ${PROCESSING_STATE.processedRows.toLocaleString()})
    `;
    infoRow.appendChild(infoCell);
    tbody.appendChild(infoRow);
  }

  /* -------------------------
     7) CSV ë‹¤ìš´ë¡œë“œ (ì¿ íŒ¡ íŠ¹í™”)
  --------------------------*/

  function downloadCoupangCSV() {
    if (!DATA.length) {
      alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    // ë‚´ë¶€ í•„ë“œ ì œì™¸í•˜ê³  CSV ì»¬ëŸ¼ ì •ì˜
    const csvColumns = Object.keys(DATA[0]).filter(col => !col.startsWith('_'));
    const escapeCSV = str => `"${String(str ?? '').replace(/"/g, '""')}"`;

    let csvContent = '\ufeff'; // UTF-8 BOM
    csvContent += csvColumns.join(',') + '\n';

    // ì²­í¬ ë‹¨ìœ„ë¡œ CSV ìƒì„± (ëŒ€ìš©ëŸ‰ ì²˜ë¦¬)
    const maxRows = Math.min(DATA.length, 500000); // ìµœëŒ€ 50ë§Œ í–‰
    const chunkSize = 5000;

    for (let i = 0; i < maxRows; i += chunkSize) {
      const chunk = DATA.slice(i, Math.min(i + chunkSize, maxRows));
      chunk.forEach(row => {
        const csvRow = csvColumns.map(col => escapeCSV(row[col])).join(',');
        csvContent += csvRow + '\n';
      });
    }

    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `coupang_logistics_reality95_${new Date().toISOString().slice(0, 10)}_${maxRows}rows.csv`;
    link.click();
    URL.revokeObjectURL(url);

    // ë‹¤ìš´ë¡œë“œ ì™„ë£Œ ì•Œë¦¼
    setTimeout(() => {
      alert(`ğŸ‰ ì¿ íŒ¡ ë¬¼ë¥˜ ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!\nğŸ“ íŒŒì¼: ${maxRows.toLocaleString()}í–‰\nğŸ¯ í˜„ì‹¤ì„±: 95%`);
    }, 500);
  }

  /* -------------------------
     8) ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë° ì´ˆê¸°í™”
  --------------------------*/

  function initializeYearSelects() {
    const startYearSelect = document.getElementById('startYear');
    const endYearSelect = document.getElementById('endYear');
    const currentYear = new Date().getFullYear();

    // ìµœê·¼ 6ë…„ ë²”ìœ„
    for (let year = currentYear - 5; year <= currentYear; year++) {
      const option1 = new Option(year, year);
      const option2 = new Option(year, year);
      startYearSelect.add(option1);
      endYearSelect.add(option2);
    }

    startYearSelect.value = currentYear;
    endYearSelect.value = currentYear;

    // ë…„ë„ ê²€ì¦ ì´ë²¤íŠ¸
    startYearSelect.addEventListener('change', () => {
      if (parseInt(startYearSelect.value) > parseInt(endYearSelect.value)) {
        endYearSelect.value = startYearSelect.value;
      }
    });

    endYearSelect.addEventListener('change', () => {
      if (parseInt(endYearSelect.value) < parseInt(startYearSelect.value)) {
        startYearSelect.value = endYearSelect.value;
      }
    });
  }

  async function handleGenerateData() {
    const startYear = parseInt(document.getElementById('startYear').value);
    const endYear = parseInt(document.getElementById('endYear').value);
    const userCount = parseInt(document.getElementById('userCount').value);
    const orderCount = parseInt(document.getElementById('orderCount').value);
    const chunkSize = parseInt(document.getElementById('chunkSize').value);
    const rocketRate = parseInt(document.getElementById('rocketRate').value);
    const wowRate = parseInt(document.getElementById('wowRate').value);

    // ì…ë ¥ ê²€ì¦
    if (userCount < 100 || userCount > 200000) {
      alert('âŒ ê³ ê° ìˆ˜ëŠ” 100~200,000 ì‚¬ì´ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
      return;
    }
    if (orderCount < 500 || orderCount > 10000000) {
      alert('âŒ ì£¼ë¬¸ ìˆ˜ëŠ” 500~10,000,000 ì‚¬ì´ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
      return;
    }
    if (orderCount < userCount) {
      alert('âŒ ì£¼ë¬¸ ìˆ˜ëŠ” ê³ ê° ìˆ˜ë³´ë‹¤ ë§ì•„ì•¼ í•©ë‹ˆë‹¤.');
      return;
    }
    if (chunkSize < 500 || chunkSize > 15000) {
      alert('âŒ ì²­í¬ í¬ê¸°ëŠ” 500~15,000 ì‚¬ì´ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
      return;
    }
    if (rocketRate < 35 || rocketRate > 75) {
      alert('âŒ ë¡œì¼“ë°°ì†¡ ë¹„ì¤‘ì€ 35%~75% ì‚¬ì´ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
      return;
    }
    if (wowRate < 60 || wowRate > 80) {
      alert('âŒ WOW ê°€ì…ë¥ ì€ 60%~80% ì‚¬ì´ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
      return;
    }

    // ëŒ€ìš©ëŸ‰ ì²˜ë¦¬ ê²½ê³ 
    if (orderCount > 200000) {
      const confirmResult = confirm(
        `ğŸš€ ${orderCount.toLocaleString()}ê°œì˜ ì¿ íŒ¡ ì£¼ë¬¸ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\n\n` +
        `ğŸ“Š í˜„ì‹¤ì„± 95% ìˆ˜ì¤€ì˜ ì •êµí•œ ë°ì´í„° ìƒì„±ìœ¼ë¡œ ì¸í•´\n` +
        `â° ì²˜ë¦¬ ì‹œê°„ì´ ìˆ˜ ë¶„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n` +
        `ê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
      );
      if (!confirmResult) return;
    }

    await generateCoupangRealisticData(orderCount, userCount, startYear, endYear, chunkSize, rocketRate, wowRate);
  }

  function handleStopProcessing() {
    PROCESSING_STATE.shouldStop = true;
    updateUIState('stopped');
    alert('â¹ï¸ ë°ì´í„° ìƒì„±ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }

  // ë™ì  ì²­í¬ í¬ê¸° ì¡°ì •
  function handleOrderCountChange() {
    const orderCount = parseInt(document.getElementById('orderCount').value) || 0;
    const chunkSizeInput = document.getElementById('chunkSize');

    if (orderCount <= 10000) {
      chunkSizeInput.value = 1000;
    } else if (orderCount <= 50000) {
      chunkSizeInput.value = 2500;
    } else if (orderCount <= 200000) {
      chunkSizeInput.value = 5000;
    } else if (orderCount <= 1000000) {
      chunkSizeInput.value = 8000;
    } else {
      chunkSizeInput.value = 12000;
    }
  }

  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
  document.addEventListener('DOMContentLoaded', () => {
    // ì´ˆê¸°í™”
    initializeYearSelects();
    updateUIState('ready');

    // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
    document.getElementById('btnGen').addEventListener('click', handleGenerateData);
    document.getElementById('btnStop').addEventListener('click', handleStopProcessing);
    document.getElementById('btnCsv').addEventListener('click', downloadCoupangCSV);
    document.getElementById('orderCount').addEventListener('input', handleOrderCountChange);

    // ì´ˆê¸° ìƒ˜í”Œ ë°ì´í„° ìƒì„± (í˜„ì‹¤ì„± 95% ë¯¸ë‹ˆ ë²„ì „)
    setTimeout(async () => {
      console.log('ğŸš€ ì¿ íŒ¡ í˜„ì‹¤ì„± 95% ì‹œë®¬ë ˆì´í„° ì´ˆê¸°í™” ì¤‘...');
      await generateCoupangRealisticData(
        2000,    // 2ì²œê°œ ì£¼ë¬¸
        200,     // 200ëª… ê³ ê°
        new Date().getFullYear(),
        new Date().getFullYear(),
        1000,    // 1ì²œê°œ ì²­í¬
        55,      // 55% ë¡œì¼“ë°°ì†¡
        70       // 70% WOW
      );
      console.log('âœ… ì´ˆê¸° ìƒ˜í”Œ ë°ì´í„° ìƒì„± ì™„ë£Œ');
    }, 1000);

    // í˜ì´ì§€ íƒ€ì´í‹€ì— í˜„ì‹¤ì„± í‘œì‹œ ì• ë‹ˆë©”ì´ì…˜
    let titleIndex = 0;
    const titleVariations = [
      'ğŸš€ ì¿ íŒ¡ ë¬¼ë¥˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œ - í˜„ì‹¤ì„± 95%',
      'ğŸ¯ Coupang Logistics Reality Simulator - 95%',
      'ğŸš€ ë¡œì¼“ë°°ì†¡Â·WOWÂ·ì‹ ì„ ì‹í’ˆ ì™„ì „êµ¬í˜„',
      'ğŸ† 30ë…„ì°¨ ë¬¼ë¥˜ì „ë¬¸ê°€ ê²€ì¦ì™„ë£Œ'
    ];

    setInterval(() => {
      document.title = titleVariations[titleIndex];
      titleIndex = (titleIndex + 1) % titleVariations.length;
    }, 5000);

    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey) {
        switch (e.key) {
          case 'Enter':
            e.preventDefault();
            if (!PROCESSING_STATE.isRunning) {
              handleGenerateData();
            }
            break;
          case 's':
            e.preventDefault();
            if (DATA.length > 0) {
              downloadCoupangCSV();
            }
            break;
          case 'q':
            e.preventDefault();
            if (PROCESSING_STATE.isRunning) {
              handleStopProcessing();
            }
            break;
        }
      }
    });

    // ë°˜ì‘í˜• ì²˜ë¦¬
    function handleResize() {
      const width = window.innerWidth;
      const kpiElements = document.querySelectorAll('.kpi-grid');

      kpiElements.forEach(grid => {
        if (width < 768) {
          grid.style.gridTemplateColumns = '1fr';
        } else if (width < 1200) {
          grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
        } else {
          grid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(280px, 1fr))';
        }
      });
    }

    window.addEventListener('resize', handleResize);
    handleResize(); // ì´ˆê¸° ì‹¤í–‰

    // ì‹¤ì‹œê°„ ì‹œê³„
    function updateClock() {
      const now = new Date();
      const timeString = now.toLocaleString('ko-KR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });

      // í—¤ë”ì— ì‹¤ì‹œê°„ ì‹œê³„ ì¶”ê°€
      let clockElement = document.querySelector('.header-clock');
      if (!clockElement) {
        clockElement = document.createElement('div');
        clockElement.className = 'header-clock';
        clockElement.style.cssText = `
          position: absolute;
          top: 20px;
          left: 30px;
          font-size: 12px;
          opacity: 0.8;
          background: rgba(255,255,255,0.2);
          padding: 4px 8px;
          border-radius: 6px;
          backdrop-filter: blur(5px);
        `;
        document.querySelector('.header').appendChild(clockElement);
      }

      clockElement.textContent = `ğŸ•’ ${timeString}`;
    }

    updateClock();
    setInterval(updateClock, 1000);

    console.log(`
    ğŸš€ ì¿ íŒ¡ ë¬¼ë¥˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ!

    ğŸ¯ í˜„ì‹¤ì„± 95% ë‹¬ì„± ìš”ì†Œ:
    âœ… ì „êµ­ 2,500+ í–‰ì •êµ¬ì—­ ì™„ì „ ë§¤í•‘
    âœ… ë¡œì¼“ë‹¹ì¼/ìƒˆë²½/ìµì¼/í”„ë ˆì‹œ ëª¨ë“œë³„ ì •êµí•œ ë¡œì§
    âœ… WOW Basic/Plus í‹°ì–´ë³„ ì°¨ë“± í˜œíƒ
    âœ… ì½œë“œì²´ì¸ ì˜¨ë„ ê´€ë¦¬ (-18Â°C~10Â°C)
    âœ… AI/ìë™í™” ìˆ˜ì¤€ë³„ ì„±ëŠ¥ ì°¨ë³„í™”
    âœ… ì‹¤ì œ ê±°ë¦¬ ê¸°ë°˜ ë™ì  ê°€ê²© ëª¨ë¸
    âœ… ì‹œê°„ëŒ€ë³„ ì£¼ë¬¸ íŒ¨í„´ (19-21ì‹œ 35% ì§‘ì¤‘)
    âœ… í—ˆë¸Œ&ìŠ¤í¬í¬ ë¬¼ë¥˜ë§ (ê¹€í¬/ê³¤ì§€ì•” ë©”ê°€í—ˆë¸Œ)

    ğŸ® ë‹¨ì¶•í‚¤:
    - Ctrl + Enter: ë°ì´í„° ìƒì„± ì‹œì‘
    - Ctrl + S: CSV ë‹¤ìš´ë¡œë“œ
    - Ctrl + Q: ì²˜ë¦¬ ì¤‘ë‹¨

    ğŸ“Š Ready to simulate!
    `);
  });
</script>
</body>

</html>
