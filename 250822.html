<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>ğŸš€ ì¿ íŒ¡ ë¬¼ë¥˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œ - í†µí•© ì•ˆì •íŒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root {
      --bg: #f7fafc;
      --card: #fff;
      --ink: #1f2937;
      --muted: #6b7280;
      --line: #e5e7eb;
      --pri: #2563eb;
      --good: #10b981;
      --warn: #f59e0b;
      --bad: #ef4444;
      --vio: #8b5cf6;
      --cyan: #06b6d4;
      --rocket: #ff6b35;
      --wow: #9333ea;
      --fresh: #059669
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", Segoe UI, Roboto, Helvetica, Arial
    }

    .wrap {
      max-width: 1800px;
      margin: 0 auto;
      padding: 20px
    }

    .header {
      background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #9333ea 100%);
      color: #fff;
      border-radius: 16px;
      padding: 28px 32px;
      margin-bottom: 20px;
      box-shadow: 0 12px 32px rgba(255, 107, 53, .25);
      position: relative;
      overflow: hidden
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255, 255, 255, .05) 10px, rgba(255, 255, 255, .05) 20px);
      animation: slide 20s linear infinite
    }

    @keyframes slide {
      0% {
        transform: translateX(-50px)
      }
      100% {
        transform: translateX(50px)
      }
    }

    .header h1 {
      margin: 0 0 8px 0;
      font-size: 24px;
      position: relative;
      z-index: 1
    }

    .header .sub {
      opacity: .9;
      font-size: 14px;
      position: relative;
      z-index: 1
    }

    .header .reality-badge {
      position: absolute;
      top: 20px;
      right: 30px;
      background: rgba(255, 255, 255, .2);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 700;
      border: 1px solid rgba(255, 255, 255, .3)
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 20px;
      margin: 16px 0;
      box-shadow: 0 6px 20px rgba(2, 6, 23, .08)
    }

    .controls {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      align-items: flex-end
    }

    .ctrl {
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .ctrl label {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600
    }

    .ctrl input, .ctrl select {
      padding: 8px 12px;
      border: 1px solid var(--line);
      border-radius: 10px;
      min-width: 130px
    }

    .btn {
      background: var(--pri);
      color: #fff;
      border: none;
      padding: 12px 18px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all .3s
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(37, 99, 235, .3)
    }

    .btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none
    }

    .btn.secondary {
      background: #374151
    }

    .btn.danger {
      background: var(--bad)
    }

    .btn.rocket {
      background: var(--rocket)
    }

    .btn.wow {
      background: var(--wow)
    }

    .progress-container {
      margin: 12px 0;
      display: none
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background: var(--line);
      border-radius: 6px;
      overflow: hidden
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(45deg, var(--rocket), var(--wow));
      width: 0%;
      transition: width .3s ease
    }

    .progress-text {
      font-size: 13px;
      color: var(--muted);
      margin-top: 6px;
      text-align: center;
      font-weight: 600
    }

    .progress-stats {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px
    }

    .kpi-grid {
      display: grid;
      grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px
    }

    .kpi {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 16px;
      position: relative;
      transition: transform .3s
    }

    .kpi:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(2, 6, 23, .12)
    }

    .kpi h4 {
      margin: 0 0 10px 0;
      font-size: 13px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .4px;
      display: flex;
      align-items: center;
      gap: 6px
    }

    .kpi .v {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 4px
    }

    .kpi .meta {
      font-size: 11px;
      color: var(--muted)
    }

    .kpi.primary {
      border-top: 4px solid var(--pri)
    }

    .kpi.good {
      border-top: 4px solid var(--good)
    }

    .kpi.warn {
      border-top: 4px solid var(--warn)
    }

    .kpi.bad {
      border-top: 4px solid var(--bad)
    }

    .kpi.rocket {
      border-top: 4px solid var(--rocket)
    }

    .kpi.wow {
      border-top: 4px solid var(--wow)
    }

    .kpi.fresh {
      border-top: 4px solid var(--fresh)
    }

    .kpi.cyan {
      border-top: 4px solid var(--cyan)
    }

    .pill {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600
    }

    .pill.ok {
      background: #dcfce7;
      color: #065f46
    }

    .pill.ng {
      background: #fee2e2;
      color: #991b1b
    }

    .pill.running {
      background: #dbeafe;
      color: #1e40af
    }

    .sections {
      display: grid;
      grid-template-columns:repeat(auto-fit, minmax(380px, 1fr));
      gap: 18px;
      margin-top: 12px
    }

    .section {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 18px
    }

    .section h3 {
      margin: 0 0 12px 0;
      font-size: 17px;
      display: flex;
      align-items: center;
      gap: 8px
    }

    .alerts {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 280px;
      overflow: auto
    }

    .alert {
      padding: 12px 15px;
      border-radius: 12px;
      font-size: 13px;
      border: 1px solid;
      transition: all .3s
    }

    .alert:hover {
      transform: translateX(4px)
    }

    .alert.good {
      background: #ecfdf5;
      border-color: #a7f3d0;
      color: #065f46
    }

    .alert.warn {
      background: #fffbeb;
      border-color: #fde68a;
      color: #92400e
    }

    .alert.bad {
      background: #fef2f2;
      border-color: #fecaca;
      color: #991b1b
    }

    .table-wrap {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 0;
      margin-top: 18px;
      overflow: hidden
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px
    }

    thead {
      position: sticky;
      top: 0;
      background: #f9fafb;
      border-bottom: 2px solid var(--line)
    }

    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid var(--line);
      text-align: center;
      white-space: nowrap
    }

    th {
      font-weight: 700;
      color: var(--ink)
    }

    .delivery-mode.rocket {
      color: var(--rocket);
      font-weight: 600
    }

    .delivery-mode.dawn {
      color: var(--wow);
      font-weight: 600
    }

    .delivery-mode.fresh {
      color: var(--fresh);
      font-weight: 600
    }

    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
        align-items: flex-start
      }

      .ctrl input, .ctrl select {
        min-width: 280px
      }

      .sections {
        grid-template-columns:1fr
      }

      .kpi-grid {
        grid-template-columns:repeat(auto-fit, minmax(250px, 1fr))
      }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="reality-badge">í˜„ì‹¤ì„± 95%</div>
    <h1>ğŸš€ ì¿ íŒ¡ ë¬¼ë¥˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œ (Coupang Logistics Reality Simulator)</h1>
    <div class="sub">ğŸ¯ ë¡œì¼“ë°°ì†¡Â·ì‹ ì„ ì‹í’ˆÂ·WOWÂ·AIìë™í™” | FCÂ·í—ˆë¸Œ ë¶„ë¦¬ | ì…ê³ /ì ì¹˜/ìœ í†µê¸°í•œ/ë¡œì¼€ì´ì…˜ í¬í•¨</div>
  </div>

  <div class="panel">
    <div class="controls">
      <div class="ctrl"><label>ì‹œì‘ë…„ë„ / Start Year</label><select id="startYear"></select></div>
      <div class="ctrl"><label>ì¢…ë£Œë…„ë„ / End Year</label><select id="endYear"></select></div>
      <div class="ctrl"><label>ê³ ê° ìˆ˜ / #Users</label><input id="userCount" type="number" min="100" max="200000"
                                                           value="15000"></div>
      <div class="ctrl"><label>ì£¼ë¬¸ ìˆ˜ / #Orders</label><input id="orderCount" type="number" min="500" max="10000000"
                                                            step="1000" value="75000"></div>
      <div class="ctrl"><label>ì²­í¬ í¬ê¸° / Chunk Size</label><input id="chunkSize" type="number" min="500" max="15000"
                                                                step="500" value="3000"></div>
      <div class="ctrl"><label>ë¡œì¼“ë°°ì†¡ ë¹„ì¤‘ / Rocket Rate (%)</label><input id="rocketRate" type="number" min="35" max="90"
                                                                       value="55"></div>
      <div class="ctrl"><label>WOW ê°€ì…ë¥  / WOW Rate (%)</label><input id="wowRate" type="number" min="60" max="100"
                                                                    value="80"></div>
      <div class="ctrl"><label>ëª©í‘œ ìˆœì´ìµë¥ (%)</label><input id="targetNetMargin" type="number" step="0.1" value="3.2"
                                                        min="-20" max="30"></div>

      <button class="btn rocket" id="btnStart">â–¶ï¸ ë°ì´í„° ìƒì„± / Generate</button>
      <button class="btn secondary" id="btnTune">âš™ï¸ DIALS</button>
      <button class="btn danger" id="btnStop" disabled>â¹ï¸ ì¤‘ë‹¨ / Stop</button>
      <button class="btn wow" id="btnCsv" disabled>ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ / Download CSV</button>
      <div id="status" class="pill ok" style="margin-left:auto">READY</div>
    </div>
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">ì²˜ë¦¬ ì¤‘... / Processing...</div>
      <div class="progress-stats"><span id="progressStats">-</span><span id="progressETA">ì˜ˆìƒ ì™„ë£Œ: - / ETA: -</span></div>
    </div>
  </div>

  <div class="panel" id="tunePanel" style="display:none">
    <div class="controls" style="align-items:flex-start">
      <div class="ctrl"><label>ì ìì£¼ë¬¸ìœ¨ ìµœì†Œ</label><input id="dial_loss_lo" type="number" step="0.001" min="0" max="1"
                                                      value="0.07"></div>
      <div class="ctrl"><label>ì ìì£¼ë¬¸ìœ¨ ìµœëŒ€</label><input id="dial_loss_hi" type="number" step="0.001" min="0" max="1"
                                                      value="0.12"></div>
      <div class="ctrl"><label>ì˜¨ë„ìœ„ë°˜ìœ¨ ìµœì†Œ</label><input id="dial_temp_lo" type="number" step="0.001" min="0" max="1"
                                                      value="0.01"></div>
      <div class="ctrl"><label>ì˜¨ë„ìœ„ë°˜ìœ¨ ìµœëŒ€</label><input id="dial_temp_hi" type="number" step="0.001" min="0" max="1"
                                                      value="0.02"></div>
      <div class="ctrl"><label>ì œì£¼ ì•…ì²œí›„ ìµœì†Œ</label><input id="dial_jeju_lo" type="number" step="0.001" min="0" max="1"
                                                       value="0.10"></div>
      <div class="ctrl"><label>ì œì£¼ ì•…ì²œí›„ ìµœëŒ€</label><input id="dial_jeju_hi" type="number" step="0.001" min="0" max="1"
                                                       value="0.15"></div>
      <div class="ctrl"><label>ê³¼ì¬ê³  ìµœì†Œ</label><input id="dial_over_lo" type="number" step="0.001" min="0" max="1"
                                                    value="0.15"></div>
      <div class="ctrl"><label>ê³¼ì¬ê³  ìµœëŒ€</label><input id="dial_over_hi" type="number" step="0.001" min="0" max="1"
                                                    value="0.25"></div>
      <div class="ctrl"><label>ìœ í†µê¸°í•œ ì„ë°• ìµœì†Œ</label><input id="dial_exp_lo" type="number" step="0.001" min="0" max="1"
                                                        value="0.005"></div>
      <div class="ctrl"><label>ìœ í†µê¸°í•œ ì„ë°• ìµœëŒ€</label><input id="dial_exp_hi" type="number" step="0.001" min="0" max="1"
                                                        value="0.01"></div>
    </div>
    <div class="controls">
      <button class="btn wow" id="btnApplyDials">ì ìš©</button>
      <button class="btn secondary" id="btnResetDials">ì´ˆê¸°í™”</button>
      <div id="tuneStatus" class="pill ok">DIALS READY</div>
    </div>
  </div>

  <!-- KPI ì„¹ì…˜ (UI ë™ì¼) -->
  <div class="sections">
    <div class="section"><h3>ğŸš€ ë¡œì¼“ë°°ì†¡ ì„±ê³¼</h3>
      <div class="kpi-grid">
        <div class="kpi rocket"><h4>ë¡œì¼“ë°°ì†¡ ë¹„ì¤‘</h4>
          <div class="v" id="k_rocketShare">-</div>
          <div class="meta">% of orders</div>
        </div>
        <div class="kpi rocket"><h4>ë¡œì¼“ë‹¹ì¼ ì„±ê³µë¥ </h4>
          <div class="v" id="k_rocketSameDayRate">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi rocket"><h4>ë¡œì¼“ìƒˆë²½ ì •ì‹œìœ¨</h4>
          <div class="v" id="k_rocketDawnRate">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi rocket"><h4>30ë¶„ë‚´ ì¶œê³ ìœ¨</h4>
          <div class="v" id="k_fastShipRate">-</div>
          <div class="meta">%</div>
        </div>
      </div>
    </div>

    <div class="section"><h3>ğŸ“¦ ì¶œê³ Â·í’€í•„ë¨¼íŠ¸</h3>
      <div class="kpi-grid">
        <div class="kpi primary"><h4>ì •ì‹œ ì¶œê³ ìœ¨</h4>
          <div class="v" id="k_fcOnTimeShip">-</div>
          <div class="meta">ëª©í‘œ â‰¥ 96%</div>
        </div>
        <div class="kpi"><h4>í‰ê·  ì¶œê³  ì‹œê°„</h4>
          <div class="v" id="k_fcAvgShipHour">-</div>
          <div class="meta">ì‹œê°„</div>
        </div>
        <div class="kpi"><h4>í”¼í‚¹ ì†ë„</h4>
          <div class="v" id="k_fcPickSecPerItem">-</div>
          <div class="meta">ì´ˆ/ê°œ</div>
        </div>
        <div class="kpi"><h4>íŒ¨í‚¹ ì†ë„</h4>
          <div class="v" id="k_fcPackSecPerItem">-</div>
          <div class="meta">ì´ˆ/ê°œ</div>
        </div>
        <div class="kpi good"><h4>í’€í•„ë¨¼íŠ¸ íš¨ìœ¨</h4>
          <div class="v" id="k_fcEfficiency">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi wow"><h4>60ë¶„ë‚´ ì¶œê³ ìœ¨</h4>
          <div class="v" id="k_fcShipUnder60">-</div>
          <div class="meta">%</div>
        </div>
      </div>
    </div>

    <div class="section"><h3>ğŸŒŸ WOW ë©¤ë²„ì‹­ & í”„ë¦¬ë¯¸ì—„</h3>
      <div class="kpi-grid">
        <div class="kpi wow"><h4>WOW ê°€ì…ë¥ </h4>
          <div class="v" id="k_wowShare">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi wow"><h4>WOW Plus ë¹„ì¤‘</h4>
          <div class="v" id="k_wowPlusShare">0</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi wow"><h4>WOW vs ë¹„íšŒì› AOV ì°¨ì´</h4>
          <div class="v" id="k_wowAovGap">-</div>
          <div class="meta">â‚©</div>
        </div>
        <div class="kpi warn"><h4>WOW ì´íƒˆ ìœ„í—˜ ê³ ê°</h4>
          <div class="v" id="k_wowChurnRisk">-</div>
          <div class="meta">ëª…</div>
        </div>
      </div>
    </div>

    <div class="section"><h3>â„ï¸ ì‹ ì„ ì‹í’ˆ & ì½œë“œì²´ì¸</h3>
      <div class="kpi-grid">
        <div class="kpi fresh"><h4>ì‹ ì„ ì‹í’ˆ ë¹„ì¤‘</h4>
          <div class="v" id="k_freshShare">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi fresh"><h4>ì½œë“œì²´ì¸ ì¤€ìˆ˜ìœ¨</h4>
          <div class="v" id="k_coldChainRate">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi warn"><h4>ì˜¨ë„ ìœ„ë°˜ìœ¨</h4>
          <div class="v" id="k_tempViolation">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi fresh"><h4>ëƒ‰ë™ì‹í’ˆ í’ˆì§ˆ ì ìˆ˜</h4>
          <div class="v" id="k_frozenQuality">-</div>
          <div class="meta">/100</div>
        </div>
      </div>
    </div>

    <div class="section"><h3>ğŸ­ í—ˆë¸Œ&ìŠ¤í¬í¬ ë¬¼ë¥˜ë§</h3>
      <div class="kpi-grid">
        <div class="kpi primary"><h4>ë©”ê°€í—ˆë¸Œ ì²˜ë¦¬ ë¹„ì¤‘</h4>
          <div class="v" id="k_megaHubShare">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi primary"><h4>ìˆ˜ë„ê¶Œ ì»¤ë²„ë¦¬ì§€</h4>
          <div class="v" id="k_seoulCoverage">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi good"><h4>í‰ê·  ë°°ì†¡ ê±°ë¦¬</h4>
          <div class="v" id="k_avgDistance">-</div>
          <div class="meta">km</div>
        </div>
        <div class="kpi primary"><h4>ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨ì„±</h4>
          <div class="v" id="k_networkEff">-</div>
          <div class="meta">ì </div>
        </div>
      </div>
    </div>

    <div class="section"><h3>ğŸ¤– AI & ìë™í™” ìˆ˜ì¤€</h3>
      <div class="kpi-grid">
        <div class="kpi cyan"><h4>AI ìµœì í™” ë¹„ìœ¨</h4>
          <div class="v" id="k_aiOptimized">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi cyan"><h4>ìë™ í”¼í‚¹ìœ¨</h4>
          <div class="v" id="k_autoPickRate">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi good"><h4>í‰ê·  í”¼í‚¹ ì‹œê°„</h4>
          <div class="v" id="k_avgPickTime">-</div>
          <div class="meta">ì´ˆ</div>
        </div>
        <div class="kpi cyan"><h4>WMS ê³ ë„í™” ì ìˆ˜</h4>
          <div class="v" id="k_wmsAdvanced">-</div>
          <div class="meta">/100</div>
        </div>
      </div>
    </div>

    <div class="section"><h3>ğŸ’° ë§¤ì¶œÂ·ìˆ˜ìµ</h3>
      <div class="kpi-grid">
        <div class="kpi primary"><h4>ì´ ë§¤ì¶œ</h4>
          <div class="v" id="k_totalSales">-</div>
          <div class="meta">â‚©</div>
        </div>
        <div class="kpi good"><h4>ìˆœì´ìµë¥ </h4>
          <div class="v" id="k_netMargin">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>í‰ê· ì£¼ë¬¸ê¸ˆì•¡</h4>
          <div class="v" id="k_aov">-</div>
          <div class="meta">â‚©</div>
        </div>
        <div class="kpi"><h4>ARPPU</h4>
          <div class="v" id="k_arppu">-</div>
          <div class="meta">â‚©</div>
        </div>
      </div>
    </div>

    <div class="section"><h3>ğŸ‘¥ ê³ ê°</h3>
      <div class="kpi-grid">
        <div class="kpi"><h4>LTV:CAC</h4>
          <div class="v" id="k_ltvCac">-</div>
        </div>
        <div class="kpi"><h4>ìœ ì§€ìœ¨</h4>
          <div class="v" id="k_retention">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>ì´íƒˆë¥ </h4>
          <div class="v" id="k_churn">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>AI ì´íƒˆ ì˜ˆì¸¡ ì •í™•ë„</h4>
          <div class="v" id="k_ai">-</div>
          <div class="meta">%</div>
        </div>
      </div>
    </div>

    <div class="section"><h3>ğŸšš ë°°ì†¡Â·ë¬¼ë¥˜</h3>
      <div class="kpi-grid">
        <div class="kpi good"><h4>ì •ì‹œìœ¨</h4>
          <div class="v" id="k_onTime">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>SLA ìœ„ë°˜ìœ¨</h4>
          <div class="v" id="k_sla">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>ì ì¬ìœ¨</h4>
          <div class="v" id="k_load">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>ì—°ë¹„</h4>
          <div class="v" id="k_fuel">-</div>
          <div class="meta">km/â„“ Â· km/kWh</div>
        </div>
        <div class="kpi"><h4>ë¼ìš°íŒ… ì ìˆ˜</h4>
          <div class="v" id="k_route">-</div>
          <div class="meta">/100</div>
        </div>
        <div class="kpi warn"><h4>ë°°ì†¡ ì˜ˆì™¸ìœ¨</h4>
          <div class="v" id="k_exception">-</div>
          <div class="meta">%</div>
        </div>
      </div>
    </div>

    <div class="section"><h3>ğŸ“¦ ë°˜í’ˆ</h3>
      <div class="kpi-grid">
        <div class="kpi warn"><h4>ë°˜í’ˆë¥ </h4>
          <div class="v" id="k_returnRate">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>ë°˜í’ˆ ì†ì‹¤ë¥ </h4>
          <div class="v" id="k_returnCost">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>ì¬íŒë§¤ ê°€ëŠ¥ë¥ </h4>
          <div class="v" id="k_resell">-</div>
          <div class="meta">%</div>
        </div>
      </div>
    </div>

    <div class="section"><h3>ğŸ­ WMSÂ·ì¬ê³ </h3>
      <div class="kpi-grid">
        <div class="kpi"><h4>ì¬ê³  íšŒì „ìœ¨</h4>
          <div class="v" id="k_invTurn">-</div>
          <div class="meta">íšŒ</div>
        </div>
        <div class="kpi"><h4>í’ˆì ˆë¥ </h4>
          <div class="v" id="k_stockout">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>ê³¼ì¬ê³  ë¹„ìœ¨</h4>
          <div class="v" id="k_overstock">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>ì¬ê³  ì •í™•ë„</h4>
          <div class="v" id="k_invAcc">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>ì¬ê³  ì†ì‹¤ë¥ </h4>
          <div class="v" id="k_shrink">-</div>
          <div class="meta">%</div>
        </div>
        <div class="kpi"><h4>WMS í™œìš©ë¥ </h4>
          <div class="v" id="k_wms">-</div>
          <div class="meta">%</div>
        </div>
      </div>
    </div>
  </div>

  <div class="sections">
    <div class="section"><h3>âœ… ì¿ íŒ¡ íŠ¹í™” ì •í•©ì„± ê²€ì‚¬</h3>
      <div id="validateSummary" class="pill ok">-</div>
      <div class="alerts" id="validateList"></div>
    </div>
    <div class="section"><h3>âš ï¸ ì¿ íŒ¡ ë³µí•© ìœ„í—˜ ìš”ì†Œ</h3>
      <div class="alerts" id="riskList"></div>
    </div>
    <div class="section"><h3>ğŸ“Š ì²˜ë¦¬ ì„±ëŠ¥ & í˜„ì‹¤ì„± ì§€í‘œ</h3>
      <div class="alerts" id="perfList"></div>
    </div>
  </div>

  <div class="table-wrap">
    <table id="tbl">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
  // ==========================
  // 0) ë„¤íŠ¸ì›Œí¬ íƒ€ì„ë¼ì¸ í‚¤ (ë‹¨ì¼ ì§„ì‹¤ì›)
  // ==========================
  const NET_PREFIX = '__net_';
  const N = s => NET_PREFIX + s;
  const NET = Object.freeze({
    ROUTE_TYPE: N('Route_Type'),
    SORT_HUB_NAME: N('Sortation_Hub_Name'),
    FC_EXIT: N('FC_Exit_TS'),
    HUB_IN: N('Hub_In_TS'),
    HUB_OUT: N('Hub_Out_TS'),
    CAMP_IN: N('Camp_In_TS'),
    LOAD_START: N('Loadout_Start_TS'),
    LOAD_END: N('Loadout_End_TS'),
    OFD: N('OFD_TS'),
    FC_DWELL: N('FC_Dwell_Min'),
    HUB_DWELL: N('Hub_Dwell_Min'),
    CAMP_DWELL: N('Camp_Dwell_Min'),
  });

  // ==========================
  // 1) ìƒìˆ˜/ë§¤í•‘
  // ==========================
  const SHIP_SLA_MIN = {'ë¡œì¼“ë‹¹ì¼': 60, 'ë¡œì¼“ìƒˆë²½': 90, 'ë¡œì¼“ìµì¼': 90, 'ë¡œì¼“í”„ë ˆì‹œ': 60, 'ì¼ë°˜íƒë°°': 120, DEFAULT: 90};

  const DELIVERY_MODES = {
    'ë¡œì¼“ë‹¹ì¼': {delayRate: 0.005, baseDays: 0, cutoffHour: 20, regions: ['ìˆ˜ë„ê¶Œ'], wowOnly: false, cost: 1.2},
    'ë¡œì¼“ìƒˆë²½': {delayRate: 0.008, baseDays: 1, regions: ['ìˆ˜ë„ê¶Œ', 'ì˜ë‚¨', 'ì¶©ì²­'], wowOnly: false, cost: 1.1},
    'ë¡œì¼“ìµì¼': {delayRate: 0.012, baseDays: 1, regions: ['ì „êµ­'], wowOnly: false, cost: 1.0},
    'ë¡œì¼“í”„ë ˆì‹œ': {
      delayRate: 0.015,
      baseDays: 0,
      cutoffHour: 18,
      regions: ['ìˆ˜ë„ê¶Œ'],
      wowOnly: false,
      cost: 1.3,
      coldChain: true
    },
    'ì¼ë°˜íƒë°°': {delayRate: 0.035, baseDays: 2, regions: ['ì „êµ­'], wowOnly: false, cost: 0.8}
  };

  const REGIONS = ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ', 'ëŒ€ì „ê´‘ì—­ì‹œ', 'ìš¸ì‚°ê´‘ì—­ì‹œ', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', 'ê²½ê¸°ë„', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', 'ì¶©ì²­ë¶ë„', 'ì¶©ì²­ë‚¨ë„', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„', 'ì „ë¼ë‚¨ë„', 'ê²½ìƒë¶ë„', 'ê²½ìƒë‚¨ë„', 'ì œì£¼íŠ¹ë³„ìì¹˜ë„'];

  const CITIES_BY_REGION = {
    'ì„œìš¸íŠ¹ë³„ì‹œ': ['ì„œìš¸ì‹œ'],
    'ë¶€ì‚°ê´‘ì—­ì‹œ': ['ë¶€ì‚°ì‹œ'],
    'ëŒ€êµ¬ê´‘ì—­ì‹œ': ['ëŒ€êµ¬ì‹œ'],
    'ì¸ì²œê´‘ì—­ì‹œ': ['ì¸ì²œì‹œ'],
    'ê´‘ì£¼ê´‘ì—­ì‹œ': ['ê´‘ì£¼ì‹œ'],
    'ëŒ€ì „ê´‘ì—­ì‹œ': ['ëŒ€ì „ì‹œ'],
    'ìš¸ì‚°ê´‘ì—­ì‹œ': ['ìš¸ì‚°ì‹œ'],
    'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': ['ì„¸ì¢…ì‹œ'],
    'ê²½ê¸°ë„': ['ì„±ë‚¨ì‹œ', 'ìš©ì¸ì‹œ', 'ìˆ˜ì›ì‹œ', 'ê³ ì–‘ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ'],
    'ê°•ì›íŠ¹ë³„ìì¹˜ë„': ['ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ'],
    'ì¶©ì²­ë¶ë„': ['ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ'],
    'ì¶©ì²­ë‚¨ë„': ['ì²œì•ˆì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ'],
    'ì „ë¶íŠ¹ë³„ìì¹˜ë„': ['ì „ì£¼ì‹œ', 'ìµì‚°ì‹œ', 'êµ°ì‚°ì‹œ'],
    'ì „ë¼ë‚¨ë„': ['ìˆœì²œì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ëª©í¬ì‹œ'],
    'ê²½ìƒë¶ë„': ['í¬í•­ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ê²½ì‚°ì‹œ'],
    'ê²½ìƒë‚¨ë„': ['ì°½ì›ì‹œ', 'ê¹€í•´ì‹œ', 'ì§„ì£¼ì‹œ'],
    'ì œì£¼íŠ¹ë³„ìì¹˜ë„': ['ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ']
  };
  const DISTRICTS_BY_CITY = {
    'ì„œìš¸ì‹œ': ['ê°•ë‚¨êµ¬', 'ì„œì´ˆêµ¬', 'ì†¡íŒŒêµ¬', 'ë§ˆí¬êµ¬', 'ì„±ë™êµ¬', 'ê°•ì„œêµ¬'],
    'ë¶€ì‚°ì‹œ': ['í•´ìš´ëŒ€êµ¬', 'ìˆ˜ì˜êµ¬', 'ë‚¨êµ¬', 'ë¶€ì‚°ì§„êµ¬'],
    'ëŒ€êµ¬ì‹œ': ['ìˆ˜ì„±êµ¬', 'ë‹¬ì„œêµ¬', 'ì¤‘êµ¬', 'ë™êµ¬'],
    'ì¸ì²œì‹œ': ['ë‚¨ë™êµ¬', 'ì—°ìˆ˜êµ¬', 'ë¶€í‰êµ¬', 'ë¯¸ì¶”í™€êµ¬'],
    'ê´‘ì£¼ì‹œ': ['ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ê´‘ì‚°êµ¬'],
    'ëŒ€ì „ì‹œ': ['ì„œêµ¬', 'ìœ ì„±êµ¬', 'ëŒ€ë•êµ¬', 'ë™êµ¬'],
    'ìš¸ì‚°ì‹œ': ['ë‚¨êµ¬', 'ì¤‘êµ¬', 'ë¶êµ¬', 'ìš¸ì£¼êµ°'],
    'ì„¸ì¢…ì‹œ': ['ì„¸ì¢…ë™', 'ìƒˆë¡¬ë™', 'ë³´ëŒë™'],
    'ì„±ë‚¨ì‹œ': ['ë¶„ë‹¹êµ¬', 'ìˆ˜ì •êµ¬', 'ì¤‘ì›êµ¬'],
    'ìš©ì¸ì‹œ': ['ìˆ˜ì§€êµ¬', 'ê¸°í¥êµ¬', 'ì²˜ì¸êµ¬'],
    'ìˆ˜ì›ì‹œ': ['ì˜í†µêµ¬', 'ê¶Œì„ êµ¬', 'íŒ”ë‹¬êµ¬', 'ì¥ì•ˆêµ¬'],
    'ê³ ì–‘ì‹œ': ['ì¼ì‚°ì„œêµ¬', 'ì¼ì‚°ë™êµ¬', 'ë•ì–‘êµ¬'],
    'ë‚¨ì–‘ì£¼ì‹œ': ['í™”ë„ì', 'ì§„ì ‘ì', 'ë³„ë‚´ë™'],
    'ì¶˜ì²œì‹œ': ['í‡´ê³„ë™', 'ì„ì‚¬ë™', 'í›„í‰ë™'],
    'ì›ì£¼ì‹œ': ['ë¬´ì‹¤ë™', 'ë‹¨êµ¬ë™', 'íƒœì¥ë™'],
    'ê°•ë¦‰ì‹œ': ['êµë™', 'í¬ë‚¨ë™', 'ì…ì•”ë™'],
    'ì²­ì£¼ì‹œ': ['í¥ë•êµ¬', 'ì„œì›êµ¬', 'ì²­ì›êµ¬'],
    'ì¶©ì£¼ì‹œ': ['ì—°ìˆ˜ë™', 'êµí˜„ë™', 'í˜¸ì•”ë™'],
    'ì œì²œì‹œ': ['ì‹ ë°±ë™', 'ì²­ì „ë™'],
    'ì²œì•ˆì‹œ': ['ì„œë¶êµ¬', 'ë™ë‚¨êµ¬'],
    'ì•„ì‚°ì‹œ': ['ë°°ë°©ì', 'íƒ•ì •ë©´', 'ì˜¨ì–‘ë™'],
    'ì„œì‚°ì‹œ': ['ë™ë¬¸ë™', 'ì„ë‚¨ë™'],
    'ì „ì£¼ì‹œ': ['ì™„ì‚°êµ¬', 'ë•ì§„êµ¬'],
    'ìµì‚°ì‹œ': ['ì˜ë“±ë™', 'ë¶€ì†¡ë™'],
    'êµ°ì‚°ì‹œ': ['ë‚˜ìš´ë™', 'ìˆ˜ì†¡ë™'],
    'ìˆœì²œì‹œ': ['ì—°í–¥ë™', 'ì¡°ë¡€ë™'],
    'ì—¬ìˆ˜ì‹œ': ['ì›…ì²œë™', 'ë¬¸ìˆ˜ë™'],
    'ëª©í¬ì‹œ': ['í•˜ë‹¹ë™', 'ì‹ í¥ë™'],
    'í¬í•­ì‹œ': ['ë¶êµ¬', 'ë‚¨êµ¬'],
    'êµ¬ë¯¸ì‹œ': ['ì›í‰ë™', 'í˜•ê³¡ë™'],
    'ê²½ì‚°ì‹œ': ['ì¤‘ë°©ë™', 'ì„œìƒë™'],
    'ì°½ì›ì‹œ': ['ì„±ì‚°êµ¬', 'ì˜ì°½êµ¬', 'ë§ˆì‚°í•©í¬êµ¬'],
    'ê¹€í•´ì‹œ': ['ì‚¼ê³„ë™', 'êµ¬ì‚°ë™', 'ì¥ìœ ë™'],
    'ì§„ì£¼ì‹œ': ['ìƒëŒ€ë™', 'í‰ê±°ë™'],
    'ì œì£¼ì‹œ': ['ë…¸í˜•ë™', 'ì—°ë™', 'ì•„ë¼ë™'],
    'ì„œê·€í¬ì‹œ': ['ì„œê·€ë™', 'ëŒ€ì •ì', 'í‘œì„ ë©´']
  };

  const MEGA_HUBS = ['ê¹€í¬ë©”ê°€í—ˆë¸Œ', 'ê³¤ì§€ì•”ë©”ê°€í—ˆë¸Œ', 'ë•í‰í—ˆë¸Œ', 'í‰íƒí—ˆë¸Œ'];
  const HUB_COVERAGE = {
    'ê¹€í¬ë©”ê°€í—ˆë¸Œ': ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê²½ê¸°ë„'],
    'ê³¤ì§€ì•”ë©”ê°€í—ˆë¸Œ': ['ê²½ê¸°ë„', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', 'ì¶©ì²­ë¶ë„'],
    'ë•í‰í—ˆë¸Œ': ['ê²½ê¸°ë„', 'ì¶©ì²­ë‚¨ë„', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ'],
    'í‰íƒí—ˆë¸Œ': ['ê²½ê¸°ë„', 'ì¶©ì²­ë‚¨ë„', 'ì¶©ì²­ë¶ë„']
  };

  const FC_SITES = {
    'ì„œìš¸íŠ¹ë³„ì‹œ': 'ì„œìš¸ë™ë¶€FC', 'ì¸ì²œê´‘ì—­ì‹œ': 'ì¸ì²œFC', 'ê²½ê¸°ë„': 'ê²½ê¸°ë‚¨ë¶€FC', 'ë¶€ì‚°ê´‘ì—­ì‹œ': 'ë¶€ì‚°FC',
    'ëŒ€êµ¬ê´‘ì—­ì‹œ': 'ëŒ€êµ¬FC', 'ê´‘ì£¼ê´‘ì—­ì‹œ': 'ê´‘ì£¼FC', 'ëŒ€ì „ê´‘ì—­ì‹œ': 'ëŒ€ì „FC', 'ìš¸ì‚°ê´‘ì—­ì‹œ': 'ìš¸ì‚°FC',
    'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': 'ì„¸ì¢…FC', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„': 'ê°•ì›FC', 'ì¶©ì²­ë¶ë„': 'ì¶©ë¶FC', 'ì¶©ì²­ë‚¨ë„': 'ì¶©ë‚¨FC',
    'ì „ë¶íŠ¹ë³„ìì¹˜ë„': 'ì „ë¶FC', 'ì „ë¼ë‚¨ë„': 'ì „ë‚¨FC', 'ê²½ìƒë¶ë„': 'ê²½ë¶FC', 'ê²½ìƒë‚¨ë„': 'ê²½ë‚¨FC', 'ì œì£¼íŠ¹ë³„ìì¹˜ë„': 'ì œì£¼FC'
  };

  const REGION_LOGISTICS = {
    'ì„œìš¸íŠ¹ë³„ì‹œ': {baseCost: 2800, perKmCost: 90, avgDistance: 16, populationWeight: 0.18},
    'ë¶€ì‚°ê´‘ì—­ì‹œ': {baseCost: 3200, perKmCost: 95, avgDistance: 22, populationWeight: 0.06},
    'ëŒ€êµ¬ê´‘ì—­ì‹œ': {baseCost: 3100, perKmCost: 95, avgDistance: 20, populationWeight: 0.05},
    'ì¸ì²œê´‘ì—­ì‹œ': {baseCost: 2900, perKmCost: 90, avgDistance: 18, populationWeight: 0.06},
    'ê´‘ì£¼ê´‘ì—­ì‹œ': {baseCost: 3100, perKmCost: 100, avgDistance: 24, populationWeight: 0.03},
    'ëŒ€ì „ê´‘ì—­ì‹œ': {baseCost: 3000, perKmCost: 95, avgDistance: 21, populationWeight: 0.03},
    'ìš¸ì‚°ê´‘ì—­ì‹œ': {baseCost: 3200, perKmCost: 100, avgDistance: 23, populationWeight: 0.02},
    'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': {baseCost: 3000, perKmCost: 95, avgDistance: 20, populationWeight: 0.01},
    'ê²½ê¸°ë„': {baseCost: 3000, perKmCost: 95, avgDistance: 26, populationWeight: 0.24},
    'ê°•ì›íŠ¹ë³„ìì¹˜ë„': {baseCost: 3400, perKmCost: 110, avgDistance: 40, populationWeight: 0.04},
    'ì¶©ì²­ë¶ë„': {baseCost: 3100, perKmCost: 100, avgDistance: 28, populationWeight: 0.04},
    'ì¶©ì²­ë‚¨ë„': {baseCost: 3100, perKmCost: 100, avgDistance: 27, populationWeight: 0.05},
    'ì „ë¶íŠ¹ë³„ìì¹˜ë„': {baseCost: 3200, perKmCost: 105, avgDistance: 29, populationWeight: 0.04},
    'ì „ë¼ë‚¨ë„': {baseCost: 3300, perKmCost: 110, avgDistance: 36, populationWeight: 0.04},
    'ê²½ìƒë¶ë„': {baseCost: 3300, perKmCost: 108, avgDistance: 34, populationWeight: 0.06},
    'ê²½ìƒë‚¨ë„': {baseCost: 3250, perKmCost: 105, avgDistance: 31, populationWeight: 0.06},
    'ì œì£¼íŠ¹ë³„ìì¹˜ë„': {baseCost: 4200, perKmCost: 130, avgDistance: 38, populationWeight: 0.02}
  };

  const WEATHER_CONDITIONS = ['ë§‘ìŒ', 'íë¦¼', 'ë¹„', 'ëˆˆ', 'ì•ˆê°œ', 'ê°•í’'];

  function weatherSeverity(c) {
    const m = {'ë§‘ìŒ': 0.02, 'íë¦¼': 0.15, 'ë¹„': 0.45, 'ëˆˆ': 0.75, 'ì•ˆê°œ': 0.35, 'ê°•í’': 0.55};
    return m[c] || 0.2
  }

  const COUPANG_CATEGORIES = {
    'ì‹ ì„ ì‹í’ˆ': {
      margin: 0.18, price: [2000, 18000], coldChain: true, freshFood: true, tempRange: [0, 4], returnRate: 0.035,
      skus: ['FRESH-APPLE-1KG', 'FRESH-PEAR-1KG', 'FRESH-LETTUCE', 'FRESH-MEAT-500G', 'FRESH-EGG-30', 'FRESH-MILK-1L']
    },
    'ëƒ‰ë™ì‹í’ˆ': {
      margin: 0.22, price: [3000, 22000], coldChain: true, freshFood: false, tempRange: [-18, -12], returnRate: 0.028,
      skus: ['FROZ-DUMPLING-1KG', 'FROZ-PIZZA', 'FROZ-ICECREAM', 'FROZ-SHRIMP-500G', 'FROZ-CHICKEN-1KG']
    },
    'ê°€ì „ì „ì': {
      margin: 0.14, price: [15000, 700000], coldChain: false, freshFood: false, tempRange: null, returnRate: 0.022,
      skus: ['ELEC-MOUSE', 'ELEC-KEYBOARD', 'ELEC-HEADSET', 'ELEC-MONITOR-27', 'ELEC-ROBOTVAC', 'ELEC-AIRFRYER']
    },
    'íŒ¨ì…˜ì˜ë¥˜': {
      margin: 0.38, price: [9000, 180000], coldChain: false, freshFood: false, tempRange: null, returnRate: 0.11,
      skus: ['FASH-TSHIRT', 'FASH-JEANS', 'FASH-JACKET', 'FASH-DRESS', 'FASH-SNEAKERS', 'FASH-HAT']
    },
    'ìƒí™œìš©í’ˆ': {
      margin: 0.28, price: [2000, 55000], coldChain: false, freshFood: false, tempRange: null, returnRate: 0.03,
      skus: ['LIFE-TISSUE', 'LIFE-TOILETPAPER', 'LIFE-DETERGENT', 'LIFE-FABRICSOFT', 'LIFE-SHOWERGEL', 'LIFE-DISHSOAP']
    },
    'ì£¼ë°©ìš©í’ˆ': {
      margin: 0.30, price: [4000, 120000], coldChain: false, freshFood: false, tempRange: null, returnRate: 0.025,
      skus: ['KITCHEN-PAN28', 'KITCHEN-POT20', 'KITCHEN-KNIFE', 'KITCHEN-CUPSET', 'KITCHEN-FOODBOX']
    },
    'ë·°í‹°': {
      margin: 0.35, price: [3000, 250000], coldChain: false, freshFood: false, tempRange: null, returnRate: 0.06,
      skus: ['BEAUTY-TONER', 'BEAUTY-LOTION', 'BEAUTY-SERUM', 'BEAUTY-SUNSCREEN', 'BEAUTY-LIP', 'BEAUTY-MASKPACK']
    },
    'ìœ ì•„ë™': {
      margin: 0.26, price: [4000, 350000], coldChain: false, freshFood: false, tempRange: null, returnRate: 0.05,
      skus: ['KIDS-DIAPER', 'KIDS-WIPES', 'KIDS-TOYBLOCK', 'KIDS-STROLLER', 'KIDS-BOTTLE']
    },
    'ë°˜ë ¤ë™ë¬¼': {
      margin: 0.25, price: [3000, 220000], coldChain: false, freshFood: false, tempRange: null, returnRate: 0.04,
      skus: ['PET-DRYFOOD', 'PET-WETFOOD', 'PET-LITTER', 'PET-LEASH', 'PET-SHAMPOO']
    },
    'ìŠ¤í¬ì¸ Â·ë ˆì €': {
      margin: 0.24, price: [5000, 400000], coldChain: false, freshFood: false, tempRange: null, returnRate: 0.035,
      skus: ['SPRT-YOGA-MAT', 'SPRT-DUMBBELL', 'SPRT-BICYCLE', 'SPRT-TENT', 'SPRT-COOLER', 'SPRT-BALL']
    }
  };

  const ABC_DISTRIBUTION = {A: 0.15, B: 0.35, C: 0.5};

  const VEHICLES = [
    {type: 'ì˜¤í† ë°”ì´', capacity: 15, fuelEff: [28, 45], regions: ['ë„ì‹¬']},
    {type: 'ì†Œí˜•ë°´', capacity: 50, fuelEff: [11, 16], regions: ['ì „ì²´']},
    {type: 'ì¤‘í˜•íŠ¸ëŸ­', capacity: 200, fuelEff: [7, 11], regions: ['ì „ì²´']},
    {type: 'ëŒ€í˜•íŠ¸ëŸ­', capacity: 500, fuelEff: [5, 8], regions: ['ê°„ì„ ']},
    {type: 'ì „ê¸°ì°¨', capacity: 40, fuelEff: [4.5, 6.8], regions: ['ë„ì‹¬']}
  ];
  const DRIVER_GRADES = ['ì‹ ì…', 'ì¼ë°˜', 'ìˆ™ë ¨', 'ë² í…Œë‘', 'MVP'];
  const RETURN_REASONS = ['ë‹¨ìˆœë³€ì‹¬', 'ìƒí’ˆë¶ˆëŸ‰', 'ë°°ì†¡ì§€ì—°', 'ì˜¤ë°°ì†¡', 'íŒŒì†', 'ì„¤ëª…ë¶ˆì¼ì¹˜', 'ì‚¬ì´ì¦ˆë¶ˆì¼ì¹˜', 'ê¸°íƒ€'];
  const WOW_TIERS = {
    'WOW_BASIC': {
      freeShippingThreshold: 0,
      deliveryDiscount: 0.0,
      ltvMultiplier: 2.0,
      priorityShipping: true,
      returnBenefit: 1.2
    }
  };
  const AUTOMATION_LEVELS = {
    'MANUAL': {pickingTime: 45, packingTime: 25, errorRate: 0.008, regions: ['ì œì£¼íŠ¹ë³„ìì¹˜ë„', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„']},
    'SEMI_AUTO': {pickingTime: 28, packingTime: 18, errorRate: 0.005, regions: ['ì „ë¼ë‚¨ë„', 'ê²½ìƒë¶ë„', 'ì¶©ì²­ë¶ë„']},
    'AUTO': {pickingTime: 15, packingTime: 12, errorRate: 0.003, regions: ['ë¶€ì‚°ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ']},
    'AI_OPTIMIZED': {pickingTime: 8, packingTime: 6, errorRate: 0.001, regions: ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ê²½ê¸°ë„', 'ì¸ì²œê´‘ì—­ì‹œ']}
  };

  // ===== DIALS / CAL =====
  let DIALS = {
    lossOrderTarget: [0.07, 0.12],
    tempViolationTarget: [0.01, 0.02],
    jejuWeatherExposureTarget: [0.10, 0.15],
    overstockTarget: [0.15, 0.25],
    expiryImminentTarget: [0.005, 0.01]
  };
  let CAL = {
    costBias: 1.0,
    tempViolationBase: 0.015,
    jejuWeatherScale: 1.0,
    overstockProb: 0.22,
    expiryImminentRate: 0.008
  };
  let ENABLE_AUTOTUNE = false;

  // ==========================
  // 2) ìœ í‹¸ë¦¬í‹° & ì „ì—­ ìƒíƒœ
  // ==========================
  const rnd = (a, b) => Math.random() * (b - a) + a;
  const irnd = (a, b) => Math.floor(rnd(a, b + 1));
  const pick = arr => arr[irnd(0, arr.length - 1)];
  const weightedPick = w => {
    const t = Object.values(w).reduce((s, x) => s + x, 0);
    let r = Math.random() * t, c = 0;
    for (const [k, v] of Object.entries(w)) {
      c += v;
      if (r <= c) return k
    }
    return Object.keys(w)[0]
  };
  const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
  const pad = (n, l = 2) => String(n).padStart(l, '0');
  const sleep = ms => new Promise(r => setTimeout(r, ms));
  const qs = id => document.getElementById(id);
  const setText = (id, txt) => {
    const el = qs(id);
    if (el) el.textContent = txt
  };
  const setDisabled = (id, flag) => {
    const el = qs(id);
    if (el) el.disabled = !!flag
  };
  const setDisplay = (id, show) => {
    const el = qs(id);
    if (el) el.style.display = show ? '' : 'none'
  };
  const fmtPct = v => (isFinite(v) ? (Number(v).toFixed(1) + '%') : '-');

  const CSV_SPECIAL_LABELS = {
    Order_ID: 'Order ID',
    Order_Date: 'Order Date',
    Order_Timestamp: 'Order Timestamp',
    Order_Hour: 'Order Hour',
    Delivery_Mode: 'Delivery Mode',
    Planned_Delivery_Date: 'Planned Delivery Date',
    Actual_Delivery_Date: 'Actual Delivery Date',
    Delivery_Timestamp: 'Delivery Timestamp',
    Is_Delayed: 'Is Delayed',
    Delay_Hours: 'Delay Hours',
    SLA_Breach: 'SLA Breach',
    Delivery_Status: 'Delivery Status',
    Fast_Ship_30min: 'Fast Ship 30min',
    Order_To_Ship_Minutes: 'Order To Ship Minutes',
    Region: 'Region',
    City: 'City',
    District: 'District',
    Address: 'Address',
    Fulfillment_Center: 'Fulfillment Center',
    Delivery_Center: 'Delivery Center',
    Is_Mega_Hub: 'Is Mega Hub',
    Distance_km: 'Distance km',
    Customer_ID: 'Customer ID',
    Is_WOW_Member: 'Is WOW Member',
    WOW_Tier: 'WOW Tier',
    WOW_Join_Date: 'WOW Join Date',
    WOW_Tenure_Days: 'WOW Tenure Days',
    Customer_Segment: 'Customer Segment',
    Product_Category: 'Product Category',
    SKU: 'SKU',
    ABC_Category: 'ABC Category',
    Unit_Price: 'Unit Price',
    Quantity: 'Quantity',
    Order_Amount: 'Order Amount',
    Is_Fresh_Food: 'Is Fresh Food',
    Is_Cold_Chain_Required: 'Is Cold Chain Required',
    Target_Temperature: 'Target Temperature',
    Actual_Temperature: 'Actual Temperature',
    Temperature_Violation: 'Temperature Violation',
    Cold_Chain_Quality_Score: 'Cold Chain Quality Score',
    Vehicle_ID: 'Vehicle ID',
    Vehicle_Type: 'Vehicle Type',
    Vehicle_Capacity: 'Vehicle Capacity',
    Driver_ID: 'Driver ID',
    Driver_Grade: 'Driver Grade',
    Load_Factor: 'Load Factor',
    Fuel_Efficiency: 'Fuel Efficiency',
    Routing_Score: 'Routing Score',
    GPS_Tracking: 'GPS Tracking',
    Actual_Logistics_Cost: 'Actual Logistics Cost',
    Customer_Delivery_Charge: 'Customer Delivery Charge',
    Gross_Profit: 'Gross Profit',
    Net_Profit: 'Net Profit',
    CAC: 'CAC',
    Customer_LTV: 'Customer LTV',
    LTV_to_CAC: 'LTV to CAC',
    Return_Flag: 'Is Returned',
    Return_Reason: 'Return Reason',
    Return_Cost: 'Return Cost',
    Is_Resellable: 'Is Resellable',
    Resellability_Reason: 'Resellability Reason',
    Current_Stock: 'Current Stock',
    Reorder_Point: 'Reorder Point',
    Stockout_Flag: 'Stockout Flag',
    Overstock_Flag: 'Overstock Flag',
    Inventory_Turnover: 'Inventory Turnover',
    Inventory_Accuracy: 'Inventory Accuracy',
    Automation_Level: 'Automation Level',
    Picking_Time_Seconds: 'Picking Time Seconds',
    Packing_Time_Seconds: 'Packing Time Seconds',
    Total_Process_Time: 'Total Process Time',
    WMS_Usage: 'WMS Usage',
    OMS_Usage: 'OMS Usage',
    WMS_Advanced_Score: 'WMS Advanced Score',
    Service_Quality_Score: 'Service Quality Score',
    Customer_NPS: 'Customer NPS',
    Processing_Error_Rate: 'Processing Error Rate',
    Weather_Condition: 'Weather Condition',
    Weather_Severity_Score: 'Weather Severity Score',
    Churn_Flag: 'Churn Flag',
    Predicted_Churn_Score: 'Predicted Churn Score',
    Is_Rocket_Delivery: 'Is Rocket Delivery',
    Is_Same_Day_Delivery: 'Is Same Day Delivery',
    Is_Dawn_Delivery: 'Is Dawn Delivery',
    Is_Fresh_Delivery: 'Is Fresh Delivery',
    Is_Premium_Order: 'Is Premium Order',
    Is_Bulk_Order: 'Is Bulk Order',
    Is_Weekend_Order: 'Is Weekend Order',
    Is_Peak_Hour_Order: 'Is Peak Hour Order',
    Is_Free_Shipping: 'Is Free Shipping',
    Is_Weather_Risk: 'Is Weather Risk',
    Is_Long_Distance: 'Is Long Distance',
    Is_High_LTV: 'Is High LTV',
    Is_Churn_Risk: 'Is Churn Risk',
    Is_VIP_Customer: 'Is VIP Customer',
    Is_Loss_Order: 'Is Loss Order',
    Is_AI_Optimized: 'Is AI Optimized',
    Receiving_Date: 'Receiving Date',
    Putaway_Date: 'Putaway Date',
    Lot_ID: 'Lot ID',
    Expiry_Date: 'Expiry Date',
    Bin: 'Bin',
    Slot: 'Slot',
    Unit_Cost: 'Unit Cost',
    Daily_OnHand_Snapshot: 'Daily OnHand Snapshot',
    Safety_Stock: 'Safety Stock',
    Forecast_Demand: 'Forecast Demand',
    ASN_ID: 'Asn Id',
    PO_ID: 'Po Id',
    Replenishment_Type: 'Replenishment Type',
    Picking_Start_TS: 'Picking Start TS',
    Picking_End_TS: 'Picking End TS',
    Packing_Start_TS: 'Packing Start TS',
    Packing_End_TS: 'Packing End TS',
    Ship_SLA_Due_TS: 'Planned Ship Timestamp',
    FC_SLA_Breach: 'FC SLA Breach',
    CLV_Quartile: 'CLV Quartile',
    CLV_Quartile_Label: 'CLV Quartile Label',
    Planned_Ship_Timestamp: 'Planned Ship Timestamp',
    Actual_Ship_Timestamp: 'Actual Ship Timestamp',
    On_Time_Dispatch_Flag: 'On-time Dispatch Flag',
    Is_Quality_Issue: 'Is Quality Issue',
    Mis_Ship_Flag: 'Mis ship Flag',
    Distance_Bucket: 'Distance Bucket',
    Distance_Band_Label: 'Distance Band Label',
    [NET.ROUTE_TYPE]: 'Route Type',
    [NET.SORT_HUB_NAME]: 'Sortation Hub Name',
    [NET.FC_EXIT]: 'FC Exit TS',
    [NET.HUB_IN]: 'Hub In TS',
    [NET.HUB_OUT]: 'Hub Out TS',
    [NET.CAMP_IN]: 'Camp In TS',
    [NET.LOAD_START]: 'Loadout Start TS',
    [NET.LOAD_END]: 'Loadout End TS',
    [NET.OFD]: 'OFD TS',
    [NET.FC_DWELL]: 'FC Dwell Min',
    [NET.HUB_DWELL]: 'Hub Dwell Min',
    [NET.CAMP_DWELL]: 'Camp Dwell Min'
  };

  function prettyHeader(key) {
    if (CSV_SPECIAL_LABELS[key]) return CSV_SPECIAL_LABELS[key];
    return key
      .replace(/^_+/, '').replace(/__/g, '_').replace(/[_]/g, ' ')
      .replace(/([a-z0-9])([A-Z])/g, '$1 $2')
      .replace(/\s+/g, ' ').trim()
      .replace(/\b\w/g, m => m.toUpperCase());
  }

  const HOURLY_ORDER_PATTERN = {
    0: .008,
    1: .005,
    2: .003,
    3: .002,
    4: .002,
    5: .003,
    6: .008,
    7: .015,
    8: .025,
    9: .035,
    10: .045,
    11: .052,
    12: .058,
    13: .048,
    14: .042,
    15: .055,
    16: .065,
    17: .075,
    18: .085,
    19: .125,
    20: .135,
    21: .095,
    22: .068,
    23: .035
  };

  function getOrderHour() {
    const e = Object.entries(HOURLY_ORDER_PATTERN).map(([h, p]) => [parseInt(h), p]);
    const total = e.reduce((s, [, p]) => s + p, 0);
    const r = Math.random();
    let cum = 0;
    for (const [h, p] of e) {
      cum += p / total;
      if (r <= cum) return h
    }
    return 23
  }

  function macroRegionBySiDo(region) {
    if (['ì„œìš¸íŠ¹ë³„ì‹œ', 'ê²½ê¸°ë„', 'ì¸ì²œê´‘ì—­ì‹œ'].includes(region)) return 'ìˆ˜ë„ê¶Œ';
    if (['ë¶€ì‚°ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ìš¸ì‚°ê´‘ì—­ì‹œ', 'ê²½ìƒë¶ë„', 'ê²½ìƒë‚¨ë„'].includes(region)) return 'ì˜ë‚¨';
    if (['ëŒ€ì „ê´‘ì—­ì‹œ', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', 'ì¶©ì²­ë¶ë„', 'ì¶©ì²­ë‚¨ë„'].includes(region)) return 'ì¶©ì²­';
    if (['ê´‘ì£¼ê´‘ì—­ì‹œ', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„', 'ì „ë¼ë‚¨ë„'].includes(region)) return 'í˜¸ë‚¨';
    if (['ê°•ì›íŠ¹ë³„ìì¹˜ë„'].includes(region)) return 'ê°•ì›';
    if (['ì œì£¼íŠ¹ë³„ìì¹˜ë„'].includes(region)) return 'ì œì£¼';
    return 'ê¸°íƒ€'
  }

  function pickWeather(region, month) {
    let w = {'ë§‘ìŒ': 0.40, 'íë¦¼': 0.22, 'ë¹„': 0.18, 'ëˆˆ': 0.06, 'ì•ˆê°œ': 0.06, 'ê°•í’': 0.08};
    if ([6, 7, 8].includes(month)) {
      w['ë¹„'] += 0.10;
      w['ê°•í’'] += 0.03;
      w['ë§‘ìŒ'] -= 0.08
    }
    if ([12, 1, 2].includes(month)) {
      w['ëˆˆ'] += 0.07;
      w['ë§‘ìŒ'] -= 0.04
    }
    if (region === 'ì œì£¼íŠ¹ë³„ìì¹˜ë„') {
      w['ê°•í’'] = Math.max(0.01, (w['ê°•í’'] + 0.02) * CAL.jejuWeatherScale);
      w['ëˆˆ'] = Math.max(0, w['ëˆˆ'] - 0.05)
    }
    const macro = macroRegionBySiDo(region);
    if (['ì˜ë‚¨', 'í˜¸ë‚¨'].includes(macro)) w['ê°•í’'] += 0.02;
    const s = Object.values(w).reduce((a, b) => a + b, 0);
    let r = Math.random() * s, acc = 0;
    for (const k of Object.keys(w)) {
      acc += w[k];
      if (r <= acc) return k
    }
    return 'ë§‘ìŒ'
  }

  function selectFulfillmentCenter(region) {
    return FC_SITES[region] || 'ì§€ì—­FC'
  }

  function genBinSlot() {
    const a = pad(irnd(1, 40)), b = pad(irnd(1, 30)), l = pad(irnd(1, 5)), s = pad(irnd(1, 20));
    return {Bin: `A${a}-B${b}-L${l}`, Slot: `S${s}`}
  }

  function genLotAndExpiry(category, orderDate, receivingDate) {
    const cold = COUPANG_CATEGORIES[category]?.coldChain;
    if (!cold) return {Lot_ID: null, Expiry_Date: null};
    const lot = `LOT${irnd(100000, 999999)}`;
    let daysAhead = 90;
    if (category === 'ì‹ ì„ ì‹í’ˆ') daysAhead = irnd(3, 10); else if (category === 'ëƒ‰ë™ì‹í’ˆ') daysAhead = irnd(180, 365);
    let expiry = new Date(receivingDate.getTime() + daysAhead * 86400000);
    if (expiry <= orderDate) {
      expiry = new Date(orderDate.getTime() + irnd(2, 5) * 86400000)
    }
    if (Math.random() < CAL.expiryImminentRate) {
      expiry = new Date(orderDate.getTime() + irnd(0, 1) * 86400000)
    }
    return {Lot_ID: lot, Expiry_Date: expiry.toISOString().split('T')[0]}
  }

  function estimateUnitCost(category, unitPrice) {
    const m = COUPANG_CATEGORIES[category]?.margin || 0.3;
    return Math.round(unitPrice * (1 - m) * rnd(0.97, 1.03))
  }

  function forecastByABC(abc) {
    if (abc === 'A') return irnd(20, 60);
    if (abc === 'B') return irnd(8, 25);
    return irnd(2, 8)
  }

  function safetyStockCalc(forecastPerDay, leadDays) {
    const z = 1.28;
    const sigma = forecastPerDay * 0.3;
    return Math.max(0, Math.round(z * sigma * Math.sqrt(Math.max(1, leadDays))))
  }

  let DATA = [];
  let MONTHLY_BY_CUST = {};
  let VALIDATION_ISSUES = [];
  let PERFORMANCE_METRICS = {};
  let COUPANG_REALITY_METRICS = {};
  let PROCESSING_STATE = {
    isRunning: false,
    shouldStop: false,
    startTime: null,
    processedRows: 0,
    totalRows: 0,
    currentChunk: 0,
    totalChunks: 0
  };
  const CHUNK_CONFIG = {defaultSize: 3000, maxMemoryRows: 150000, batchUpdateInterval: 3, gcInterval: 8};
  let ROCKET_PLAN = [];

  function buildRocketPlan(total, ratePct) {
    const k = Math.round(total * (ratePct / 100));
    const arr = Array(total).fill(false).map((_, i) => i < k);
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]]
    }
    return arr
  }

  // ==========================
  // 3) ë°ì´í„° ìƒì„±
  // ==========================
  function preAssignCustomerProfiles(uniqueCustomers, wowRate) {
    const profiles = {};
    const wowPlan = buildRocketPlan(uniqueCustomers, wowRate);
    for (let i = 0; i < uniqueCustomers; i++) {
      const custId = `CUST${String(100000 + i).padStart(7, '0')}`;
      const isWow = wowPlan[i] ? 1 : 0;
      profiles[custId] = {
        isWow,
        wowTier: isWow ? 'WOW_BASIC' : null,
        churnFlag: Math.random() < 0.08 ? 1 : 0,
        joinDate: isWow ? new Date(Date.now() - irnd(30, 1095) * 86400000) : null,
        preferredRegion: selectRegionWeighted()
      };
    }
    return profiles
  }

  function selectRegionWeighted() {
    const w = {};
    Object.entries(REGION_LOGISTICS).forEach(([r, d]) => w[r] = d.populationWeight);
    return weightedPick(w)
  }

  function getAutomationLevel(region) {
    for (const [level, cfg] of Object.entries(AUTOMATION_LEVELS)) {
      if (cfg.regions.includes(region)) return level
    }
    if (region.includes('ì„œìš¸') || region.includes('ê²½ê¸°') || region.includes('ì¸ì²œ')) return Math.random() < 0.6 ? 'AI_OPTIMIZED' : 'AUTO';
    return 'SEMI_AUTO'
  }

  function estimateLogisticsCost(row) {
    const reg = REGION_LOGISTICS[row.Region] || {baseCost: 3000, perKmCost: 100};
    const baseCost = reg.baseCost;
    const distanceCost = (row.Distance_km || 0) * reg.perKmCost;
    const modeCfg = DELIVERY_MODES[row.Delivery_Mode] || {cost: 1.0};
    const weather = typeof row.Weather_Severity_Score === 'number' ? row.Weather_Severity_Score : 0.2;
    const weatherMultiplier = weather > 0.6 ? 1.25 : (weather > 0.3 ? 1.1 : 1.0);
    const peakMultiplier = row.Is_Peak_Hour_Order === 1 ? 1.15 : 1.0;
    const islandMultiplier = row.Region === 'ì œì£¼íŠ¹ë³„ìì¹˜ë„' ? (weather > 0.6 ? 1.8 : 1.5) : 1.0;
    const handlingBase = 500;
    return Math.round((baseCost + distanceCost + handlingBase) * modeCfg.cost * weatherMultiplier * peakMultiplier * islandMultiplier)
  }

  function generateAddress(region, city, district) {
    const roads = ['ë¬¼ë¥˜ë¡œ', 'ë°°ì†¡ëŒ€ë¡œ', 'ì¿ íŒ¡ê¸¸', 'ë¡œì¼“ë¡œ', 'í—ˆë¸ŒëŒ€ë¡œ', 'ì„¼í„°ë¡œ'];
    const no = irnd(1, 999), b = irnd(1, 150);
    return `${city} ${district} ${pick(roads)} ${no}-${b}`
  }

  function calculateDistance(region, city) {
    const base = REGION_LOGISTICS[region]?.avgDistance || 25;
    const v = rnd(-0.3, 0.3);
    return Math.max(3, Math.round(base * (1 + v)))
  }

  function generateTemperatureData(category, coldChain) {
    if (!coldChain) return {temp: null, violation: false, quality: null};
    const cfg = COUPANG_CATEGORIES[category];
    const target = cfg.tempRange;
    const targetTemp = rnd(target[0], target[1]);
    let actualTemp = targetTemp + rnd(-2, 2);
    let violation = Math.random() < CAL.tempViolationBase;
    if (violation) {
      if (Math.random() < 0.5) actualTemp = target[1] + rnd(4, 8); else actualTemp = target[0] - rnd(4, 8)
    }
    const quality = violation ? rnd(60, 85) : rnd(85, 98);
    return {
      targetTemp: Math.round(targetTemp * 10) / 10,
      actualTemp: Math.round(actualTemp * 10) / 10,
      violation,
      quality: Math.round(quality)
    }
  }

  function generateCoupangRealisticRow(index, totalUsers, yearStart, yearEnd, customerProfiles, forceRocket) {
    const custIndex = index % totalUsers;
    const custId = `CUST${String(100000 + custIndex).padStart(7, '0')}`;
    const customerProfile = customerProfiles[custId];
    const region = Math.random() < 0.7 ? customerProfile.preferredRegion : selectRegionWeighted();
    const city = pick(CITIES_BY_REGION[region] || ['ê¸°íƒ€ì‹œ']);
    const district = pick(DISTRICTS_BY_CITY[city] || ['ê¸°íƒ€êµ¬']);
    const address = generateAddress(region, city, district);
    const distanceKm = calculateDistance(region, city);
    const categoryKeys = Object.keys(COUPANG_CATEGORIES);
    const month = irnd(1, 12);
    let categoryWeights = {};
    categoryKeys.forEach(cat => {
      let w = 1;
      if (cat === 'ì‹ ì„ ì‹í’ˆ' && [6, 7, 8].includes(month)) w = 1.8;
      if (cat === 'ëƒ‰ë™ì‹í’ˆ' && [12, 1, 2].includes(month)) w = 1.5;
      if (cat === 'íŒ¨ì…˜ì˜ë¥˜' && [3, 4, 9, 10].includes(month)) w = 1.4;
      categoryWeights[cat] = w;
    });
    const selectedCategory = weightedPick(categoryWeights);
    const categoryData = COUPANG_CATEGORIES[selectedCategory] || COUPANG_CATEGORIES['ìƒí™œìš©í’ˆ'];
    const skuList = (Array.isArray(categoryData.skus) && categoryData.skus.length) ? categoryData.skus : ['GEN-ITEM-001', 'GEN-ITEM-002'];
    const sku = pick(skuList);
    const unitPrice = irnd(categoryData.price[0], categoryData.price[1]);
    const quantity = Math.random() < 0.7 ? 1 : irnd(2, 5);
    const orderAmount = unitPrice * quantity;
    const abcRand = Math.random();
    const abcGrade = abcRand < ABC_DISTRIBUTION.A ? 'A' : (abcRand < ABC_DISTRIBUTION.A + ABC_DISTRIBUTION.B ? 'B' : 'C');
    const year = irnd(yearStart, yearEnd);
    const orderHour = getOrderHour();
    const orderDate = new Date(year, month - 1, irnd(1, 28), orderHour, irnd(0, 59), irnd(0, 59));

    // ë°°ì†¡ ëª¨ë“œ
    let availableModes;
    const mReg = macroRegionBySiDo(region);
    if (forceRocket) {
      availableModes = ['ë¡œì¼“ë‹¹ì¼', 'ë¡œì¼“ìƒˆë²½', 'ë¡œì¼“ìµì¼', 'ë¡œì¼“í”„ë ˆì‹œ'].filter(mode => {
        const cfg = DELIVERY_MODES[mode];
        return cfg.regions.includes('ì „êµ­') || cfg.regions.includes(region) || cfg.regions.includes(mReg)
      });
      if (mReg !== 'ìˆ˜ë„ê¶Œ') availableModes = availableModes.filter(m => m !== 'ë¡œì¼“ë‹¹ì¼');
      if (categoryData.freshFood && availableModes.includes('ë¡œì¼“í”„ë ˆì‹œ') && Math.random() < 0.6) availableModes = ['ë¡œì¼“í”„ë ˆì‹œ'];
      if (!availableModes.length) availableModes = ['ë¡œì¼“ìµì¼'];
    } else {
      availableModes = ['ì¼ë°˜íƒë°°'];
    }
    const deliveryMode = pick(availableModes);
    const modeConfig = DELIVERY_MODES[deliveryMode];

    // ë‚©ê¸° ê³„íš
    const plannedDelivery = new Date(orderDate);
    if (deliveryMode === 'ë¡œì¼“ë‹¹ì¼') {
      const cutoffHour = modeConfig.cutoffHour;
      if (orderDate.getHours() >= cutoffHour) {
        plannedDelivery.setDate(plannedDelivery.getDate() + 1);
        plannedDelivery.setHours(6 + irnd(0, 3), irnd(0, 59), 0, 0)
      } else {
        const h = Math.max(3, cutoffHour - orderDate.getHours() + irnd(-1, 2));
        plannedDelivery.setHours(orderDate.getHours() + h, irnd(0, 59), 0, 0)
      }
    } else if (deliveryMode === 'ë¡œì¼“ìƒˆë²½') {
      plannedDelivery.setDate(plannedDelivery.getDate() + modeConfig.baseDays);
      plannedDelivery.setHours(6, irnd(0, 30), 0, 0)
    } else {
      plannedDelivery.setDate(plannedDelivery.getDate() + modeConfig.baseDays);
      plannedDelivery.setHours(irnd(9, 18), irnd(0, 59), 0, 0)
    }

    const weather = pickWeather(region, month);
    const weatherSev = weatherSeverity(weather);
    const isPeakTime = orderDate.getHours() >= 19 && orderDate.getHours() <= 21;
    const isWeekend = [0, 6].includes(orderDate.getDay());
    let actualDelayRate = modeConfig.delayRate;
    if (weatherSev > 0.4) actualDelayRate *= 1.8;
    if (isPeakTime) actualDelayRate *= 1.3;
    if (isWeekend) actualDelayRate *= 0.8;
    if (region === 'ì œì£¼íŠ¹ë³„ìì¹˜ë„') actualDelayRate *= 2.2;
    const isDelayed = Math.random() < actualDelayRate;
    let actualDelivery = new Date(plannedDelivery);
    let delayHours = 0;
    if (isDelayed) {
      const baseDelay = deliveryMode.includes('ë¡œì¼“') ? irnd(4, 24) : irnd(12, 48);
      delayHours = baseDelay + (weatherSev > 0.6 ? irnd(0, 24) : 0);
      actualDelivery.setHours(actualDelivery.getHours() + delayHours)
    } else {
      const early = deliveryMode.includes('ë¡œì¼“') ? rnd(0, 4) : rnd(0, 2);
      actualDelivery.setTime(actualDelivery.getTime() - early * 3600000)
    }

    // ì°¨ëŸ‰/ê¸°ì‚¬/ìë™í™”
    const suitableVehicles = VEHICLES.filter(v => v.regions.includes('ì „ì²´') || (v.regions.includes('ë„ì‹¬') && ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ'].includes(region)) || (v.regions.includes('ê°„ì„ ') && macroRegionBySiDo(region) !== 'ìˆ˜ë„ê¶Œ'));
    const vehicle = pick(suitableVehicles);
    const vehicleId = `V${irnd(10000, 99999)}`;
    const driverId = `D${irnd(1000, 9999)}`;
    const driverGrade = pick(DRIVER_GRADES);
    const baseLoadFactor = Math.random() < 0.3 ? rnd(40, 70) : rnd(70, 95);
    const loadFactor = Math.round(clamp(baseLoadFactor, 20, 100));
    const fuelEfficiency = Math.round(rnd(vehicle.fuelEff[0], vehicle.fuelEff[1]) * 10) / 10;
    const automationLevel = getAutomationLevel(region);
    const baseRouting = automationLevel === 'AI_OPTIMIZED' ? rnd(88, 98) : automationLevel === 'AUTO' ? rnd(78, 92) : automationLevel === 'SEMI_AUTO' ? rnd(65, 85) : rnd(50, 75);
    const routingScore = Math.round(baseRouting);

    // ë¹„ìš©
    const regLog = REGION_LOGISTICS[region];
    const baseCost = regLog.baseCost;
    const distanceCost = distanceKm * regLog.perKmCost;
    const modeCostMultiplier = modeConfig.cost;
    const weatherMultiplier = weatherSev > 0.6 ? 1.25 : (weatherSev > 0.3 ? 1.1 : 1.0);
    const peakMultiplier = isPeakTime ? 1.15 : 1.0;
    const handlingBase = 500;
    const islandMultiplier = region === 'ì œì£¼íŠ¹ë³„ìì¹˜ë„' ? (weatherSev > 0.6 ? 1.8 : 1.5) : 1.0;
    const estCost = Math.round((baseCost + distanceCost + handlingBase) * modeCostMultiplier * weatherMultiplier * peakMultiplier * islandMultiplier);
    const driverFactor = 1 + rnd(-0.05, 0.05);
    const vehicleFactor = (vehicle.type === 'ëŒ€í˜•íŠ¸ëŸ­' ? 1.08 : (vehicle.type === 'ì˜¤í† ë°”ì´' ? 0.92 : 1.0));
    const hubFactor = (Math.random() < 0.5 && (Math.random() < 0.65)) ? 1 + rnd(0.02, 0.08) : 1.0;
    const congestion = isPeakTime ? irnd(0, 400) : 0;
    const weatherSurcharge = (weather === 'ê°•í’' || weather === 'ëˆˆ') ? irnd(200, 700) : 0;
    const jitter = irnd(-150, 150);
    const actualLogisticsCost = Math.max(0, Math.round((estCost * driverFactor * vehicleFactor * hubFactor + congestion + weatherSurcharge + jitter) * CAL.costBias));

    // ë°°ì†¡ë¹„
    let customerDeliveryCharge = 0;
    if (customerProfile.isWow === 0 && orderAmount < 50000) {
      customerDeliveryCharge = deliveryMode.includes('ë¡œì¼“') ? 3500 : 3000
    }
    customerDeliveryCharge = Math.round(customerDeliveryCharge);

    // ì½œë“œì²´ì¸/ë°˜í’ˆ
    const tempData = generateTemperatureData(selectedCategory, !!categoryData.coldChain);
    let returnRate = categoryData.returnRate;
    if (tempData.violation) returnRate *= 2.5;
    if (isDelayed && deliveryMode.includes('ë¡œì¼“')) returnRate *= 1.8;
    const returnFlag = Math.random() < returnRate ? 1 : 0;
    const returnReason = returnFlag ? pick(RETURN_REASONS) : null;
    const returnCost = returnFlag ? Math.round(orderAmount * rnd(0.1, 0.25)) : 0;
    let resellable = null, resellReason = null;
    if (returnFlag) {
      if (tempData.violation) {
        resellable = 0;
        resellReason = 'ì˜¨ë„ê´€ë¦¬ì‹¤íŒ¨'
      } else if (['ë‹¨ìˆœë³€ì‹¬', 'ê¸°íƒ€'].includes(returnReason)) {
        resellable = Math.random() < 0.92 ? 1 : 0;
        resellReason = resellable ? 'ì •ìƒìƒí’ˆ' : 'í¬ì¥ì†ìƒ'
      } else {
        resellable = Math.random() < 0.45 ? 1 : 0;
        resellReason = resellable ? 'ë¶€ë¶„ìˆ˜ë¦¬ê°€ëŠ¥' : 'ìƒí’ˆì†ìƒ'
      }
    }

    // ì¬ê³ 
    const currentStock = abcGrade === 'A' ? irnd(200, 800) : (abcGrade === 'B' ? irnd(50, 300) : irnd(10, 100));
    const reorderPoint = Math.round(currentStock * (abcGrade === 'A' ? 0.4 : abcGrade === 'B' ? 0.3 : 0.2));
    const stockTurnover = abcGrade === 'A' ? rnd(12, 20) : (abcGrade === 'B' ? rnd(6, 12) : rnd(2, 8));
    const stockoutFlag = Math.random() < (abcGrade === 'A' ? 0.015 : abcGrade === 'B' ? 0.04 : 0.08) ? 1 : 0;
    const overstockFlag = Math.random() < (CAL.overstockProb ?? 0.22) ? 1 : 0;

    // ìë™í™”
    const automationConfig = AUTOMATION_LEVELS[automationLevel];
    const pickingTime = automationConfig.pickingTime + rnd(-3, 5);
    const packingTime = automationConfig.packingTime + rnd(-2, 3);
    const totalProcessTime = Math.round((pickingTime + packingTime) * 10) / 10;

    // FC ì¶œê³  ì‹œê°„
    const SLA = SHIP_SLA_MIN[deliveryMode] ?? SHIP_SLA_MIN.DEFAULT;
    let orderToShipMinutes;
    if (Math.random() < 0.90) orderToShipMinutes = irnd(10, Math.floor(SLA * 0.8)); else orderToShipMinutes = irnd(Math.floor(SLA * 0.8) + 1, Math.floor(SLA * 1.2));
    const autoBoost = automationLevel === 'AI_OPTIMIZED' ? 0.85 : automationLevel === 'AUTO' ? 0.93 : automationLevel === 'SEMI_AUTO' ? 1.00 : 1.05;
    const peakPenalty = (orderHour >= 19 && orderHour <= 21) ? 1.06 : 1.0;
    orderToShipMinutes = Math.round(orderToShipMinutes * autoBoost * peakPenalty);
    const pickStart = new Date(orderDate.getTime() + irnd(5, 15) * 60000);
    const pickEnd = new Date(pickStart.getTime() + Math.max(5, pickingTime) * 1000);
    const packStart = new Date(pickEnd.getTime() + irnd(2, 12) * 60000);
    const packEnd = new Date(packStart.getTime() + Math.max(4, packingTime) * 1000);
    const shipSlaDue = new Date(orderDate.getTime() + SLA * 60000);
    let fcExit = new Date(orderDate.getTime() + Math.max(orderToShipMinutes, 5) * 60000);
    const minBufferMin = irnd(3, 10);
    if (fcExit < new Date(packEnd.getTime() + minBufferMin * 60000)) {
      fcExit = new Date(packEnd.getTime() + minBufferMin * 60000)
    }
    orderToShipMinutes = Math.round((fcExit - orderDate) / 60000);
    const fastShipFlag = orderToShipMinutes <= 30 ? 1 : 0;
    const fcSlaBreach = fcExit > shipSlaDue ? 1 : 0;

    // CAC/LTV & ì†ìµ
    const baseCac = customerProfile.isWow ? irnd(3500, 7000) : irnd(1200, 2800);
    const wowTierConfig = customerProfile.wowTier ? WOW_TIERS[customerProfile.wowTier] : {ltvMultiplier: 1.5};
    const customerLTV = Math.round(orderAmount * wowTierConfig.ltvMultiplier * rnd(2.8, 4.2));
    const grossProfit = Math.round(orderAmount * categoryData.margin);
    const inventoryCarryingCost = Math.round(currentStock * unitPrice * 0.002 / 12);
    const stockoutCost = stockoutFlag ? Math.round(orderAmount * 0.08) : 0;
    const qualityCost = tempData.violation ? Math.round(orderAmount * 0.05) : 0;
    const netProfit = grossProfit - actualLogisticsCost - returnCost - inventoryCarryingCost - stockoutCost - qualityCost;

    let churnScore = customerProfile.churnFlag ? rnd(0.65, 0.95) : rnd(0.05, 0.55);
    if (isDelayed && deliveryMode.includes('ë¡œì¼“')) churnScore += 0.15;
    if (returnFlag && !resellable) churnScore += 0.1;
    churnScore = Math.min(0.98, Math.round(churnScore * 1000) / 1000);

    const serviceQualityScore = Math.round((100 - (isDelayed ? 15 : 0) - (returnFlag ? 10 : 0) - (tempData.violation ? 20 : 0)) * (automationLevel === 'AI_OPTIMIZED' ? 1.05 : 1.0));
    const wmsUsage = automationLevel === 'MANUAL' ? 'Legacy' : 'Active';
    const omsUsage = Math.random() < 0.95 ? 'Active' : 'Manual';
    const wmsAdvancedScore = automationLevel === 'AI_OPTIMIZED' ? rnd(88, 96) : automationLevel === 'AUTO' ? rnd(75, 87) : automationLevel === 'SEMI_AUTO' ? rnd(55, 74) : rnd(30, 54);

    const monthlyKey = `${custId}-${year}-${pad(orderDate.getMonth() + 1)}`;

    const isRocketDelivery = deliveryMode.includes('ë¡œì¼“') ? 1 : 0;
    const isSameDayDelivery = deliveryMode === 'ë¡œì¼“ë‹¹ì¼' ? 1 : 0;
    const isDawnDelivery = deliveryMode === 'ë¡œì¼“ìƒˆë²½' ? 1 : 0;
    const isFreshDelivery = deliveryMode === 'ë¡œì¼“í”„ë ˆì‹œ' ? 1 : 0;
    const isPremiumOrder = (selectedCategory === 'ê°€ì „ì „ì' || orderAmount >= 200000) ? 1 : 0;
    const isBulkOrder = quantity >= 3 ? 1 : 0;
    const isFreeShipping = (customerProfile.isWow === 1 || orderAmount >= 50000) ? 1 : 0;
    const isWeatherRisk = (weatherSev > 0.5) ? 1 : 0;
    const isLongDistance = distanceKm > 35 ? 1 : 0;
    const isHighLTV = customerLTV > 300000 ? 1 : 0;
    const isChurnRisk = churnScore >= 0.65 ? 1 : 0;
    const isVIPCustomer = (customerProfile.isWow === 1 && isHighLTV) ? 1 : 0;
    const isLossOrder = (netProfit < 0) ? 1 : 0;
    const isAIOptimized = (automationLevel === 'AI_OPTIMIZED') ? 1 : 0;

    // WMS/OMS/í’ˆì§ˆ
    const processingErrorRate = AUTOMATION_LEVELS[automationLevel].errorRate;
    const customerNPS = Math.round(clamp(70 + (isDelayed ? -10 : 5) + (returnFlag ? -12 : 0) + (tempData.violation ? -15 : 0) + (isAIOptimized ? 5 : 0), 0, 100));

    // WMS ê³ ë„í™” ì ìˆ˜ ìˆ˜ì¹˜í™”
    const wmsAdvanced = Math.round(wmsAdvancedScore);

    // ë„¤íŠ¸ì›Œí¬ íƒ€ì„ë¼ì¸ (FCâ†’í—ˆë¸Œ/ìº í”„â†’OFD)
    // ìˆ˜ë„ê¶Œì€ FCâ†’ìº í”„ ì§ì ‘, ê·¸ ì™¸ëŠ” FCâ†’í—ˆë¸Œâ†’ìº í”„
    const routeIsMetro = (['ì„œìš¸íŠ¹ë³„ì‹œ', 'ê²½ê¸°ë„', 'ì¸ì²œê´‘ì—­ì‹œ'].includes(region));
    const routeType = routeIsMetro ? 'FCâ†’CAMPâ†’OFD' : 'FCâ†’HUBâ†’CAMPâ†’OFD';
    const sortHub = routeIsMetro ? null : (pick(MEGA_HUBS));
    const isMegaHub = sortHub ? 1 : 0;

    // ì´ë™/ëŒ€ê¸° ì‹œê°„ (ë¶„)
    const fcDwellMin = irnd(5, 20);
    const hubDwellMin = sortHub ? irnd(20, 90) : null;
    const campDwellMin = irnd(8, 25);

    // ì‹œê°„ ìŠ¤íƒ¬í”„
    const fcExitTS = new Date(fcExit);
    let hubInTS = null, hubOutTS = null;
    if (sortHub) {
      hubInTS = new Date(fcExitTS.getTime() + irnd(40, 120) * 60000);
      hubOutTS = new Date(hubInTS.getTime() + (hubDwellMin ?? 30) * 60000);
    }
    const campInBase = sortHub ? hubOutTS : fcExitTS;
    const campInTS = new Date(campInBase.getTime() + irnd(25, 80) * 60000);
    const loadStartTS = new Date(campInTS.getTime() + campDwellMin * 60000);
    const loadEndTS = new Date(loadStartTS.getTime() + irnd(5, 20) * 60000);
    const ofdTS = new Date(loadEndTS.getTime() + irnd(15, 90) * 60000);

    // ë°°ì†¡ ìƒíƒœ/ì§€ì—°
    const plannedDeliveryDate = plannedDelivery.toISOString().split('T')[0];
    const actualDeliveryDate = actualDelivery.toISOString().split('T')[0];
    const delayHrs = Math.max(0, Math.round((actualDelivery - plannedDelivery) / 3600000));
    const deliveryStatus = isDelayed ? 'Delayed Delivered' : 'Delivered';
    const slaBreach = isDelayed ? 1 : 0;

    // ê±°ë¦¬ ë²„í‚·
    let distanceBucket, distanceBandLabel;
    if (distanceKm <= 10) {
      distanceBucket = 1;
      distanceBandLabel = 'â‰¤10km'
    } else if (distanceKm <= 20) {
      distanceBucket = 2;
      distanceBandLabel = '11â€“20km'
    } else if (distanceKm <= 30) {
      distanceBucket = 3;
      distanceBandLabel = '21â€“30km'
    } else if (distanceKm <= 40) {
      distanceBucket = 4;
      distanceBandLabel = '31â€“40km'
    } else {
      distanceBucket = 5;
      distanceBandLabel = '>40km'
    }

    // ì…ê³ /ì ì¹˜/ìœ í†µê¸°í•œ/ë¡œì¼€ì´ì…˜
    const receivingDate = new Date(orderDate.getTime() - irnd(1, 5) * 86400000);
    const putawayDate = new Date(receivingDate.getTime() + irnd(0, 2) * 86400000);
    const {Bin, Slot} = genBinSlot();
    const {Lot_ID, Expiry_Date} = genLotAndExpiry(selectedCategory, orderDate, receivingDate);
    const unitCost = estimateUnitCost(selectedCategory, unitPrice);
    const forecast = forecastByABC(abcGrade);
    const safetyStock = safetyStockCalc(forecast, irnd(1, 7));
    const dailyOnHandSnapshot = irnd(Math.max(0, currentStock - 50), currentStock + 50);

    // CLV ì‚¬ë¶„ìœ„
    const clvQuartile = (customerLTV >= 600000) ? 1 : (customerLTV >= 300000) ? 2 : (customerLTV >= 150000) ? 3 : 4;
    const clvQuartileLabel = ['Top 25%', '25â€“50%', '50â€“75%', 'Bottom 25%'][clvQuartile - 1];

    // ê¸°íƒ€ ID
    const asnId = 'ASN' + irnd(1000000, 9999999);
    const poId = 'PO' + irnd(1000000, 9999999);
    const replType = pick(['Regular', 'Safety Refill', 'Promotion', 'Seasonal']);

    const row = {
      Order_ID: `ORD${String(1000000 + index).padStart(7, '0')}`,
      Order_Date: orderDate.toISOString().split('T')[0],
      Order_Timestamp: orderDate.toISOString(),
      Order_Hour: orderHour,

      Delivery_Mode: deliveryMode,
      Planned_Delivery_Date: plannedDeliveryDate,
      Actual_Delivery_Date: actualDeliveryDate,
      Delivery_Timestamp: actualDelivery.toISOString(),
      Is_Delayed: isDelayed ? 1 : 0,
      Delay_Hours: delayHrs,
      SLA_Breach: slaBreach,
      Delivery_Status: deliveryStatus,

      Fast_Ship_30min: fastShipFlag,
      Order_To_Ship_Minutes: orderToShipMinutes,

      Region: region, City: city, District: district, Address: address,
      Fulfillment_Center: selectFulfillmentCenter(region),
      Delivery_Center: `${city} ë°°ì†¡ìº í”„`,
      Is_Mega_Hub: isMegaHub,
      Distance_km: distanceKm,

      Customer_ID: custId,
      Is_WOW_Member: customerProfile.isWow,
      WOW_Tier: customerProfile.wowTier,
      WOW_Join_Date: customerProfile.joinDate ? customerProfile.joinDate.toISOString().split('T')[0] : null,
      WOW_Tenure_Days: customerProfile.joinDate ? Math.round((orderDate - customerProfile.joinDate) / 86400000) : 0,
      Customer_Segment: pick(['ì¼ë°˜', 'í™œì„±', 'í•µì‹¬', 'íœ´ë©´ì¤€ë¹„']),

      Product_Category: selectedCategory,
      SKU: sku,
      ABC_Category: abcGrade,
      Unit_Price: unitPrice,
      Quantity: quantity,
      Order_Amount: orderAmount,

      Is_Fresh_Food: categoryData.freshFood ? 1 : 0,
      Is_Cold_Chain_Required: categoryData.coldChain ? 1 : 0,
      Target_Temperature: tempData.targetTemp ?? null,
      Actual_Temperature: tempData.actualTemp ?? null,
      Temperature_Violation: tempData.violation ? 1 : 0,
      Cold_Chain_Quality_Score: tempData.quality ?? null,

      Vehicle_ID: vehicleId,
      Vehicle_Type: vehicle.type,
      Vehicle_Capacity: vehicle.capacity,
      Driver_ID: driverId,
      Driver_Grade: driverGrade,
      Load_Factor: loadFactor,
      Fuel_Efficiency: fuelEfficiency,
      Routing_Score: routingScore,
      GPS_Tracking: 1,

      Actual_Logistics_Cost: actualLogisticsCost,
      Customer_Delivery_Charge: customerDeliveryCharge,
      Gross_Profit: grossProfit,
      Net_Profit: netProfit,

      CAC: baseCac,
      Customer_LTV: customerLTV,
      LTV_to_CAC: +(customerLTV / baseCac).toFixed(2),

      Return_Flag: returnFlag,
      Return_Reason: returnReason,
      Return_Cost: returnCost,
      Is_Resellable: resellable,
      Resellability_Reason: resellReason,

      Current_Stock: currentStock,
      Reorder_Point: reorderPoint,
      Stockout_Flag: stockoutFlag,
      Overstock_Flag: overstockFlag,
      Inventory_Turnover: Math.round(stockTurnover * 10) / 10,
      Inventory_Accuracy: Math.round(rnd(94, 99) * 10) / 10,

      Automation_Level: automationLevel,
      Picking_Time_Seconds: Math.round(pickingTime),
      Packing_Time_Seconds: Math.round(packingTime),
      Total_Process_Time: totalProcessTime,
      WMS_Usage: wmsUsage,
      OMS_Usage: omsUsage,
      WMS_Advanced_Score: wmsAdvanced,
      Service_Quality_Score: serviceQualityScore,
      Customer_NPS: customerNPS,
      Processing_Error_Rate: processingErrorRate,

      Weather_Condition: weather,
      Weather_Severity_Score: Math.round(weatherSev * 100) / 100,
      Churn_Flag: customerProfile.churnFlag,
      Predicted_Churn_Score: churnScore,

      Is_Rocket_Delivery: isRocketDelivery,
      Is_Same_Day_Delivery: isSameDayDelivery,
      Is_Dawn_Delivery: isDawnDelivery,
      Is_Fresh_Delivery: isFreshDelivery,
      Is_Premium_Order: isPremiumOrder,
      Is_Bulk_Order: isBulkOrder,
      Is_Weekend_Order: isWeekend ? 1 : 0,
      Is_Peak_Hour_Order: isPeakTime ? 1 : 0,
      Is_Free_Shipping: isFreeShipping ? 1 : 0,
      Is_Weather_Risk: isWeatherRisk ? 1 : 0,
      Is_Long_Distance: isLongDistance ? 1 : 0,
      Is_High_LTV: isHighLTV ? 1 : 0,
      Is_Churn_Risk: isChurnRisk ? 1 : 0,
      Is_VIP_Customer: isVIPCustomer ? 1 : 0,
      Is_Loss_Order: isLossOrder ? 1 : 0,
      Is_AI_Optimized: isAIOptimized ? 1 : 0,

      Receiving_Date: receivingDate.toISOString().split('T')[0],
      Putaway_Date: putawayDate.toISOString().split('T')[0],
      Lot_ID,
      Expiry_Date,
      Bin,
      Slot,
      Unit_Cost: unitCost,
      Daily_OnHand_Snapshot: dailyOnHandSnapshot,
      Safety_Stock: safetyStock,
      Forecast_Demand: forecast,
      ASN_ID: asnId,
      PO_ID: poId,
      Replenishment_Type: replType,

      Picking_Start_TS: pickStart.toISOString(),
      Picking_End_TS: pickEnd.toISOString(),
      Packing_Start_TS: packStart.toISOString(),
      Packing_End_TS: packEnd.toISOString(),
      Ship_SLA_Due_TS: shipSlaDue.toISOString(),
      FC_SLA_Breach: fcSlaBreach,
      Planned_Ship_Timestamp: shipSlaDue.toISOString(),
      Actual_Ship_Timestamp: fcExitTS.toISOString(),
      On_Time_Dispatch_Flag: fcSlaBreach ? 0 : 1,

      Distance_Bucket: distanceBucket,
      Distance_Band_Label: distanceBandLabel,

      [NET.ROUTE_TYPE]: routeType,
      [NET.SORT_HUB_NAME]: sortHub,
      [NET.FC_EXIT]: fcExitTS.toISOString(),
      [NET.HUB_IN]: hubInTS ? hubInTS.toISOString() : null,
      [NET.HUB_OUT]: hubOutTS ? hubOutTS.toISOString() : null,
      [NET.CAMP_IN]: campInTS.toISOString(),
      [NET.LOAD_START]: loadStartTS.toISOString(),
      [NET.LOAD_END]: loadEndTS.toISOString(),
      [NET.OFD]: ofdTS.toISOString(),
      [NET.FC_DWELL]: fcDwellMin,
      [NET.HUB_DWELL]: hubDwellMin,
      [NET.CAMP_DWELL]: campDwellMin
    };

    // ì›”ë³„ ê³ ê° í†µê³„ ëˆ„ì 
    if (!MONTHLY_BY_CUST[monthlyKey]) {
      MONTHLY_BY_CUST[monthlyKey] = {
        orders: 0,
        amount: 0,
        wow: customerProfile.isWow,
        churnFlag: customerProfile.churnFlag
      };
    }
    MONTHLY_BY_CUST[monthlyKey].orders += 1;
    MONTHLY_BY_CUST[monthlyKey].amount += orderAmount;

    return row;
  }

  // ==========================
  // 4) ë Œë”ë§ & ì§‘ê³„
  // ==========================
  function formatCurrencyKRW(n) {
    if (!isFinite(n)) return '-';
    return 'â‚©' + Math.round(n).toLocaleString('ko-KR')
  }

  function avg(arr) {
    const v = arr.filter(x => isFinite(x));
    return v.length ? v.reduce((a, b) => a + b, 0) / v.length : 0
  }

  function pct(num, den) {
    return den ? (num / den * 100) : 0
  }

  function buildTableHeader(keys) {
    const thead = qs('tbl').querySelector('thead');
    thead.innerHTML = '';
    const tr = document.createElement('tr');
    keys.forEach(k => {
      const th = document.createElement('th');
      th.textContent = prettyHeader(k);
      tr.appendChild(th);
    });
    thead.appendChild(tr);
  }

  function renderTableRows(rows, keys) {
    const tbody = qs('tbl').querySelector('tbody');
    const frag = document.createDocumentFragment();
    rows.forEach(r => {
      const tr = document.createElement('tr');
      keys.forEach(k => {
        const td = document.createElement('td');
        let v = r[k];
        td.textContent = (v === null || v === undefined) ? '' : v;
        if (k === 'Delivery_Mode') {
          td.className = 'delivery-mode ' + (v === 'ë¡œì¼“ìƒˆë²½' ? 'dawn' : (v === 'ë¡œì¼“í”„ë ˆì‹œ' ? 'fresh' : (v.includes('ë¡œì¼“') ? 'rocket' : '')));
        }
        tr.appendChild(td);
      });
      frag.appendChild(tr);
    });
    tbody.appendChild(frag);
  }

  function updateKPIs() {
    const total = DATA.length || 1;
    const sum = (k, fn = Number) => DATA.reduce((a, r) => a + (isFinite(fn(r[k])) ? fn(r[k]) : 0), 0);
    const cnt = (pred) => DATA.reduce((a, r) => a + (pred(r) ? 1 : 0), 0);

    const rocketShare = pct(cnt(r => r.Is_Rocket_Delivery === 1), total);
    const sameDaySuccess = pct(cnt(r => r.Delivery_Mode === 'ë¡œì¼“ë‹¹ì¼' && r.Is_Delayed === 0), cnt(r => r.Delivery_Mode === 'ë¡œì¼“ë‹¹ì¼'));
    const dawnOnTime = pct(cnt(r => r.Delivery_Mode === 'ë¡œì¼“ìƒˆë²½' && r.Is_Delayed === 0), cnt(r => r.Delivery_Mode === 'ë¡œì¼“ìƒˆë²½'));
    const fastShip = pct(cnt(r => r.Fast_Ship_30min === 1), total);

    const fcOnTime = 100 - pct(cnt(r => r.FC_SLA_Breach === 1), total);
    const avgShipHr = avg(DATA.map(r => r.Order_To_Ship_Minutes)) / 60;
    const pickSecPerItem = avg(DATA.map(r => r.Picking_Time_Seconds / Math.max(1, r.Quantity)));
    const packSecPerItem = avg(DATA.map(r => r.Packing_Time_Seconds / Math.max(1, r.Quantity)));
    const effFulfill = clamp(100 - (avg(DATA.map(r => r.Processing_Error_Rate)) * 100 * 2), 0, 100);
    const shipUnder60 = pct(cnt(r => r.Order_To_Ship_Minutes <= 60), total);

    const wowShare = pct(cnt(r => r.Is_WOW_Member === 1), total);
    const wowAov = avg(DATA.filter(r => r.Is_WOW_Member === 1).map(r => r.Order_Amount));
    const nonWowAov = avg(DATA.filter(r => r.Is_WOW_Member === 0).map(r => r.Order_Amount));
    const wowAovGap = (wowAov - nonWowAov);
    const wowChurnRisk = cnt(r => r.Is_WOW_Member === 1 && r.Is_Churn_Risk === 1);

    const freshShare = pct(cnt(r => r.Is_Fresh_Food === 1), total);
    const coldChainRequired = cnt(r => r.Is_Cold_Chain_Required === 1);
    const tempViol = pct(cnt(r => r.Temperature_Violation === 1), coldChainRequired);
    const coldChainRate = 100 - tempViol;
    const frozenQuality = avg(DATA.filter(r => r.Product_Category === 'ëƒ‰ë™ì‹í’ˆ' && isFinite(r.Cold_Chain_Quality_Score)).map(r => r.Cold_Chain_Quality_Score));

    const metroCoverage = pct(cnt(r => ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ê²½ê¸°ë„', 'ì¸ì²œê´‘ì—­ì‹œ'].includes(r.Region)), total);
    const avgDist = avg(DATA.map(r => r.Distance_km));
    const networkEff = avg(DATA.map(r => r.Routing_Score));

    const aiOpt = pct(cnt(r => r.Automation_Level === 'AI_OPTIMIZED'), total);
    const autoPickRate = avg(DATA.map(r => {
      return r.Automation_Level === 'AI_OPTIMIZED' ? 90 :
        r.Automation_Level === 'AUTO' ? 70 :
          r.Automation_Level === 'SEMI_AUTO' ? 40 : 10
    }));
    const avgPickTime = avg(DATA.map(r => r.Picking_Time_Seconds));
    const wmsAdv = avg(DATA.map(r => r.WMS_Advanced_Score));

    const totalSales = sum('Order_Amount');
    const totalNet = sum('Net_Profit');
    const netMargin = pct(totalNet, totalSales);
    const aov = avg(DATA.map(r => r.Order_Amount));
    const uniqueCust = new Set(DATA.map(r => r.Customer_ID)).size || 1;
    const arppu = totalSales / uniqueCust;

    const ltvAvg = avg(DATA.map(r => r.Customer_LTV));
    const cacAvg = avg(DATA.map(r => r.CAC));
    const ltvCac = (cacAvg ? (ltvAvg / cacAvg) : 0).toFixed(2);

    const churnRate = pct(cnt(r => r.Is_Churn_Risk === 1), total);
    // ê°„ë‹¨í•œ AI ì´íƒˆ ì˜ˆì¸¡ ì •í™•ë„: (ì˜ˆì¸¡ê³¼ ì‹¤ì œ Churn_Flag ì¼ì¹˜ìœ¨)
    const aiAcc = pct(cnt(r => (r.Is_Churn_Risk === 1) === (r.Churn_Flag === 1)), total);

    const onTime = pct(cnt(r => r.Is_Delayed === 0), total);
    const sla = pct(cnt(r => r.SLA_Breach === 1), total);
    const load = avg(DATA.map(r => r.Load_Factor));
    const fuel = avg(DATA.map(r => r.Fuel_Efficiency));
    const route = avg(DATA.map(r => r.Routing_Score));
    const exception = pct(cnt(r => (r.Temperature_Violation === 1 || r.FC_SLA_Breach === 1 || r.Return_Flag === 1)), total);

    const retRate = pct(cnt(r => r.Return_Flag === 1), total);
    const retCostRate = pct(sum('Return_Cost'), totalSales);
    const resell = pct(cnt(r => r.Return_Flag === 1 && r.Is_Resellable === 1), cnt(r => r.Return_Flag === 1));

    const invTurn = avg(DATA.map(r => r.Inventory_Turnover));
    const stockout = pct(cnt(r => r.Stockout_Flag === 1), total);
    const overstock = pct(cnt(r => r.Overstock_Flag === 1), total);
    const invAcc = avg(DATA.map(r => r.Inventory_Accuracy));
    const shrink = avg(DATA.map(r => r.Inventory_Accuracy ? (100 - r.Inventory_Accuracy) : 0));
    const wmsUse = pct(cnt(r => r.WMS_Usage === 'Active'), total);

    // KPI í‘œì‹œ
    setText('k_rocketShare', fmtPct(rocketShare));
    setText('k_rocketSameDayRate', fmtPct(sameDaySuccess));
    setText('k_rocketDawnRate', fmtPct(dawnOnTime));
    setText('k_fastShipRate', fmtPct(fastShip));

    setText('k_fcOnTimeShip', fmtPct(fcOnTime));
    setText('k_fcAvgShipHour', (avgShipHr || 0).toFixed(2));
    setText('k_fcPickSecPerItem', (pickSecPerItem || 0).toFixed(1));
    setText('k_fcPackSecPerItem', (packSecPerItem || 0).toFixed(1));
    setText('k_fcEfficiency', (effFulfill || 0).toFixed(1));
    setText('k_fcShipUnder60', fmtPct(shipUnder60));

    setText('k_wowShare', fmtPct(wowShare));
    setText('k_wowPlusShare', '0'); // Placeholder
    setText('k_wowAovGap', formatCurrencyKRW(wowAovGap));
    setText('k_wowChurnRisk', wowChurnRisk.toLocaleString('ko-KR'));

    setText('k_freshShare', fmtPct(freshShare));
    setText('k_coldChainRate', fmtPct(coldChainRate));
    setText('k_tempViolation', fmtPct(tempViol));
    setText('k_frozenQuality', (frozenQuality || 0).toFixed(0));

    setText('k_megaHubShare', fmtPct(pct(cnt(r => r.Is_Mega_Hub === 1), total)));
    setText('k_seoulCoverage', fmtPct(metroCoverage));
    setText('k_avgDistance', (avgDist || 0).toFixed(1));
    setText('k_networkEff', (networkEff || 0).toFixed(0));

    setText('k_aiOptimized', fmtPct(aiOpt));
    setText('k_autoPickRate', (autoPickRate || 0).toFixed(1));
    setText('k_avgPickTime', (avgPickTime || 0).toFixed(1));
    setText('k_wmsAdvanced', (wmsAdv || 0).toFixed(0));

    setText('k_totalSales', formatCurrencyKRW(totalSales));
    setText('k_netMargin', (netMargin || 0).toFixed(2));
    setText('k_aov', formatCurrencyKRW(aov));
    setText('k_arppu', formatCurrencyKRW(arppu));

    setText('k_ltvCac', ltvCac);
    setText('k_retention', (100 - churnRate).toFixed(1));
    setText('k_churn', churnRate.toFixed(1));
    setText('k_ai', aiAcc.toFixed(1));

    setText('k_onTime', fmtPct(onTime));
    setText('k_sla', fmtPct(sla));
    setText('k_load', (load || 0).toFixed(1));
    setText('k_fuel', (fuel || 0).toFixed(2));
    setText('k_route', (route || 0).toFixed(0));
    setText('k_exception', fmtPct(exception));

    setText('k_returnRate', fmtPct(retRate));
    setText('k_returnCost', (retCostRate || 0).toFixed(2));
    setText('k_resell', fmtPct(resell));

    setText('k_invTurn', (invTurn || 0).toFixed(1));
    setText('k_stockout', fmtPct(stockout));
    setText('k_overstock', fmtPct(overstock));
    setText('k_invAcc', (invAcc || 0).toFixed(1));
    setText('k_shrink', (shrink || 0).toFixed(1));
    setText('k_wms', fmtPct(wmsUse));
  }

  function updateValidationAndRisk() {
    const list = qs('validateList');
    list.innerHTML = '';
    const risk = qs('riskList');
    risk.innerHTML = '';
    const perf = qs('perfList');
    perf.innerHTML = '';

    if (DATA.length === 0) {
      qs('validateSummary').textContent = '-';
      return;
    }

    const total = DATA.length;
    const coldReq = DATA.filter(r => r.Is_Cold_Chain_Required === 1);
    const tempViolRate = pct(coldReq.filter(r => r.Temperature_Violation === 1).length, coldReq.length || 1) / 100;
    const lossRate = pct(DATA.filter(r => r.Is_Loss_Order === 1).length, total) / 100;
    const jejuRate = pct(DATA.filter(r => r.Region === 'ì œì£¼íŠ¹ë³„ìì¹˜ë„' && r.Is_Weather_Risk === 1).length, DATA.filter(r => r.Region === 'ì œì£¼íŠ¹ë³„ìì¹˜ë„').length || 1) / 100;
    const overStockRate = pct(DATA.filter(r => r.Overstock_Flag === 1).length, total) / 100;
    const expirySoonRate = pct(DATA.filter(r => r.Expiry_Date && (new Date(r.Expiry_Date) - new Date(r.Order_Date) <= 86400000)).length, total) / 100;

    function pill(text, type) {
      const d = document.createElement('div');
      d.className = 'alert ' + type;
      d.textContent = text;
      return d
    }

    // ì •í•©ì„±
    const okText = `ì½œë“œì²´ì¸ ìœ„ë°˜ìœ¨ ${(tempViolRate * 100).toFixed(2)}% / ì†ì‹¤ì£¼ë¬¸ìœ¨ ${(lossRate * 100).toFixed(2)}%`;
    qs('validateSummary').textContent = okText;

    // íƒ€ê¹ƒ ë²—ì–´ë‚˜ë©´ ê²½ë³´
    const pushIf = (cond, text, type = 'warn') => {
      if (cond) risk.appendChild(pill(text, type))
    }
    pushIf(tempViolRate > DIALS.tempViolationTarget[1], `ì½œë“œì²´ì¸ ìœ„ë°˜ìœ¨ ìƒí•œ ì´ˆê³¼ (${(tempViolRate * 100).toFixed(2)}% > ${(DIALS.tempViolationTarget[1] * 100).toFixed(1)}%)`, 'bad');
    pushIf(lossRate > DIALS.lossOrderTarget[1], `ì ìì£¼ë¬¸ìœ¨ ìƒí•œ ì´ˆê³¼ (${(lossRate * 100).toFixed(2)}%)`, 'bad');
    pushIf(jejuRate > DIALS.jejuWeatherExposureTarget[1], `ì œì£¼ ì•…ì²œí›„ ë…¸ì¶œ ê³¼ë‹¤ (${(jejuRate * 100).toFixed(1)}%)`, 'warn');
    pushIf(overStockRate > DIALS.overstockTarget[1], `ê³¼ì¬ê³  ë¹„ìœ¨ ê³¼ë‹¤ (${(overStockRate * 100).toFixed(1)}%)`, 'warn');
    pushIf(expirySoonRate > DIALS.expiryImminentTarget[1], `ìœ í†µê¸°í•œ ì„ë°• ê³¼ë‹¤ (${(expirySoonRate * 100).toFixed(2)}%)`, 'warn');

    // ì„±ëŠ¥/í˜„ì‹¤ì„±
    const rps = PROCESSING_STATE.processedRows / Math.max(1, ((Date.now() - PROCESSING_STATE.startTime) / 1000));
    perf.appendChild(pill(`ìƒì„± ì²˜ë¦¬ì†ë„: ${rps.toFixed(1)} rows/sec`, 'good'));
    perf.appendChild(pill(`ë©”ëª¨ë¦¬ ë³´í˜¸: ìµœëŒ€ ${CHUNK_CONFIG.maxMemoryRows.toLocaleString('ko-KR')} rows ìœ ì§€`, 'good'));
  }

  // ==========================
  // 5) ì§„í–‰ í‘œì‹œ
  // ==========================
  function setStatus(text, cls = 'ok') {
    const st = qs('status');
    st.textContent = text;
    st.className = 'pill ' + cls;
  }

  function showProgress(show) {
    setDisplay('progressContainer', show);
  }

  function updateProgress() {
    const {processedRows, totalRows} = PROCESSING_STATE;
    const pctNum = Math.min(100, Math.round(processedRows / Math.max(1, totalRows) * 100));
    qs('progressFill').style.width = pctNum + '%';
    qs('progressText').textContent = `ì²˜ë¦¬ ì¤‘... ${processedRows.toLocaleString('ko-KR')} / ${totalRows.toLocaleString('ko-KR')}`;
    const elapsed = (Date.now() - PROCESSING_STATE.startTime) / 1000;
    const rps = processedRows / Math.max(0.1, elapsed);
    const remain = (totalRows - processedRows) / Math.max(0.1, rps);
    qs('progressStats').textContent = `ì†ë„ ${rps.toFixed(1)} r/s`;
    qs('progressETA').textContent = `ì˜ˆìƒ ì™„ë£Œ: ${(remain).toFixed(0)}s`;
  }

  // ==========================
  // 6) CSV
  // ==========================
  function toCSV(rows) {
    if (!rows.length) return '';
    const keys = Object.keys(rows[0]);
    const header = keys.map(k => `"${(CSV_SPECIAL_LABELS[k] || k).replace(/"/g, '""')}"`).join(',');
    const lines = rows.map(r => keys.map(k => {
      const v = (r[k] === null || r[k] === undefined) ? '' : String(r[k]);
      return `"${v.replace(/"/g, '""')}"`;
    }).join(','));
    return [header, ...lines].join('\n');
  }

  function downloadCSV() {
    const csv = toCSV(DATA);
    const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `coupang_sim_${Date.now()}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // ==========================
  // 7) ìƒì„± ë£¨í”„
  // ==========================
  async function startGeneration() {
    const startYear = parseInt(qs('startYear').value, 10);
    const endYear = parseInt(qs('endYear').value, 10);
    const userCount = parseInt(qs('userCount').value, 10);
    const orderCount = parseInt(qs('orderCount').value, 10);
    const chunkSize = parseInt(qs('chunkSize').value, 10);
    const rocketRate = parseFloat(qs('rocketRate').value);
    const wowRate = parseFloat(qs('wowRate').value);

    // ìƒíƒœ ì´ˆê¸°í™”
    DATA = [];
    MONTHLY_BY_CUST = {};
    VALIDATION_ISSUES = [];
    PROCESSING_STATE = {
      isRunning: true,
      shouldStop: false,
      startTime: Date.now(),
      processedRows: 0,
      totalRows: orderCount,
      currentChunk: 0,
      totalChunks: Math.ceil(orderCount / chunkSize)
    };
    setDisabled('btnStart', true);
    setDisabled('btnStop', false);
    setDisabled('btnCsv', true);
    setStatus('RUNNING', 'running');
    showProgress(true);

    const profiles = preAssignCustomerProfiles(userCount, wowRate);
    ROCKET_PLAN = buildRocketPlan(orderCount, rocketRate);

    const table = qs('tbl');
    table.querySelector('thead').innerHTML = '';
    table.querySelector('tbody').innerHTML = '';

    const keysOrder = []; // ë™ì  í—¤ë” ë³´ê´€
    for (let i = 0; i < orderCount; i++) {
      if (PROCESSING_STATE.shouldStop) break;
      const row = generateCoupangRealisticRow(i, userCount, startYear, endYear, profiles, ROCKET_PLAN[i]);
      if (!keysOrder.length) {
        keysOrder.push(...Object.keys(row));
        buildTableHeader(keysOrder)
      }
      DATA.push(row);

      // í…Œì´ë¸”ì—ëŠ” ìµœê·¼ 200ê±´ë§Œ ì¶”ê°€ ë Œë”ë§(ë¸Œë¼ìš°ì € ì„±ëŠ¥ ë³´í˜¸)
      if (i < 200) {
        renderTableRows([row], keysOrder);
      } else if (i === 200) {
        const tbody = qs('tbl').querySelector('tbody');
        tbody.innerHTML = ''; // ì´ˆê¸° 200ê±´ë§Œ ìœ ì§€
        renderTableRows(DATA.slice(-200), keysOrder);
      } else if (i % 50 === 0) {
        const tbody = qs('tbl').querySelector('tbody');
        tbody.innerHTML = '';
        renderTableRows(DATA.slice(-200), keysOrder);
      }

      PROCESSING_STATE.processedRows = i + 1;
      if ((i % 100 === 0) || i === orderCount - 1) {
        updateProgress();
      }
      if (i % 1000 === 0) await sleep(0); // UI ì–‘ë³´
    }

    setDisabled('btnStop', true);
    setDisabled('btnStart', false);
    setDisabled('btnCsv', DATA.length > 0 ? false : true);
    PROCESSING_STATE.isRunning = false;

    updateKPIs();
    updateValidationAndRisk();

    setStatus('DONE', 'ok');
    showProgress(false);
  }

  function stopGeneration() {
    PROCESSING_STATE.shouldStop = true;
    setStatus('STOPPING...', 'warn');
  }

  // ==========================
  // 8) DIALS
  // ==========================
  function applyDials() {
    const get = id => parseFloat(qs(id).value);
    DIALS = {
      lossOrderTarget: [get('dial_loss_lo'), get('dial_loss_hi')],
      tempViolationTarget: [get('dial_temp_lo'), get('dial_temp_hi')],
      jejuWeatherExposureTarget: [get('dial_jeju_lo'), get('dial_jeju_hi')],
      overstockTarget: [get('dial_over_lo'), get('dial_over_hi')],
      expiryImminentTarget: [get('dial_exp_lo'), get('dial_exp_hi')],
    };
    // ë‚´ë¶€ í™•ë¥  ë³´ì •(ê°„ë‹¨)
    CAL.tempViolationBase = clamp((DIALS.tempViolationTarget[0] + DIALS.tempViolationTarget[1]) / 2, 0.001, 0.10);
    CAL.jejuWeatherScale = clamp(1 + (DIALS.jejuWeatherExposureTarget[1] - 0.12) * 2, 0.6, 1.8);
    CAL.overstockProb = clamp((DIALS.overstockTarget[0] + DIALS.overstockTarget[1]) / 2, 0.05, 0.5);
    CAL.expiryImminentRate = clamp((DIALS.expiryImminentTarget[0] + DIALS.expiryImminentTarget[1]) / 2, 0.001, 0.05);

    qs('tuneStatus').textContent = 'DIALS APPLIED';
    qs('tuneStatus').className = 'pill ok';
  }

  function resetDials() {
    qs('dial_loss_lo').value = 0.07;
    qs('dial_loss_hi').value = 0.12;
    qs('dial_temp_lo').value = 0.01;
    qs('dial_temp_hi').value = 0.02;
    qs('dial_jeju_lo').value = 0.10;
    qs('dial_jeju_hi').value = 0.15;
    qs('dial_over_lo').value = 0.15;
    qs('dial_over_hi').value = 0.25;
    qs('dial_exp_lo').value = 0.005;
    qs('dial_exp_hi').value = 0.01;
    applyDials();
  }

  // ==========================
  // 9) ì´ˆê¸°í™” & ì´ë²¤íŠ¸
  // ==========================
  function initYears() {
    const s = qs('startYear'), e = qs('endYear');
    const now = new Date().getFullYear();
    const years = [];
    for (let y = now - 5; y <= now; y++) years.push(y);
    s.innerHTML = years.map(y => `<option value="${y}" ${y === now - 2 ? 'selected' : ''}>${y}</option>`).join('');
    e.innerHTML = years.map(y => `<option value="${y}" ${y === now ? 'selected' : ''}>${y}</option>`).join('');
  }

  document.addEventListener('DOMContentLoaded', () => {
    initYears();

    qs('btnStart').addEventListener('click', startGeneration);
    qs('btnStop').addEventListener('click', stopGeneration);
    qs('btnCsv').addEventListener('click', downloadCSV);
    qs('btnTune').addEventListener('click', () => {
      const pnl = qs('tunePanel');
      pnl.style.display = (pnl.style.display === 'none' || pnl.style.display === '') ? 'block' : 'none';
    });
    qs('btnApplyDials').addEventListener('click', applyDials);
    qs('btnResetDials').addEventListener('click', resetDials);

    // âœ… í˜ì´ì§€ ë¡œë“œì‹œ ìë™ìœ¼ë¡œ "ë°ì´í„° ìƒì„±" ë²„íŠ¼ í´ë¦­
    setTimeout(() => {
      qs('btnStart').click();
    }, 120);
  });
</script>
</body>
</html>

